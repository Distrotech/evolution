2001-05-03  Dan Winship  <danw@ximian.com>

	* message-list.c: #include <camel/camel-file-utils.h>

	* mail-ops.c (get_folderinfo_get): 
	* subscribe-dialog.c (build_tree): Update for
	camel_store_get_folder_info prototype change.

	* mail-format.c (handle_text_plain_flowed): Improve more on the
	fix from the other day: the first level of indentation adds blank
	lines, but further levels don't...

2001-04-30  Dan Winship  <danw@ximian.com>

	* folder-browser.c (folder_browser_destroy): Unhook event handlers
	before syncing the folder, since the folder browser will have been
	destroyed by the time the sync thread completes and calls the
	signal handlers.

2001-04-29  Dan Winship  <danw@ximian.com>

	* mail-format.c (handle_text_plain_flowed): Mojo this a bit so
	that "\n\n>" gets translated to "<br><blockquote>" rather than
	"<br><br><blockquote>", since the transition to blockquote mode
	creates a blank line itself. Makes Mozilla-generated flowed
	replies look better.

2001-04-27  Dan Winship  <danw@ximian.com>

	* mail-session.c: Renamed from session.c and made to be a subclass
	of CamelSession.

	* mail-mt.c (mail_user_message): Renamed from mail_get_accept and
	made more general-purpose, to implement the new
	camel_session_alert_user.

2001-04-26  Jeffrey Stedfast  <fejj@ximian.com>

	* main.c (main): No need to camel_shutdown() anymore...

	* mail-callbacks.c (next_msg): Don't filter on Seen status.
	(previous_msg): Same.
	(next_unread_msg): New function that does what the old callback
	next_msg callback did (only better named).
	(previous_unread_msg): Same.

	* message-list.c (hide_load_state): Updated to use camel-file-util
	routines.
	(hide_save_1): Same.
	(hide_save_state): And here too.

2001-04-26  Dan Winship  <danw@ximian.com>

	* Makefile.am (INCLUDES): Remove UNICODE_CFLAGS

	* mail-format.c (handle_text_plain_flowed): Use <font color=...>
	to mark citations rather than italicizing them, which has never
	looked very nice. Now this is more consistent with the non-flowed
	case.

2001-04-26  Jon Trowbridge  <trow@ximian.com>

	* folder-browser-factory.c: Added "MessageSearch" verb.

	* mail-callbacks.c (search_msg): Added search callback.
	(are_you_sure): Added some casts to fix compiler warnings.

	* mail-search.c: Added.  A simple search-in-message widget,
	that uses GtkHTML's searching capabilities.

2001-04-25  Dan Winship  <danw@ximian.com>

	* mail-callbacks.c (are_you_sure): New foot-shooting-prevention
	helper function.
	(edit_msg_internal, view_msg): If the user has more than 10
	messages selected, ask before opening them all in separate
	windows, to protect against misclicks/typos after "select all"
	(which we've had at least two reports of now).

2001-04-25  Radek Doulik  <rodo@ximian.com>

	* mail-tools.c (mail_tool_quote_message): set object data directly
	in HTML source

	* mail-callbacks.c (mail_generate_reply): remove \n from citation
	(mail_generate_reply): don't use e_msg_composer_mark_text_orig

2001-04-24  Jeffrey Stedfast  <fejj@ximian.com>

	* folder-browser.c: Added a new signal, "message_loaded" that gets
	emitted when the message has been loaded and set on the
	mail_display.
	(folder_browser_class_init): Define the "message_loaded" signal
	stuff.
	(done_message_selected): Emit the "message_loaded" signal here.

	* message-browser.c (message_browser_next_msg): Do our own
	message-list manipulation. We want the next message, not the next
	unread message.
	(message_browser_prev_msg): Same here but for previous.
	(message_browser_new): Connect to the folder browser's
	"message_loaded" signal.
	(message_browser_folder_loaded): Don't connect to the
	message-list's "message_selected" signal.
	(message_browser_message_loaded): Nw callback which replaces the
	old message_browser_message_selected callback's functionality.

2001-04-24  Dan Winship  <danw@ximian.com>

	* folder-browser.c: Add accelerators to the context menu.
	(on_right_click): Use e_tree_get_cell_geometry and a
	GtkMenuPositionFunc when responding to a Menu-key press so we can
	line the menu up with the selected row rather than the cursor.

	* message-browser.c: include <gal/util/e-util.h> for E_MAKE_TYPE.

2001-04-23  Jon Trowbridge  <trow@ximian.com>

	* mail-display.c (html_button_press_event): Check for mailto:
	links, and pop up our mail address menu when we find one.
	(make_popup_window): The main piece of code (ignoring a zillion
	little callbacks) to pop up our windows with reasonable semantics
	for having them close automatically.
	(mail_text_write): Enable converting addresses to mailto links
	in message bodies.

	* mail-format.c (write_address): Simplify code, removing Radek's
	<DATA> hacks.  Write out addresses as mailto: links.

2001-04-23  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (do_view_message): Use the message-browser
	widget rather than the mail-view window.

	* mail-view.c: Removed.

	* folder-browser.c: Added a folder_loaded signal.

	* message-browser.[c,h]: New window to solve all our message
	browsing needs. This replaces mail-view.c.

	* message-list.c (message_list_select_uid): New function needed by
	the new message-browser window.

2001-04-23  Dan Winship  <danw@ximian.com>

	* mail-callbacks.c (save_msg): Append a "/" to the result of
	g_get_home_dir so gets the default dir it was supposed to.

2001-04-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (mail_send_message): Lets do proper refcounting on
	the sent-folder. Also, g_strdup() the sent_folder_uri since we
	later free it. If we don't, then we get lovely corrupt memory.

	* mail-crypto.c (mail_crypto_pgp_mime_part_sign): Make sure we
	have a context before we try and use it.

2001-04-22  Gediminas Paulauskas <menesis@delfi.lt>

	* folder-browser.c, mail-autofilter.c, mail-callbacks.c,
	mail-ops.c, mail-summary.c, mail-vfolder.c: use system =
	EVOLUTION_DATADIR "/file" instead of g_strdup_printf. Rename
	userrules to user (and system) to be consistent.

	* mail-send-recv.c: set window icon to send-receive.xpm

2001-04-21  Gediminas Paulauskas <menesis@delfi.lt>

	* mail-summary.c: translate "Mail summary".

2001-04-20  Dan Winship  <danw@ximian.com>

	* mail-config-druid.c (make_default_account): Convert the result
	of g_get_real_name() from the locale charset to UTF8. Noted by
	Petter Sundlöf (NOT "Petter Sundl_" :)

2001-04-20  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_set_pgp_type): Use a CamelPgpType.
	(mail_config_get_pgp_type): Return a CamelPgpType.
	(auto_detect_pgp_variables): auto-detect the user's pgp settings.

2001-04-20  Dan Winship  <danw@ximian.com>

	* mail-format.c (handle_text_plain): Fix a dumb thinko in my 04-11
	patch.

2001-04-20  Kjartan Maraas  <kmaraas@gnome.org>

	* mail-ops.c: (send_mail_desc): Convert subject from utf8
	before passing it on.

2001-04-20  Gediminas Paulauskas <menesis@delfi.lt>

	* mail-display.c: #if 0'd out my not-working selection code

2001-04-19  Dan Winship  <danw@ximian.com>

	* mail-format.c (mail_format_raw_message): Make this more raw:
	don't do URLs and citations.

2001-04-18  Dan Winship  <danw@ximian.com>

	* session.c (request_callback): Don't need to dup the string: the
	relevant gnome-dialog routine already does.

	* message-list.c (message_list_destroy): Free the uid_nodemap.
	(hide_save_state): Free the filename when we're done.

2001-04-18  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (is_sent_folder): Implemented.
	(resend_msg): Use is_sent_folder().

2001-04-17  Dan Winship  <danw@ximian.com>

	* mail-mt.c (mail_msg_check_error): Fix a memory leak.

2001-04-16  Ettore Perazzoli  <ettore@ximian.com>

	* importers/Makefile.am (INCLUDES): Add `$(EXTRA_GNOME_CFLAGS)'
	here.

2001-04-15  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (mark_all_as_seen): Mark the messages as seen,
	not unseen.
	(is_drafts_folder): New function to attempt to determine if a
	folder is a drafts folder.
	(open_msg): Use is_drafts_folder().
	(edit_msg): And here.
	(edit_msg_internal): New function that doesn't do the drafts
	checking and is only to be used internally. This should save us
	from having to doubly-check a folder to see if it's a drafts
	folder when doing an Open on the message.
	(open_msg): Call edit_msg_internal once we've established that the
	folder is a drafts folder.

2001-04-14  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c (mail_crypto_pgp_mime_part_verify): Only use
	non-NULL contexts.
	(mail_crypto_pgp_mime_part_encrypt): Same.
	(mail_crypto_pgp_mime_part_decrypt): And here too.

	* mail-format.c (try_inline_pgp_sig): Make sure to not use the
	context if it is NULL.
	(decode_pgp): Same.

	* folder-browser-factory.c: Added stuff for filtering/vfoldering
	on mailinglists.

2001-04-13  Dan Winship  <danw@ximian.com>

	* Makefile.am (evolution_mail_LDADD): Remove some redundant LIBS
	variables... purify complained that the command line was too
	long. :-}

	* mail-account-gui.c: Plug leaks.

	* mail-display.c (on_url_requested): close the html stream on
	error too.

	* mail-ops.c (fetch_mail_fetch): Move a line around that probably
	doesn't affect anything, but it's correct.

	* session.c (auth_callback): Plug leak.

	* mail-send-recv.c (receive_status): Initialize "now".

2001-04-13  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c (on_cursor_activated_cmd): Only activate the
	message if the cursor has moved.

2001-04-12  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c (e_mail_address_new): Updated this function to be
	a correct full ordering.
	(ml_has_get_node_by_id, ml_get_node_by_id): Implemented these
	functions.
	(find_next_undeleted): Changed this to find next sorted undeleted
	message.  Also, changed it so that if the current message is not
	deleted, it returns NULL.
	(build_tree, build_flat): Changed these to only set the cursor if
	the cursor is changed.

	* subscribe-dialog.c: Changed this to pass NULL, NULL for
	has_get_node_by_id and get_node_by_id.

2001-04-12  Jeffrey Stedfast  <fejj@ximian.com>

	* session.c (auth_callback): If the service is NULL, just use the
	item as the key.

	* mail-crypto.c (mail_crypto_pgp_mime_part_sign): Use the
	CamelCipherHash enum.
	(mail_crypto_pgp_mime_part_verify): Use a CamelCipherValidity.

	* mail-format.c (try_inline_pgp_sig): Updated to use
	CamelCipherValidity instead of CamelPgpValidity.
	(handle_multipart_signed): Same.

2001-04-12  Dan Winship  <danw@ximian.com>

	* folder-browser.c (do_message_selected, on_message_selected):
	Don't printf NULL

	* mail-format.c (mail_part_is_inline): Don't leak memory.

2001-04-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-accounts.c (pgp_path_changed): Updated for changes to PGP
	code.

	* component-factory.c (owner_set_cb): Don't init openpgp anymore
	because we don't need it.

	* mail-crypto.c: Simply wrap the camel-pgp-mime functions (also
	renamed the functions to be prefixed with mail_crypto).

	* mail-format.c (handle_multipart_signed): Update to use
	camel_pgp_mime_is_rfc2015_signed() and other camel-pgp-mime
	functions.
	(handle_multipart_encrypted): Same but for rfc2015_encrypted.
	(decode_pgp): Updated to use camel-pgp-context
	(try_inline_pgp): Updated to use camel-pgp-context's.
	(try_inline_pgp_sig): Same.

2001-04-11  Dan Winship  <danw@ximian.com>

	* mail-format.c (handle_text_plain): Only look for special
	pseudo-multipart-isms (binhex, uucode, old pgp, etc) if the MIME
	type is really text/plain. Otherwise, since there's no handler for
	applciation/mac-binhex40, it gets sent to mail-identify.c, which
	thinks it's text/plain because it starts with English words, and
	so it gets sent back to the text/plain handler, which finds an
	embedded binhex part...

	* mail-callbacks.c (do_view_message): mark messages as seen when
	opening then in a separate window.

2001-04-11  Jeffrey Stedfast  <fejj@ximian.com>

	* openpgp-utils.c (openpgp_encrypt): Don't g_free the recipient
	array members here because we free them in the caller.

2001-04-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c (pgp_mime_part_verify): Huh, somehow I forgot to
	apply the from filter when verifying signed parts. Oh well,
	probably not all that common. Fixed now though.

2001-04-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (save_msg): Use the homedir as the default
	filename.

2001-04-11  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c (save_tree_state, message_list_setup_etree): Save
	the expanded state using the ETree built in expanded state code.

2001-04-05  Not Zed  <NotZed@Ximian.com>

	* Merge from evolution-0-10 to evolution-0-10-merge-0 into head.

2001-04-04  Kjartan Maraas  <kmaraas@gnome.org>

	* mail-account-gui.c: Add prototype for service_changed().
	* message-list.h: Remove #include <gal/e-table/e-tree-simple.h>
	since it doesn't get installed.
	
2001-04-04  Gediminas Paulauskas <menesis@delfi.lt>

	* mail-config-druid.c (create_html): set content type to utf8.
	* mail-config.c (mail_config_check_service): fix warning.
	* mail-display.c (link_open_in_browser): just call on_link_clicked().
	(link_menu): Open link works.
	(link_copy_location): claim selection.
	(on_selection_get): new function, selection handler.
	(mail_display_new): connect to selection_get. FIXME: does not work.

2001-04-04  Gediminas Paulauskas <menesis@delfi.lt>

	* component-factory.c: use big trash icon, stolen from mc.

2001-04-03  Jeffrey Stedfast  <fejj@ximian.com>

	* openpgp-utils.c (openpgp_encrypt): Add --no-tty argument to gpg.

2001-04-03  Dan Winship  <danw@ximian.com>

	* folder-browser-factory.c (control_activate): Sync the folder on
	activate.

	* session.c (mail_session_remember_password): Use the same
	URL-transforming rules we use when hashing the password so this
	actually works.

2001-04-02  Iain Holmes  <iain@ximian.com>

	* importers/elm-importer.c (elm_can_import): Call is_kmail to check for 
	KMail files.
	(is_kmail): Checks if the given directory is a KMail directory.

2001-04-02  Iain Holmes  <iain@ximian.com>

	* importers/elm-importer.c (elm_can_import): Check for some MH files
	to make sure that the dir really is an Elm dir.

2001-04-02  Dan Winship  <danw@ximian.com>

	* mail-account-gui.c: Add a "provider_type" arg to
	MailAccountGuiService.
	(transport_needs_auth_toggled): Call service_changed if enabling
	the auth pane so the status of the "Check supported types" button
	will be correct.
	(service_check_supported): Use gsvc->provider_type, not
	CAMEL_PROVIDER_STORE.
	(mail_account_gui_new): Pass the transport as the user_data to the
	"changed" signal on transport.hostname, not the store.
	(mail_account_gui_setup): Set up provider_type fields

2001-04-01  Gediminas Paulauskas <menesis@delfi.lt>

	* component-factory.c: changed vtrash icon to trash. doh
	* folder-browser-factory.c: pixmap cache got moved from here to
	e-util/e-gui-utils.c. Changed pixmap paths according to file renames.
	Added icons for print, get mail, etc., changed get mail icon as Jacub
	suggested.
	* subscribe-dialog.c: also use new pixmap cache.

2001-03-30  Dan Winship  <danw@ximian.com>

	* mail-config.c (check_service_check): Register for cancellation.
	(mail_config_check_service): Pop up a modal dialog with a message
	and a "Cancel" button for the duration of the check.

2001-03-30  Iain Holmes  <iain@ximian.com>

	* importers/evolution-mbox-importer.c (load_file_fn): Check if
	foldername is \0.

	* importers/evolution-outlook-importer.c (load_file_fn): Ditto.

2001-03-30  Jon Trowbridge  <trow@ximian.com>

	* mail-display.c (mail_text_write): Add (commented-out)
	E_TEXT_TO_HTML_CONVERT_ADDRESSES.

	* mail-config.c (mail_config_get_account_by_source_url): 
	Call e_url_equal to compare URLs.

2001-03-30  Dan Winship  <danw@ximian.com>

	* component-factory.c (debug_cb): If the EvolutionShellComponent
	emits a "debug" signal, turn on camel_verbose_debug.

2001-03-30  Radek Doulik  <rodo@ximian.com>

	* mail-display.c (mail_display_redisplay): reset last_active

2001-03-29  Jon Trowbridge  <trow@ximian.com>

	* mail-callbacks.c: Added #include <time.h> to get things
	to compile.

	* mail-callbacks.c (mail_generate_reply): Look at the
	X-Evolution-Source header, and try to find a corresponding
	account.  If this works, send the mail from this account.
	If not, use the default account.

	* mail-ops.c (send_queue_send): Strip out the X-Evolution-Source
	header before sending.

	* mail-config.c (mail_config_get_account_by_source_url): Added.
	Look up accounts by source URL.

2001-03-29  Dan Winship  <danw@ximian.com>

	* mail-format.c (call_handler_function): if called with a
	multipart that's really a 0-part, spew an error and display as
	source.

	* message-list.c: #include <camel/camel-vtrash-folder.h>

	* mail-callbacks.c: #include <libgnome/gnome-paper.h>
	for the gnome-print stuff.

	* mail-display.c (pixmap_press): Ignore "funky" button clicks
	(like scroll wheel scrolls)

2001-03-29  Kjartan Maraas  <kmaraas@gnome.org>

	* *.*: Cleaned up #includes. Remove unneccesary includes of
	<gnome.h>, <gtk/gtk.h>, <bonobo.h> and replaced with more
	fine grained headers where needed. Also marked a bunch of
	strings for translations and added some missing prototypes.
	
2001-03-29  Dan Winship  <danw@ximian.com>

	* mail-account-editor.c (switch_page): Fix this so the "Receiving
	Options" page gets filled in again.

	* mail-send-recv.c (receive_get_folder): Doh! This was storing
	"struct _folder_info"s in the cache and then trying to read them
	back as CamelFolders. Fixicate. Fixes the "crash with 2 POP
	accounts" bug.

	* session.c (auth_callback): Update call to camel_url_to_string.
	(Don't include the params in the password hash table key.)

	* mail-config.c (mail_config_folder_to_cachename): Call
	camel_url_to_string with HIDE_PASSWORD and HIDE_PARAMS so that
	changing URL params doesn't change the cachename.

	* mail-ops.c (add_vtrash_info): 
	* mail-local.c (reconfigure_folder_reconfigure):
	* mail-account-gui.c (save_service): Update calls to
	camel_url_to_string.

2001-04-03  Dan Winship  <danw@ximian.com>
	
	* folder-browser-factory.c (control_activate): Sync the folder on
	activate.

	* session.c (mail_session_remember_password): Use the same
	URL-transforming rules we use when hashing the password so this
	actually works.

2001-04-03  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (mail_send_message): Strip header content before using it.

2001-04-02  Iain Holmes  <iain@ximian.com>

	* importers/elm-importer.c (elm_can_import): Calls is_kmail to
	check for kmail files.
	(is_kmail): Checks if the given directory is a KMail directory.

2001-04-02  Dan Winship  <danw@ximian.com>

	* mail-account-gui.c: Add a "provider_type" arg to
	MailAccountGuiService.
	(transport_needs_auth_toggled): Call service_changed if enabling
	the auth pane so the status of the "Check supported types" button
	will be correct.
	(service_check_supported): Use gsvc->provider_type, not
	CAMEL_PROVIDER_STORE.
	(mail_account_gui_new): Pass the transport as the user_data to the
	"changed" signal on transport.hostname, not the store.
	(mail_account_gui_setup): Set up provider_type fields

2001-04-02  Iain Holmes  <iain@ximian.com>

	* importers/elm-importer.c (elm_can_import): Check for some MH files
	to make sure that the dir really is an Elm dir.

2001-03-30  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c (folder_browser_toggle_hide_deleted): New
	function to listen for hide_deleted changes.
	(folder_browser_toggle_hide_deleted): Only svae the hide-deleted
	state if we are not setting a trash folder.

	* folder-browser-factory.c (control_activate): Set the
	hide_deleted flag appropriately/setup the menu's appropriately.
	(control_activate): Workaround to Force setting of options by
	bypassing bonobo notification, since it doesn't properly handle
	changed components.

	* mail-config.c (mail_config_get_hide_deleted): 
	(mail_config_set_hide_deleted): New functions for
	accessing/setting the hide deleted state.
	(mail_config_write_on_exit): 
	(config_read): Save/load the hide_deleted flag.

	* message-list.c (main_folder_changed): Oops, remember to copy
	over all the rest of the changes too if we removed some.
	(find_next_undeleted): Find the first undeleted message below us.
	This of course does not follow sorting conventions, but thats
	etree.  Have to ask chris if there is a way to make it work like
	that.
	(message_list_set_hidedeleted): Check we dont set hide_delete on a
	vtrash.
	(build_tree): If the message has vanished, try and get the next
	undeleted message set, etc, if it still exists.  The set_cursor()
	function seems very broken but i'm sure e-lahey will get to it
	soon.
	(build_flat): Similarly for above.

2001-03-30  Dan Winship  <danw@ximian.com>

	* mail-config.c (check_service_check): Register for cancellation.
	(mail_config_check_service): Pop up a modal dialog with a message
	and a "Cancel" button for the duration of the check.

	* component-factory.c (debug_cb): If the EvolutionShellComponent
	emits a "debug" signal, turn on camel_verbose_debug.

2001-03-30  Radek Doulik  <rodo@ximian.com>

	* mail-display.c (mail_display_redisplay): reset last_active

2001-03-29  Dan Winship  <danw@ximian.com>

	* mail-format.c (call_handler_function): if called with a
	multipart that's really a 0-part, spew an error and display as
	source.

	* mail-display.c (pixmap_press): Ignore "funky" button clicks
	(like scroll wheel scrolls)

2001-03-29  Dan Winship  <danw@ximian.com>

	* mail-account-editor.c (switch_page): Fix this so the "Receiving
	Options" page gets filled in again.

	* mail-send-recv.c (receive_get_folder): Doh! This was storing
	"struct _folder_info"s in the cache and then trying to read them
	back as CamelFolders. Fixicate. Fixes the "crash with 2 POP
	accounts" bug.

	* session.c (auth_callback): Update call to camel_url_to_string.
	(Don't include the params in the password hash table key.)

	* mail-config.c (mail_config_folder_to_cachename): Call
	camel_url_to_string with HIDE_PASSWORD and HIDE_PARAMS so that
	changing URL params doesn't change the cachename.

	* mail-ops.c (add_vtrash_info): 
	* mail-local.c (reconfigure_folder_reconfigure):
	* mail-account-gui.c (save_service): Update calls to
	camel_url_to_string.

2001-03-29  Not Zed  <NotZed@Ximian.com>

	* mail-local.c (init_trash): Create a vtrash folder, not a vee folder.

	* folder-browser-factory.c (control_activate): Hook in the hide
	deleted thingy.
	Removed MessageHideDeleted menu stuff.

	* message-list.c (message_list_set_hidedeleted): New function, to
	set if we should hide deleted messages automatically/always.
	(regen_list_regen): If we have hide deleted messages turned on,
	then hide them.
	(main_message_changed): Promote to a folder_changed event with a
	change list, folder_changed has the optimisations to handle this
	appropriately.
	(main_folder_changed): IF we get changes events for
	deleted/undeleted stuff, change to added/removed events, rebuild
	if necessary.
	(message_list_set_folder): Setup the default hidedeleted state to
	be to hide everything unless it is in a vtrash folder.

2001-03-28  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-gui.c (setup_service): Move the
	gtk_toggle_button_set_active outside the if.

2001-03-28  Dan Winship  <danw@ximian.com>

	* mail-account-gui.c (mail_account_gui_new): Set up the
	sent/drafts folder buttons.
	(folder_picker_clicked): Pop up the folder selector when sent or
	drafts is clicked.
	(mail_account_gui_save): Save the sent/drafts folders.

	* mail-config.c (account_copy): copy sent/drafts info
	(config_read): read sent/drafts info
	(mail_config_write): write sent/drafts info

	* mail-callbacks.c (composer_send_cb, composer_postpone_cb):
	split out some common code here (and fix inconsistencies). Always
	set headers on the message giving the account name, transport,
	and sent folder to use.

	* mail-ops.c (mail_send_message): If the message has an
	X-Evolution-Account header, use the transport/sent folder info for
	that account (assuming it still exists). Otherwise, if it has
	X-Evolution-Transport and/or X-Evolution-Fcc, use those. If not,
	use the default transport and sent folder.
	FIXME: Falls back silently to the default sent folder if it can't
	open the account-specific one...
	(send_queue_send): remove the X-Evolution-Transport, etc
	processing here, as it gets done by mail_send_message now.
	FIXME: We only sync the default sent folder.
	
	* component-factory.c (owner_set_cb): While setting up the
	standard folders, also record their URIs.

2001-03-27  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (switch_page): Lets do some NULL checking
	here. First, make sure the gsrc isn't NULL and also make sure that
	account->source isn't NULL either.

	* mail-account-gui.c (mail_account_gui_setup): If there isn't a
	source_proto, make sure we select "None" as the source type.

2001-03-27  Dan Winship  <danw@ximian.com>

	* mail-config-druid.c (construct): set the initial druid button
	state after doing the mail_account_gui_setup, since that may
	invoke signal handlers that will change it.

	* mail-account-gui.c (mail_account_gui_new): Fill in signature and
	organization too.
	(mail_account_gui_save): Preserve the "enabled" flag on the source.
	(save_service): Don't look at authtype if the widget is
	insensitive. (Fixes the "smtp://;auth=PLAINservername" bug.)

2001-03-27  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (receive_done): Use gnome-dialog-close instead
	of object_unref, for some reason it doesn't like being unref'd
	with a refcount of 1, _who knows_.  Gets rid of that refcount
	warning on get mail.

2001-03-27  Dan Winship  <danw@ximian.com>

	* mail-config.glade: Probably the very last new config dialog
	ever. (Ha ha). From Anna, based on a story by me.

	* mail-account-gui.c: New code for the new mail-config.glade. This
	abstracts out all of the common code between the account editor
	and the druid. It also handles the spiffy new provider-specific
	config stuff.

	FIXME: The code to check if a service is ok or not is no longer
	there... waiting until the online/offline stuff from the shell
	appears.

	* mail-account-editor.c, mail-config-druid.c: These are much
	smaller now, since most of the interesting bits moved to
	mail-account-gui.c

	* mail-accounts.c: Add an enabled/disabled column/button to
	replace the checkbox that used to be in the editor, because it
	really makes more sense to have it out here. This looks ugly.
	Probably ought to ETable it...
	(load_accounts): Fill in the enabled column.
	(mail_select, mail_unselect): toggle the sensitivity and name of
	the Enable/Disable button appropriately
	(mail_able): Handle the enable/disable button.

	* mail-config.c: Remove reply-to from MailConfigIdentity since it
	didn't belong there (and wasn't being saved anyway).
	(mail_config_check_service): Simplify this a bit. This really
	needs to pop up a dialog with a "connecting..." message and a
	cancel button.

	* mail-ops.c (uid_cachename_hack): Kludge, copied+modified from
	mail_config_folder_to_cachename to deal with the different
	behavior of the URL code now. Will go away when the keep-on-server
	code moves.
	(get_folderinfo_get): Only pass "subscribed_only" to
	camel_store_get_folder_info if the store supports subscriptions...
	
	* mail-local.c (local_provider): Update this to reflect the
	CamelProvider structure change

2001-03-26  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (transfer_msg): Add "vtrash" as an allowed mail
	folder type.

	* mail-ops.c (transfer_messages_transfer): Updated to reflect
	changes made to the move/copy API in camel-folder.c
	(add_vtrash_info): Use /Trash as the path instead of Trash.

	* mail-local.c (reconfigure_folder_reconfigure): Updated this too.

2001-03-20  Not Zed  <NotZed@Ximian.com>

	* mail-local.c (init_trash): Fixed vfolder_new api.

2001-03-26  Dan Winship  <danw@ximian.com>

	* mail-format.c (get_cid): Make fake content-id URLs be guaranteed
	unique: the old way (with %p on the CamelMimePart *) would
	generate duplicates if memory was freed and re-allocated the right
	way.

	* mail-display.c (pixbuf_gen_idle, etc): Make the thumbnail cache
	global rather than per-MailDisplay, since content-ids ought to be
	globally unique. Also, don't leak content-id strings when the
	pixbuf generation fails, and remove pixbufs from the cache after 5
	minutes.

	* component-factory.c (mail_load_storages): Simplify a bit using
	camel_session_get_provider.

	* mail-callbacks.c (empty_trash): Ditto, and fix up use of
	CamelException.

2001-03-26  Radek Doulik  <rodo@ximian.com>

	* mail-format.c (write_address): clear name and email data after
	each address

2001-03-25  Dan Winship  <danw@ximian.com>

	* component-factory.c (unref_standard_folders): Fix a bug in this
	that probably would have been noticed sooner if ETree hadn't always
	made the mailer crash before you got here. :-)

2001-03-25  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (transport_auth_type_changed): Allow the
	authtype to be NULL.
	(transport_auth_init): If the provider allows authtypes but
	doesn't *need* one, create a "None" menu item that the user can
	choose. This should fix the bug people have been seeing recently
	since dan removed the no_authtype authmech from the smtp provider.

2001-03-24  Jeffrey Stedfast  <fejj@ximian.com>

	* openpgp-utils.c (openpgp_verify): Default to iso-8859-1 as the
	user's charset here if it is undefined. This is a better choice
	than us-ascii.

2001-03-23  Jon Trowbridge  <trow@ximian.com>

	* mail-display.c (handle_embedded_address_object): #ifdef away
	some code I don't quite want to delete yet.
	(html_button_press_event): Remove some of Radek's placeholder
	code, replace it with code to create my AddressPopup bonobo
	control.

	* mail-format.c: Remove some obsolete code that if #ifdef-ed out
	a while ago.

	* mail-ops.c (send_queue_send): Strip out the X-Evolution-Identity
	header when sending.

2001-03-23  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c: Turned on BROKEN_ETREE.

2001-03-22  Iain Holmes  <iain@ximian.com>

	* importers/evolution-outlook-importer.c: Update for new IDL.

	* importers/evolution-mbox-importer.c: Update for new IDL.

	* importers/Makefile.am: Build the elm importer.

2001-03-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-accounts.c (mail_double_click): New callback to handle a
	double-click event in the account clist.
	(construct): Setup the double-click event for the account list.

2001-03-22  Radek Doulik  <rodo@ximian.com>

	* mail-display.c (mail_display_new): connect to button_press_event
	and iframe_created events of GtkHTML widget
	(html_button_press_event): new signal handler, runs popup on
	address fields and on links, later we should add popups for images
	and maybe some more? any ideas?
	(html_iframe_created): new signal handler, takes care of
	connecting to button_press_event of all iframes : plus bunch of
	empty methods for popup menu items - to be implemented
	(html_motion_notify_event): new handler, highlights addresses by
	underline
	(html_enter_notify_event): take care of enter event
	(update_active): helper function, extracted from
	html_motion_notify_event
	(update_active): move to absolute coordinates
	(html_button_press_event): ditto

	* mail-format.c (write_address): revert back to raw HTML text,
	store name and email to Text objects, workaround gtkhtml tables
	bug (to be fixed soon ;-)

2001-03-21  Ettore Perazzoli  <ettore@ximian.com>

	* folder-browser-factory.c (update_pixmaps): Don't return if
	loading one image fails.

2001-03-21  Dan Winship  <danw@ximian.com>

	* mail-format.c (handle_multipart_related): Fix a bug in (illegal)
	0-part messages

	* mail-config-druid.c (incoming_check, incoming_type_changed,
	transport_check, transport_type_changed): * mail-account-editor.c
	(transport_type_changed, source_check): Use the new URL part
	macros

	* mail-config.c (check_service_check): Use provider authtype list
	if not connecting.

2001-03-20  Miguel de Icaza  <miguel@ximian.com>

	* folder-browser-factory.c: Added new icons.

2001-03-18  Miguel de Icaza  <miguel@ximian.com>

	* folder-browser-factory.c: Remove duplicated verb.

2001-03-20  Iain Holmes  <iain@ximian.com>

	* importers/evolution-mbox-importer.c (process_item_fn): Step the
	parser so that it will import more than one message.

2001-03-20  JP Rosevear  <jpr@ximian.com>

	* importers/Makefile.am: extra dist the oaf files

2001-03-20  Radek Doulik  <rodo@ximian.com>

	* mail-tools.c (mail_tool_quote_message): set color in html
	citation

	* mail-config.c: added citation highlighting configuration

	* mail-tools.c (mail_tool_quote_message): use citation
	highlighting

	* mail-display.c (mail_text_write): use citation highlighting

2001-03-20  Christopher James Lahey  <clahey@ximian.com>

	* folder-browser.c (etree_key): Made this check if the control
	mask is set.

2001-03-20  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c (remove_node_diff, build_flat_diff): Remove the
	node before freeing the data it points to.

2001-03-19  Christopher James Lahey  <clahey@ximian.com>

	* Merged e-tree-rework-branch:

2001-03-18  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c: Added has_save_id and get_save_id methods.

	* subscribe-dialog.c: Added arguments for
	e_tree_memory_callbacks_new of get_save_id and has_save_id to
	NULL.

2001-03-16  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c: Added a call to
	e_tree_memory_set_expanded_default to TRUE.  Removed all calls to
	set_expanded on nodes while the tree is frozen since this fails
	miserably now.

2001-03-13  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c (message_list_get_layout): Turned off draw-grid.

2001-03-09  Christopher James Lahey  <clahey@ximian.com>

	* folder-browser-factory.c, folder-browser.c, message-list.c,
	message-list.h, subscribe-dialog.c, subscribe-dialog.h,
	mail-callbacks.c: Converted these all to use ETree instead of
	ETable.

End of branch

2001-03-19  Iain Holmes  <iain@ximian.com>

	* importers/pine-importer.c: Pine intelligent mail importer.
	
	* importer/elm-importer.c: Elm imtelligent mail importer.

	* importer/GNOME_Evolution_Mail_(Pine|Elm)_Intelligent_Importer.oaf.in:
	Pine and Elm oafinfo files.

	* importer/netscape-importer.c (maybe_replace_name): Replace some invalid
	names with valid ones (Trash -> Netscape-Trash). Change some netscape names
	to Evolution names (Unsent Messages -> Outbox).
	(scan_dir): Use less variables.
	(netscape_import_file): Simplify.

2001-03-19  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c: Removed gnome.h and ctype.h
	(send_queue_send): Don't remove the X-Evolution header here.
	(mail_send_message): Remove it here instead (so we only have to
	remove it in one place - no matter if you send a single message or
	send_queue.

2001-03-19  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (write_headers): Write the date header.

	* component-factory.c (owner_unset_cb): Call
	unref_standard_folders() here instead.

	* folder-browser-factory.c: Add Resend Message menu item.

	* folder-browser.c (on_right_click): Add resend to the right-click
	menu.

	* mail-callbacks.c (composer_sent_cb): Unref the message.
	(composer_postpone_cb): Unref the message here too.
	(resend_msg): New callback to allow resending of messages in the
	Sent folder.

2001-03-18  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c (unref_standard_folders): unref the standard
	folders.
	(owner_set_cb): Use g_atexit() to call unref_standard_folders()
	when evolution-mail exits. This should solve the problem where
	these folders are not synced when evolution-mail closes (because
	they still had refs on them on close).

2001-03-17  Not Zed  <NotZed@Ximian.com>

	* mail-mt.c (mail_msg_free): Move the proxy event outside the lock
	(otherwise we always deadlock).

	* mail-local.c (reconfigure_clicked): Clear the message list
	during update inside the folder thingy.  This is a hell mess, need
	to move the gui stuff to mail-callbacks and make this reconfigure
	thing a more generic func.

	* message-list.c (ml_value_to_string): Cleanup the logic to use
	lookup tables.
	(sort_uid_to_rows): Removed due to rewrite below.
	(build_flat_diff): Changes for node/summary/etc changes.  Also do
	changed nodes too.
	(clear_tree): Free the info reference for nodes in our hashtable.
	(build_subtree): Ref the info reference in our hash/tree node.
	(on_click): Dont free message info, since we just got our ref to
	it.
	(remove_node_diff): Free messageinfo off node.
	(build_flat): Ref messageinfo.
	(message_list_set_folder): Allow a NULL folder to be set -
	i.e. clear the view.
	(message_list_set_folder): Emit a no message sleeted signal.
	(build_tree): Change cursor keeping stuff to work with new info.
	
	Turned off BROKEN_ETREE - well maybe it'll work.  Check for
	duplicate messages displayed, etc.

2001-03-16  Not Zed  <NotZed@Ximian.com>

	* message-list.h: Added uid_nodemap; mapping of uid's to e-tree
	nodes.

	* message-list.c (build_flat): Changed to take a summary argument,
	and to store node in node map, etc, and store info's in e-tree.
	(build_subtree): Changed to store node in node map, and to store
	info's in tree directly.
	(ml_tree_value_at): Changed to get info directly from tree node,
	removed allocated return value logic.
	(ml_tree_value_at): Removed all "fake node" handling, no fake
	nodes should ever exist.
	(id_is_uid, id_is_subject, id_uid, id_subject): Removed macro's no
	longer used.
	(new_id_from_uid, new_id_from_subject): Removed no longer used.
	(get_message_uid):
	(get_message_info): Treat tree node data as messageinfo.
	(message_list_select): Dont free the messageinfo, as its part of
	our data, not retrieved from folder.
	(message_list_drag_data_get): ditto.
	(subtree_unread): Treat tree node data as messageinfo.
	(subtree_size): ditto.
	(subtree_earliest): ditto.
	(clear_tree): Reset uid_nodemap on clear.
	(save_node_state): tree nodes == messageinfo's.
	(add_node_diff): ditto.
	(remove_node_diff): ditto.
	(main_folder_changed): use uid_nodemap to lookup changed nodes.
	(main_message_changed): ditto.

2001-03-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c (pgp_mime_part_sign_prepare_part): New function to
	prepare the mime part and any subparts for pgp signing.
	(pgp_mime_part_sign_restore_part): New convenience function to
	undo the prepare_part.
	(pgp_mime_part_sign): Don't assume the part passed in is a leaf
	part, we could very easily get a multipart (and in fact were which
	is why people have been having unexpected results when signing
	messages with attachments) and set the encoding as if it were a
	leaf part. Use our 2 new convenience functions to set the
	encoding(s) instead.

2001-03-15  Miguel de Icaza  <miguel@ximian.com>

	* folder-browser-factory.c (folder_browser_setup_view_menus): Fix
	memory leak.

2001-03-15  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (apply_changes): We don't care about SSL,
	yea baby...
	(apply_changes): Don't care about SSL, no baby...
	(construct): Yea, I said we don't care 'bout SSL, baby
	(construct): That's exactly what I said, uh huh...
	(transport_auth_type_changed): Set the sensitivity of the
	user/passwd entries.
	(transport_type_changed): If the hostname hasn't been set yet,
	just use "localhost" as it doesn't really matter, since all we
	need is a valid URL object.

	* mail-config.c: We no longer need `use_ssl' for sources and
	transports.

2001-03-15  Dan Winship  <danw@ximian.com>

	* mail-display.c (mail_display_redisplay): Remove a stray
	camel_object_ref that was causing messages to never be finalized
	if they got redisplayed (because of attachments, delayed-loading
	IMAP parts, etc)

2001-03-15  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c: Added edit item to search-bar menu.

	* mail-callbacks.c (filter_edit): Changed for filter_editor_new()
	api addition/change.

	* mail-vfolder.c (vfolder_edit): Use vfolder_editor_new intead.

2001-03-14  Jeffrey Stedfast  <fejj@ximian.com>

	* session.c (mail_session_init): Tell camel to init NSS.
	(mail_session_accept_dialog): Doh! NULL terminate the list of
	buttons and show the label.

	* mail-mt.c (do_get_accept): Same.

2001-03-14  Ettore Perazzoli  <ettore@ximian.com>

	* importers/Makefile.am (INCLUDES): Add `-I$(top_builddir)/shell'
	and `-I$(top_srcdir)'.

2001-03-13  Dan Winship  <danw@ximian.com>

	* mail-display.c (on_url_requested): Call gtk_html_end() on the
	stream so things happen. Fixes a problem with some inline images
	(just very small ones maybe?)

	* importers/.cvsignore: create

2001-03-13  Jeffrey Stedfast  <fejj@ximian.com>

	* session.c (mail_session_init): Call camel_init with the
	evolution directory passed in. Also, abort if camel cannot be
	initialized.

	* main.c (main): Shutdown camel.

2001-03-04  Michael Meeks  <michael@ximian.com>

	* folder-browser-factory.c (free_pixmaps): impl.
	(update_pixmaps): accelerate with cache.

2001-03-13  Iain Holmes  <iain@ximian.com>

	* Makefile.am: Removed the importers and created a subdirectory
	for them to live happily as plugins.

	* mail-importer.c (mail_importer_create_folder): Modified the
	function to take a BonoboListener for the callback.
	(get_importer_list): Get a list of importer plugins.
	(free_importer_list): Free the list of plugins.
	(mail_importer_init): Initalise the list of plugins.
	(main_importer_uninit): Unload the modules.

	* GNOME_Evolution_Mail.oaf.in: Remove the oaf_server entries for
	the importers.

	* importers/*: Copy the importers in here.

2001-03-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_write): Make the transport save
	whether or not it's supposed to use SSL as well.
	(config_read): Read in whether or not we should remember the
	transport password (for those that support SASL).
	(mail_config_write): Save whether or not to save transport
	passwords (needed for SASL enabled transports).

	* mail-ops.c (add_vtrash_info): Instead of always creating a new
	vTrash folder, if the store already has a Trash folder, replace it
	with the vTrash. Also, name the folder "Trash" instead of "vTrash"
	and i18nify the name.

2001-03-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.h: Added protection.

	* folder-browser-factory.c: Add ActionsEmptyTrash. By the way -
	should we rename the bonobo verbs now that our menu structure has
	changed?

	* mail-callbacks.c (empty_trash): New callback to empty ALL of the
	trash folders.

2001-03-10  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (send_queue_send): Remove our X-Evolution header
	before we send. Also don't send messages that are marked for
	deletion.

2001-03-09  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-mt.c (mail_get_accept): New async function that will be
	used for SSL certs later.

	* session.c (auth_callback): Changed to return a gpointer value.
	(mail_session_accept_dialog): New function to handle the new
	_ACCEPT authenticator mode.

2001-03-08  Jeffrey Stedfast  <fejj@ximian.com>

	* folder-browser-factory.c: Set the Forward->Quoted callback.
	Also set the forward->Attachment callback.

	* mail-view.c (view_forward_msg): Specify FORWARD_ATTACHED.

	* mail-callbacks.c (forward_attached): Don't call
	forward_messages() anymore...never really needed to. Just handle
	it directly.
	(forward_inlined): Specify FORWARD_INLINE as the flag argument.
	(forward_quoted): New function sorta like forward_inlined except
	this forwards the message quoted.

	* mail-tools.c (mail_tool_forward_message): New function to
	prepare a message to be forwarded.

2001-03-08  Jon Trowbridge  <trow@ximian.com>

	* mail-format.c (write_field_row_begin): Added.  Table row HTML
	broken out into its own function.
	(write_subject): Added.  Emits the proper HTML for the subject
	line.
	(write_field_to_stream): #ifdef-ed out of existence.
	(write_address): Take a CamelInternetAddress and spit out an
	<object> tag with the appropriate <param>s.

	* mail-display.c (on_object_requested): Check for an "address"
	object.  If found, call...
	(handle_embedded_address_object): ...this function, which creates
	an AddressWidget bonobo control and passes in the necessary info.
	I never really realized just quite how much GtkHTML kicks ass
	until I figured out how to make this work.

2001-03-08  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-vtrash.[c,h]: Removed from cvs

	* Makefile.am: Removed mail-vtrash.[c,h]
	
	* main.c: Don't #include "mail-vtrash" anymore.

	* component-factory.c: Add "vtrash" as a folder type we support.
	(create_view): Kludgy-kludge around the vtrash type.
	(owner_set_cb): Don't create the vTrash folder here anymore...	

	* folder-browser.c (on_double_click): Call open_msg here so that
	it does the Right Thing (tm).

2001-03-08  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-local.c (mail_local_store_class_init): Override the default
	init_trash() with the our custom one (since MailLocalStore doesn't
	let the CamelStore keep a hash of opened folders and instead
	keepts track of them itself).
	(init_trash): custom implementation of the init_trash method for
	MailLocalStores
	(get_folder): i18nize.
	(register_folder_registered): Don't add the folder to the vtrash
	here.

2001-03-08  Ettore Perazzoli  <ettore@ximian.com>

	* component-factory.c (component_fn): Specify a NULL
	`EvolutionShellComponentGetDndSelectionFn'.

2001-03-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-autofilter.c (filter_rule_from_message): Add an action-part
	widget.
	(filter_rule_from_mlist): Same here. This should get rid of the
	problem where people go to create a rule based on a message and
	forget to fill-in the action part.

2001-03-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c (mail_crypto_is_smime_v3_signed): New function to
	decide if a mime part is an S/MIME v3 signed part.
	(mail_crypto_is_pkcs7_mime): New function to decide if a mime part
	is an application/pkcs7-mime part (or an application/octet-stream
	part with application/pkcs7-mime data).

	* mail-account-editor.c (source_auth_init): Move the signal
	emittion to after the set_menu call so that it actually works.
	(transport_type_changed): Updated to manipulate the user/passwd
	fields for the transport.
	(construct): Updated to init the user/passwd fields for the
	transport.
	(transport_auth_init): Renamed. Also fill in the user/passwd
	fields if available.

2001-03-06  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-accounts.c (construct): Disable the NNTP code if NNTP is
	not enabled. This prevents some runtime warnings...

	* mail-config-druid.c: Updated to have a transport auth page.

2001-03-01  Miguel de Icaza  <miguel@ximian.com>

	* folder-browser.c (on_right_click):  Move the context menus to
	the toplevel code;  Use enumerations for the various bitfield
	constants. 

	Add support for hiding items that are not required (read/unread
	and delete/undelete). 

	This requires my previous patch, as it assumes "Open" does the
	right thing instead of having two operations: Open and Edit. 
	
2001-02-28  Miguel de Icaza  <miguel@ximian.com>

	* folder-browser.c (on_right_click): Removed draft folders op
	here, since open_msg now does the right thing (edit or view).

	* folder-browser-factory.c (update_pixmaps): Removed MessageEdit
	from here.

	* mail-callbacks.c (open_msg): New function, does the "right
	thing" to a message (either, edit or open).

	* folder-browser-factory.c: Register new command here.
	(update_pixmaps): Rename keys that have been shuffled around.
	(update_pixmaps): Rename to match new updates on xml file.

	Rename MessageOpenNewWindow to MessageOpen.  Change action from
	"view_message" to "open_message".

	* mail-callbacks.c (mark_all_as_seen): New command.  Marks all
	messages as seen.

2001-03-06  Dan Winship  <danw@ximian.com>

	* mail-ops.c (get_folderinfo_got): If the folderinfo has no URL
	(ie, can't contain messages), don't add it as a vtrash source.

2001-03-05  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c: Don't access the `active` data member of a
	GtkToggleButton directly - bad programming, shame on me.

	* mail-account-editor.c: Same here.

	* mail-accounts.c: And here too.

	* mail-callbacks.c (empty_subject_destroyed): And finally here.

	* mail-crypto.c (pgp_mime_part_sign): Correcty set the mime type
	for the multipart. Hmmm, still doesn't wrap correctly. NotZed?
	Ideas?
	(pgp_mime_part_encrypt): Here too.

2001-03-03  Not Zed  <NotZed@Ximian.com>

	* mail-tools.c: Remove very old camel lock stuff.

	* mail-local.c (register_folder_registered): Add the local folder
	as a potential vfolder source.

	* folder-browser.c (got_folder): When we have a new folder,
	register it as a potential vfolder source.

	* mail-vfolder.c: Added the source rule to the vfolder_info.
	(vfolder_refresh): Store the rule in the vfolder info, etc.
	(vfolder_register_source): Function to register a newly opened
	folder with us.
	(vfolder_uri_to_folder): Save the folder in the vfolder_info too.
	(source_finalise): Handle clenaup when the folder dies.

2001-03-02  Not Zed  <NotZed@Ximian.com>

	* mail-mt.c (set_stop): Check the container is not NIL before
	trying to set thje prop.

2001-03-01  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c (folder_browser_search_menu_activated): Fixes
	for changes to search bar.
	(search_save): Removed.
	(search_full): Removed.
	(search_full_clicked): Removed.
	(folder_browser_search_option_items[]): Removed.
	(folder_browser_search_query_changed): Changed for search bar
	changes.
	(folder_browser_clear_search): Removed.

	* mail-vfolder.c (vfolder_clone_rule): New function to clone a
	filter/search rule into a matching vfolder rule.

	* mail-send-recv.c (mail_receive_uri): Setup a timeout for status
	updates.
	(build_dialogue): Setup timeout id for status updates.
	(operation_status_timeout): New function to set the status via a
	timeout.
	(receive_done): Remove the timeout handler if we need to.
	(operation_status): 
	(receive_status): Just update the info, and let the timeout
	handler update the gui.
	(do_free_status): 
	(do_show_status): Removed gui thread status message processing.

2001-02-28  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c (folder_browser_config_search): New function to
	configure the FilterRule for the search mechanism.

2001-02-27  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c (folder_browser_gui_init): Setup the search bar
	as a filterbar.
	(got_folder): Set the whole search bar sensitive or not based on
	the search capability of the folder.

	* folder-browser.h: Changed to use efilterbar instead of esearchbar.

2001-02-27  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (configure_mail): Return TRUE if the user
	configured his/her settings, else return FALSE.
	(check_send_configuration): If configure_mail() returns TRUE, then
	continue otherwise quit.
	(send_receive_mail): Same.

2001-02-26  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (mail_generate_reply): Set a "References"
	header no matter what if we are able to get a Message-Id. Fixes
	bug #1583.

	* mail-accounts.c (mail_delete): Confirm that the user REALLY
	wants to delete this account.
	(news_delete): Same.

	* mail-ops.c (mail_send_message): Changed the product string -
	will change it to use User-Agent once I get the RFC/DRUMS draft or
	whatever. Until then I'll stick with X-Mailer.

2001-02-26  Dan Winship  <danw@ximian.com>

	* mail-callbacks.c (delete_msg): Mark deleted messages as "seen"
	as well so they don't count towards the unread count.

	* mail-view.c (view_delete_msg): ditto

2001-02-25  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c (owner_set_cb): Re-add the
	mail_vtrash_create() hack back in for LocalStores since there's no
	better way to register a vTrash folder on the Local Storage yet.

	* mail-local.c (register_folder_registered): Add folders to the
	vTrash folder here since the LocalStore does not let the parent
	CamelStore class keep it's own hash of the folders.

2001-02-25  Jeffrey Stedfast  <fejj@ximian.com>

	* session.c (mail_session_forget_password): New function to force
	the removal of a given password.

	* openpgp-utils.c (openpgp_decrypt): On failure, forget the
	passphrase.
	(openpgp_encrypt): Here too. (cleaned this up a bit too)
	(openpgp_clearsign): And here.
	(openpgp_sign): Again...

	* mail-callbacks.c (composer_postpone_cb): Abort if the message is
	NULL (which is valid if an error occured).
	(composer_send_cb): Same.

2001-02-24  Jeffrey Stedfast  <fejj@ximian.com>

	* folder-browser.c: Toss the mail_tool_camel_lock* stuff.
	* mail-ops.c: Same.
	* mail-summary.c: Here too.
	
	* mail-tools.c (mail_tool_uri_to_folder_noex): Blown away!
	(mail_tool_filter_get_folder_func): *kapoosh*
	(mail_tool_camel_lock_up): Same.
	(mail_tool_camel_lock_down): Same.
	(mail_tool_set_uid_flags): Don't need this rubbish anymore either.

2001-02-24  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c (mail_load_storages): No longer need to
	construct the vTrash here.
	(owner_set_cb): Don't make the vTrash for the local store here.

	* mail-ops.c (add_vtrash_info): New function to add a vTrash
	folder info to a pre-constructed CamelFolderInfo for use in the
	get_folder_info async function.

2001-02-23  Jeffrey Stedfast  <fejj@ximian.com>

	* main.c (main): No longer need to do a vtrash_cleanup() (it also
	doesn't exist anymore).

	* component-factory.c (mail_load_storages): Updated to use the new
	vtrash code.
	(owner_set_cb): Same.

	* mail-tools.c (mail_tool_uri_to_folder): Update to handle the
	"vtrash:" url prefix so that we can extract the REAL uri and know
	to get the trash folder.

	* mail-vtrash.c (mail_vtrash_add): Add the vTrash folder to the
	EvolutionStorage.
	(mail_vtrash_create): Get the store based on the uri (async) and
	then call mail_trash_add.
	(vtrash_cleanup): Removed.
	(vtrash_uri_to_folder): Removed.
	(vtrash_create): Replaced by mail_vtrash_create()

2001-02-23  Iain Holmes  <iain@ximian.com>

	* component-factory.c (owner_set_cb): Init the importer here.

	* mail-importer.[ch] (mail_importer_create_folder): Add a function
	that creates new folders in the shell.
	(mail_importer_init): Take in an EvolutionShellClient, and get the
	local_storage corba_object from it.

2001-02-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-vtrash.c (create_trash_vfolder): Come up with a unique
	store uri for each vtrash (using %p and the CamelStore we're gonna
	place it on).
	(get_trash_get): Pass in the store so we can use it for %p.

2001-02-23  Not Zed  <NotZed@Ximian.com>

	* mail-vfolder.c (vfolder_gui_add_from_mlist): Rule to add mlist
	vfolder.

	* mail-autofilter.c (filter_gui_add_for_mailing_list): Removed.
	(rule_from_mlist): Build a generic match rule from an mlist.
	(vfolder_rule_from_mlist): Setup the vfolder rule for an mlist.
	(filter_rule_from_mlist): Setup a filter rule fro an mlist.
	(filter_gui_add_from_mlist): GUI thingy to do the work.

	* folder-browser.c (on_right_click): Added vfolder on mailing list
	to filter menu.
	(on_right_click): Use header_raw_check_mailign_list instead of
	mlist magic to get the mailing list name.
	(filter_mlist): Changed to use new add_from_mlist() call.
	(vfolder_mlist): New function for vfolder from mlist.

	* mail-send-recv.c (build_dialogue): Only allow downloading if the
	source is enabled at this time.
	(mail_autoreceive_setup): Check for enabled sources before setting
	up autodownload.

2001-02-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-accounts.c (construct): Construct the PGP Path
	GnomeFileEntry widget.
	(pgp_path_changed): Try to auto-detect which PGP type the binary
	file is based on the basename (yuck).

2001-02-23  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (create_folder_get): Make op cancellable/report
	internals.
	(get_folder_get): 
	(sync_folder_sync): 
	(get_folderinfo_get): Make op cancellable/report internals.

	* mail-vtrash.c (get_trash_get): Setup the operation registration,
	and create a pseudo "start/stop" operation.
	(get_trash_free): Free store if we have it.
	(get_trash_got): Move vtrash add into here, so we execute in the
	right thread.

	* component-factory.c (owner_set_cb): Make trash creation async.

	* mail-local.c (register_folder_desc): A description of what we're
	doing.

	* mail-mt.c (mail_msg_new): Set status callback to operation_new.
	(mail_operation_status): Operation status function, proxy messages
	to main thread, and attempt to present a meaningful ui experience
	for operations.

2001-02-22  Jeffrey Stedfast  <fejj@ximian.com>

	* openpgp-utils.c (openpgp_verify): Fixed memory corruption bug.

	* mail-format.c (try_inline_pgp_sig): Check to make sure the
	validity isn't NULL.
	(handle_multipart_signed): Check for NULL validities.

2001-02-21  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-tools.c (mail_tool_uri_to_folder): Protect against NULL
	uri's.

	* mail-vtrash.c: Do mutex locking on the global hash table - this
	should clear up some segfaults ;-)

	* mail-config-druid.c (druid_finish): Set the 'enabled' member of
	the source to TRUE if the URL exists else set to FALSE.
	(incoming_type_changed): If the provider chosen is "None" then
	gray-out the auto-check widgets and the check-settings, otherwise
	sensitize them.

	* mail-account-editor.c (construct): Added a few more settings.
	(apply_changes): Save the new settings.

	* mail-config.c (service_copy): Updated.
	(config_read): Read in whether or not the account is enabled.
	(mail_config_write): Save if the account is enabled or not.

2001-02-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (mail_send_message): Updated to reflect changes to
	the filter-driver code.

2001-02-22  Not Zed  <NotZed@Ximian.com>

	* Makefile.am (CAMEL_OBJS_EXTRA): Removed, no longer link with
	libcamelvee.
	(evolution_mail_LDADD): Ditto.

	* mail-vtrash.c: Moved camel-vee-store header ot camel levle.

	* mail-tools.c: Moved camel-vee-folder header to camel.

	* mail-local.c (local_storage_new_folder_cb): started hack for
	progress reporting, which is currently to the console.

	* mail-mt.c (set_stop): Set the stop button sensitivity.
	(mail_msg_received): enable/disable stop button while we're
	processing stuff in another thread.

	* message-list.c (ml_tree_value_at): If our uid entry vanishes
	before w'ere ready, then make a fake.

2001-02-21  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c (pgp_mime_part_verify): Changed to use
	PgpValidity.

	* openpgp-utils.c (openpgp_verify): Return a PgpValidity and set
	the description as UTF-8 for later use in mail-format.c when
	writing to GtkHTML.

	* mail-format.c (try_inline_pgp_sig): Updated to use the new
	PgpValidity code.
	(handle_multipart_signed): Updated.

2001-02-21  Not Zed  <NotZed@Ximian.com>

	* mail-callbacks.c (composer_postpone_cb): Fix for api changes to
	append_mail.

	* Makefile.am (evolution_mail_SOURCES): Removed mail-threads.[ch].

	* mail-threads.[ch]: Removed.

	* subscribe-dialog.c (subscribe_do_get_store): Chagned to use new
	thread stuff.  This is really getting boring.
	(subscribe_do_subscribe_folder): Changed to use new thread stuff.
	Last one at last, phew.

	* session.c (register_callback): Changed to use new thread stuff.
	YUCK.  I dropped some functionality, now the timeout callback
	return is ignored, so basically it keeps running till finished.

	* mail-ops.c (mail_operation_run): Removed, no longer used/needed.
	(mail_do_append_mail): Changed to use new thread stuff.
	(mail_do_transfer_messages): ditto.

	* mail-local.c (local_storage_new_folder_cb): Use new thread
	stuff, also only run synchronous for this operation.
	(mail_local_reconfigure_folder): 
	(reconfigure_clicked): Changed to use new mail thread stuff.

	* mail-config.c (mail_config_check_service): Changed to use new
	thread stuff.

2001-02-20  Dan Winship  <danw@ximian.com>

	* mail-vtrash.c (get_trash_get): Pass NULL, not "/" for @top.

	* mail-callbacks.c (create_folders): Make this work with
	CamelStores where the separator character isn't /. folder_created
	and folder_deleted are still broken.

2001-02-20  Not Zed  <NotZed@Ximian.com>

	* mail-vtrash.c: Include the camel-vee-store.h header from the
	uninstalled copy.

2001-02-19  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c (mail_load_storages): Create vTrash folders
	for all remote stores as well.

2001-02-20  Not Zed  <NotZed@Ximian.com>

	* mail-vtrash.c (create_trash_vfolder): Add the auto-update flag
	to the folder open flags.

2001-02-19  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-vfolder.c (mail_vfolder_get_vfolder_storage): New handy
	dandy function to ref and return the vfolder storage (will
	probably be disavowed once I figure out how to get the vTrash
	folder to show up in the EvolutionLocalStorage).

	* main.c (main): Call vtrash_cleanup().

	* mail-vtrash.c: New file.
	(vtrash_uri_to_folder): vtrash: URI handler
	(vtrash_create): Replacement async vtrash function for the old one
	in mail-ops.c
	(vtrash_cleanup): Cleanup code - unrefs the cached vtrash folders
	and free's the hashtable.

	* Makefile.am: Added mail-vtrash.[c,h].

	* mail-tools.c (mail_tool_uri_to_folder): If we have a vtrash:
	URI, call the vtrash URI handler function rather than continuing
	on. Yes, I know this is a hack and it needs to be fixed.

	* mail-ops.c (mail_do_setup_trash): Removed.
	(mail_trash_get): Removed.

	* component-factory.c (owner_set_cb): Create the vTrash folder for
	the LocalStore here.

	* mail-local.c (get_folder_info): Implement.

2001-02-20  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (fetch_mail_fetch): Unref the driver here, in the
	subthread, so we dont block the gui while it sync's all the
	folders.
	(fetch_mail_fetched): Rewmoved above code from here.

2001-02-16  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (receive_status): Dont do the thaw/freeze set here.
	(update_folders): "

	* mail-vfolder.c (vfolder_refresh): Setup the virtual
	'unmatched' folder by default.
	(vfolder_uri_to_folder): HAndle UNMATCHED folder specially, it has
	no explicit sources.

2001-02-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-send-recv.c (receive_get_folder): Not sure it makes any
	difference, but lets ref the folder while the hash table is locked
	rather than after we unlock it.

2001-02-16  Jeffrey Stedfast  <fejj@ximian.com>
	
	* main.c: * component-factory.c: Reverse the changes I made
	yesterday.

2001-02-15  Jeffrey Stedfast  <fejj@ximian.com>

	* main.c (main): Have the mail-config and openpgp initialize here
	instead.

	* component-factory.c (owner_set_cb): No need to have mail-config
	and openpgp init here.

2001-02-15  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (do_scan_subfolders): Use mail_storage_create_folder

	* mail-callbacks.c (mail_storage_create_folder): Convenience
	function so we can keep all the evolution_storage_add_new_folder()
	code in one place as much as possible.

	* subscribe-dialog.c (recursive_add_folder): Use 'name' rather
	than the no-description bs since that's what all the other places
	do.

	* mail-callbacks.c (folder_created): New callback to handle the
	"folder_created" signal - handles CamelFolderInfo's recursively.
	(folder_deleted): Same but for "folder_deleted".

	* component-factory.c (storage_create_folder): Instead of doing
	the evolution_storage_new_folder() stuff by hand, pass it off to
	the new callback: folder_created(). At some point this will be
	unecessary as we'll attach this callback to the "folder_created"
	signal.

2001-02-15  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c: Wrapped the address compare functions in a
	#ifdef
	(address_compare): #ifdef the use of the smart address sorting
	code and provide a #else for using g_strcasecmp().

2001-02-14  Jeffrey Stedfast  <fejj@ximian.com>

	* openpgp-utils.c (openpgp_verify): Add the --no-tty flag.

2001-02-14  Dan Winship  <danw@ximian.com>

	* mail-mlist-magic.c: Rewrite explanatory comments to use normal
	regexps rather than procmail weirdness. 
	(check_sender): match "foo-owner" as well as "owner-foo".
	(check_list_post): (New) Check for "List-Post: <mailto:..."
	(mail_mlist_magic_detect_list): Iterate through an array of
	function pointers rather than calling each checker explicitly.

	* component-factory.c (add_storage): Connect to the
	"create_folder" signal on the storage.
	(storage_create_folder): Do folder creation.

2001-02-14  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c (owner_set_cb): Setup the Trash folder.

	* mail-ops.c (create_trash_vfolder): Do better error handling.
	(populate_folder_urls): Oops, helps to strdup the url into the
	array if we plan on freeing the data.
	(mail_get_trash): New async function that may eventually replace
	mail_do_setup_trash().
	(do_setup_trash): Do better error handling.

	* mail-local.c (mail_local_store_class_init): Override
	get_folder_info.
	(get_folder_info): Implement.

2001-02-13  Christopher James Lahey  <clahey@ximian.com>

	* mail-local.c (do_reconfigure_folder): Fix some uninitialized
	variables.

2001-02-12  Not Zed  <NotZed@Ximian.com>

	* message-list.c (build_tree): if doing a full update, save the
	cursor pos and restore it afterwards.
	(on_cursor_activated_cmd): Copy the current_uid to a new string.
	I dont know why this is required, but it is.
	(message_list_destroy): Free the cursor_uid as we're done with it.
	(build_flat): IF the current uid disappeared from the list, then
	unset the message.
	(build_tree): Likewise.

2001-02-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_write): Clean out the cruft in the
	Accounts section before writing the current accounts out to the
	config file.

	* mail-account-editor.c (construct): Strip the leading "/" from
	the Namespace/Path entry if the provider doesn't require absolute
	pathnames.

2001-02-12  Kjartan Maraas  <kmaraas@gnome.org>

	* Makefile.am: xml-i18n-tools setup.
	* GNOME_Evolution_Mail.oaf.in: Mark strings for translation.
	
2001-02-11  Dan Winship  <danw@ximian.com>

	* mail-callbacks.[ch]: Re-add non-static forward_messages.
	mail-view.c needs it.

2001-02-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (forward_inlined): Don't leak memory.
	(forward_messages): change doinline to be a gboolean argument.

2001-02-10  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (list_add_addresses): Check the full list of
	IDs instead of just the default id and if we find an address
	matching one of the user's ids, then save it.
	(mail_generate_reply): Try to guess which account to use based
	upon the list of To and Cc addresses and pass that as the 'From'
	address to e_msg_composer_set_headers().
	(forward_get_composer): Updated to reflect changes to
	e-msg-composer.

2001-02-11  Gediminas Paulauskas <menesis@delfi.lt> 

	* mail-config.glade.h: removed, xml-i18n-extract's the strings itself.
	* *.glade: do not output_translatable_strings 
	* Makefile.am: removed *.glade.h from EXTRA_DIST. 

2001-02-09  Dan Winship  <danw@ximian.com>

	* mail-local.c: Updates for CamelStore changes, small memory leak
	fixes.
	(lookup_folder): Removed (and moved into the reconfigure code)
	since this method no longer exists in CamelStore.
	(do_reconfigure_folder, etc): Update the info in the
	MailLocalStore after reconfiguring.
	(mail_local_lookup_folder): Removed

	* local-config.glade: fix padding of the label_format

	* message-list.c (ml_tree_value_at): Don't keep message infos
	reffed across calls, since this can cause badness after a
	reconfigure. Instead, just strdup the needed values and free those
	on the next call.

	* mail-tools.c (mail_tool_get_root_of_store): Unused, remove.
	(mail_tool_get_inbox): use camel_store_get_inbox.

	* evolution-outlook-importer.c (load_file_fn): 
	* evolution-mbox-importer.c (load_file_fn): Use
	mail_tool_get_local_inbox() instead of mail_importer_get_folder()

	* mail-importer.c (mail_importer_get_folder): Removed

2001-02-08  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (mail_generate_reply): New location for this
	function.

	* mail-format.c: Removed mail_generate_reply as it's ONLY ever
	used in mail-callbacks.c.

	* mail-ops.c (fetch_mail_fetch): Reworked some keep-mail-on-server
	logic so that we ALWAYS look for a cached array of UIDs that we
	may have downloaded previously so as not to download them again
	even if we will be deleting them off the server. This fixes bug
	#1344.

2001-02-09  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (filter_folder_free): only free driver, if set.
	(fetch_mail_fetched): Unref the driver here, so it can cleanup
	before we call the 'done' callback.

	* component-factory.c (owner_set_cb): Add setup for mail
	autoreceive stuff.

	* mail-send-recv.c (free_info_data): Free the send info's from teh
	active hash, not the running list.
	(receive_done): As we finish downloads, remove them and clean them
	up, and also close the window.
	(mail_autoreceive_setup): New function to setup & maintain
	automatic download stuff.

2001-02-08  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (construct): Set the sensitivity of the spin
	button based on the state of the checkbox.

	* mail-config.c (config_read): Properly do defaults here.
	(mail_config_write): Removed some of the settings being saved
	here.
	(mail_config_write_on_exit): Save those settings here instead.

2001-02-08  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-display.c (on_object_requested): Cast the CamelMedium to a
	CamelMimePart before performing actions on it as if it were a
	CamelMimePart.

	* mail-config-druid.c (druid_finish): Save the auto-check settings.
	(construct): Initialize auto-check widgets.
	(mail_config_druid_get_auto_check): New function
	(mail_config_druid_get_auto_check_minutes): New functions

	* mail-config.c (config_read): Read in whether or not to check
	every x minutes.
	(mail_config_write): Save auto-check config data and SSL.

2001-02-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-autofilter.c (rule_add_subject): Use "contains" because the
	subject might be broken into subparts and using the "is" rule will
	then fail ;-)

2001-02-08  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (mail_send_receive):
	(mail_receive_uri):  Init active_downloads hash if it hasn't been yet.

2001-02-07  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (operation_status): Handle internal camel status return.
	(receive_done): Remove active download when done.
	(mail_receive_uri): Initiate download of a single source, with no gui.
	(build_dialogue): Mark any new items as real active downloads.
	(do_show_status): Make the progress bar optional.

2001-02-06  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c: camel_cancel->camel_operation.

	* mail-ops.old.c: camel_cancel->camel_operation.

	* mail-ops.c: camel_cancel->camel_operation.

	* mail-mt.c: camel_cancel->camel_operation. 

	* mail-callbacks.c (stop_threads): camel_cancel->camel_operation.

	* mail-mt.h: CamelCancel->CamelOperation.

2001-02-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-mt.c (set_view_data): Check current_message for NULL - this
	fixes a bug running under SunOS (not a major deal tho as it's in a
	debug printf).

2001-02-06  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_write_on_exit): Oops, save the
	seen_timeout variable.

2001-02-06  Christopher James Lahey  <clahey@ximian.com>

	* Makefile.am (evolution_mail_LDADD): Added libmenus.la.

	* folder-browser-factory.c (control_activate): Added GalView menus
	here.

	* message-list.c, message-list.h (message_list_get_layout): Made
	message_list_get_layout export.

2001-02-06  Iain Holmes  <iain@ximian.com>

	* mail-display.c (pixbuf_gen_idle): Set the size of the icon to 24x24
	always.
	(button_press): Function to toggle the disposition of an attachment.
	(on_object_requested): New way to indicate functions on attachments.
	
	* message-list.c (hide_load_state): Free the olduid.

2001-02-06  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (set_defaults): Updated to checkfor
	"(none)".

	* mail-account-editor.c (entry_changed): Make sure the email
	address is valid.

	* mail-config-druid.c (identity_check): Check to make sure we have
	a valid email address.
	(is_email): New function to check a string to see if it's a valid
	email address.

2001-02-05  Jeffrey Stedfast  <fejj@ximian.com>

	* evolution-mbox-importer.c: We are now going to use a file
	descriptor and a CamelMimeParser rather than a FILE pointer.
	(load_file_fn): Open the file descriptor and initialize the
	CamelMimeParser.
	(importer_destroy_cb): Unref the mime parser.
	(support_format_fn): Use an fd and use a case-insensitive
	comparison as well as elimate a buffer overrun.
	(process_item_fn): Process 1 CamelMimeMessage per invocation so as
	to not lock up Iain's GUI and to work similar to the way Iain
	originally coded it.

2001-02-05  Christopher James Lahey  <clahey@ximian.com>

	* evolution-mbox-importer.c, evolution-mbox-importer.h: Moved
	bonobo includes from the .c to the .h.  Include
	evolution-mbox-importer.h in evolution-mbox-importer.c.

	* evolution-outlook-importer.c, evolution-outlook-importer.h:
	Moved bonobo includes from the .c to the .h.  Include
	evolution-outlook-importer.h in evolution-outlook-importer.c.

	* mail-callbacks.c: Include mail-send-recv.h.

	* mail-local.c (mail_local_lookup_folder): Cast local_store to
	CAMEL_STORE.

	* mail-mt.c (mail_msg_cleanup): Make this function static.

	* mail-send-recv.c, mail-send-recv.h: Created mail_send_recv.h.
	Included it in mail-send-recv.c.  Added a #include
	<libgnomeui/gnome-window-icon.h>.
	(mail_send_receive): Added a cast.

	* mail-summary.c (new_folder_cb, removed_folder_cb,
	create_summary_view): Cast the source func in calling g_idle_add.

2001-02-05  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (try_inline_pgp_sig): New function to handle
	inline pgp-signatures.

	* mail-config-druid.c (construct): Keep track of the CheckSettings
	check boxes.
	(transport_next): Connect if the user says so.
	(incoming_next): Same. Also, don't jump to the next page if
	test-settings fails.

2001-02-05  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (incoming_next): Updated to not connect when
	getting a list of authtypes.
	(transport_next): No longer connects - again, this is
	useless. Read the apply_changes argument for the reason why.

	* mail-account-editor.c (apply_changes): Updated. Set the
	'connect' argument to FALSE for now, this basically means that the
	call is worthless tho so it may be best to either get rid of the
	checks altogether or else make it connect.
	(source_auth_init): Don't connect here, it's just plain annoying.
	(transport_construct_authmenu): Same here.

	* mail-config.c (mail_config_check_service): Now takes a connect
	argument.

2001-02-03  Michael Meeks  <michael@helixcode.com>

	* mail-local.c (load_metainfo): Fix dodgy libxml allocation
	pollution, and potential faults on NULL attributes.

2001-02-02  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (mail_send_receive): Cleaned up so we dont add
	an unecessary level of indenting.

	* message-list.c (ml_tree_value_at): For collapsed tree nodes,
	scan the collapses nodes for the unread and status information.
	Since we dont really have fake nodes anymore.

2001-01-30  Ian Campbell  <ijc25@cam.ac.uk>
 
 	* message-list.c: Add support for new icons for being
 	read/unread for fake root messages on threads.
 
2001-01-30  Iain Holmes  <iain@ximian.com>

	* mail-send-recv.c (mail_send_receive): Only allow one send and
	receive to be running at once.
	(build_dialogue): Set the icon for the window.

	* evolution-mbox-importer.c (support_format_fn): Only compare the first
	5 bytes of the signature.

2001-01-30  Kjartan Maraas  <kmaraas@gnome.org>

	* folder-browser.c: Fix typo.
	
2001-01-29  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-importer.c (mail_importer_add_line): Cast the
	camel_stream_mem_new() to a CamelStreamMem.

2001-01-29  JP Rosevear  <jpr@ximian.com>

	* main.c: Return efence ifdefs to 0 for solaris build

2001-01-29  Not Zed  <NotZed@Ximian.com>

	* message-list.c (tree_equal): Debug function to compare the tree
	we think we have, after an incremental update.
	(build_tree): Check the tree after we've built it.
	(build_tree): Oops, turn on BROKEN_ETREE again.

	* mail-mt.c (mail_get_password): If we are being called from the
	main gui thread, then just call the dialogue directly.  Ideally we
	dont want this anyway but lets handle the case nicely.
	(mail_get_password): Try locking around the password request, to
	single-queue any password requests.
	(mail_msg_init): Push an exit handler to clean it up on completion.

	* mail-send-recv.c (receive_update_got_store): New function called
	when the store has been retrieved asynchronously.
	(mail_send_receive): Get the store asynchronously.  This was
	causing problems where the password dialogue would try and be
	called from the main thread via a message.

	* mail-ops.c (mail_get_store): New function to get a store
	(a)synchronously.  More or less taken from subscribe-dialog, which
	i will remove later.
	(mail_scan_subfolders): Try running the scan subfolder thing
	asynchronously, to help startup time.  Not sure if this will work,
	but presumably the shell can handle the folders appearing later
	ok.

2001-01-28  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (set_defaults): Turns out that I was wrong
	about the g_get_real_name mem leak, god damn glib for not
	following the const char* standard.

2001-01-28  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (management_prepare): Use UTF-8.
	(set_defaults): Use UTF-8 and also fixed a memory leak by freeing
	the string returned by g_get_real_name().
	(mail_config_druid_get_account_name): Use UTF-8.
	(mail_config_druid_get_full_name): Same.
	(mail_config_druid_get_email_address): Same.
	(mail_config_druid_get_organization): Same.

	* mail-account-editor.c (apply_changes): Save UTF-8 strings rather
	than gtk strings.
	(construct): Use the UTF-8 convenience functions to set the gtk
	entries for the ID fields.

2001-01-28  Ettore Perazzoli  <ettore@ximian.com>

	* mail-vfolder.c (vfolder_gui_add_rule): Make the OK button the
	default one.

	* mail-search-dialogue.c (mail_search_dialogue_init): Use stock
	buttons for OK and Cancel.  Make the OK button the default one.

2001-01-28  Ettore Perazzoli  <ettore@ximian.com>

	* mail-vfolder.c (vfolder_gui_add_rule): Set a default size for
	the window so that more rules are visible.

	* mail-search-dialogue.c (mail_search_dialogue_construct): Set a
	default size for the window so that more rules are visible.

2001-01-28  Not Zed  <NotZed@Ximian.com>

	* mail-display.c (write_data_to_file): Changed to use
	mail_save_part to save the data in another thread.
	(save_data_cb): Hide the fileselector once we have a button press,
	and are saving stuff.

	* mail-ops.c (mail_save_part): New function to save a part content
	asynchronously.

2001-01-27  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser.c (etable_key): Don't handle home and end keys
	since %ETable deals with them now.

2001-01-27  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (address_compare): Protect against NULL address
	pointers.
	(subject_compare): Same but for subject pointers.

2001-01-27  Iain Holmes  <iain@ximian.com>

	* mail-summary.c (create_summary_view): Applied patch from John R Sheets
	to fix some warnings.
	(idle_check): Fixed the prototype to fix some warnngs as well.

2001-01-26  Ettore Perazzoli  <ettore@ximian.com>

	* mail-display.c (get_embedded_for_component): Try a control
	first, instead of an embeddable.

2001-01-26  Jeffrey Stedfast  <fejj@ximian.com>

	* subscribe-dialog.c (populate_store_foreach): Check for a NULL
	service->url as we obviously can't subscribe to folders on a
	non-existant mail source :-)
	(subscribe_do_get_store): Check for a NULL url here too, not that
	we should need it anymore (due to the above fix) but it doesn't
	hurt. Also, should we wait on the thread? Probably doesn't matter.

2001-01-26  Iain Holmes  <iain@ximian.com>

	* evolution-outlook-importer.c (load_file_fn): Replace fsetpos with
	fseek and use a long instead of fpos_t.
	(process_item_fn): Same.

	* mail-importer.h: Add a frozen item to tell when the folder is frozen.

	* evolution-mbox-importer.c (process_item_fn): Fix the blank message.
	Set the frozen element.
	(importer_destroy_cb): Thaw the folder if frozen.

2001-01-26  Dan Winship  <danw@ximian.com>

	* mail-identify.c (mail_identify_mime_part): Fix an uninitialized
	variable use.

2001-01-26  Jason Leach  <jasonleach@usa.net>

	(Fixing an old FIXME)
	
	* component-factory.c (create_vfolder_storage): removing
	create_vfolder_storage, replacing call to it with
	vfolder_create_storage.

2001-01-26  Not Zed  <NotZed@Ximian.com>

	* message-list.c (build_tree): Define BROKEN_ETREE again, till we
	get this stuff fixed better.

2001-01-25  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c: Moved teh "sender contains" item to the end of
	the list, so the gui doesn't suddenly change on everyone.  Fixed
	the sender-contains search string to be a valid s-exp (ha, didn't
	test it even once eh ettore?!)
	(search_save): Dont have the sender contains as the default case
	(which well, never gets called anyway), oops i guess i should've
	reviewed the patch a little more.

2001-01-26  Ettore Perazzoli  <ettore@ximian.com>

	* folder-browser.c: Add a missing parenthesis to the "from
	contains" rule.  Also make it the last item instead of the first
	one.

2001-01-25  Iain Holmes  <iain@ximian.com>

	* component-factory.c (component_factory_init): Init the mail
	mail importers.

	* mail-local.[ch] (mail_local_lookup_folder): retrieve the local
	folder given by the name.

	* mail-importer.[ch]: Basic functions for all importers to use.

	* evolution-mbox-importer.[ch]: Mbox importer.

2001-01-25  Jeffrey Stedfast  <fejj@ximian.com>
	The following fixes seem to clear up the problem of new mail not
	being shown in the Inbox and/or other folders where mail had been
	delivered.

	* mail-send-recv.c (build_dialogue): Freeze the inbox.
	(receive_get_folder): Freeze folders before dumping them into the
	hash table.
	(free_folder_info): Thaw the folder.
	(free_info_data): Thaw the Inbox.

2001-01-25  Jason Leach  <jasonleach@usa.net>

	(Don't prompt about unsaved changes for replies/forwards that have
	 not actually been modified)
	
	* mail-callbacks.c (do_forward_inline): Unset the has_changed for
	the message composer.
	(do_forward_attach): Same here.
	(mail_reply): And here.

2001-01-25  Dan Winship  <danw@ximian.com>

	* mail-format.c (mail_content_loaded): Check if a message part's
	content is available, and if it's not, queue a thread that will
	load it and then queue an idle-handler redisplay of the message.
	(call_handler_function): Call mail_content_loaded() on the part
	and don't try to display it if it's currently offline.
	(get_data_wrapper_text): Simplify a bit

	* mail-display.c (mail_display_queue_redisplay): rename and make
	non-static.
	(mail_display_redisplay): Use a "new and improved" way of
	preserving the GtkHTML scroll location. ("new and improved" is
	code for "gross and hackish", but there should be a real interface
	for this eventually.)
	(on_url_requested): Use mail_content_loaded() and don't write out
	offline cid: URLs

	* mail-identify.c (mail_identify_mime_part): Use
	mail_content_loaded and don't try to identify the data if it's
	offline.

2001-01-25  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Made the message list pay attention to the
	"cursor_activated" signal instead of the "cursor_change" signal.

2001-01-25  Ettore Perazzoli  <ettore@ximian.com>

	* folder-browser-factory.c (update_pixmaps): Set the print icon
	for various other items.
	(set_pixmap): Be a bit more verbose in the warning message if the
	icon isn't found [i.e. report the name of the file too].

2001-01-25  Ettore Perazzoli  <ettore@ximian.com>

	* folder-browser-factory.c (update_pixmaps): Set the pixmaps for
	the "/menu/Folder/FolderConfig" and "/menu/Settings/SetMailConfig"
	items.
	(set_pixmap): Don't prepend the "buttons" prefix.
	(update_pixmaps): Update accordingly.

2001-01-24  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c (search_string[]): Fix the subject match
	expression, which was missing a closing ).

	* mail-send-recv.c (do_show_status): Escape any % signs in the
	string before setting the format string.

2001-01-24  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.glade: Added a 3rd page to the account editor to
	allow users to set their HTML sending preference and also allow
	them to change their message status timeout.

	* mail-accounts.c (construct): Added handlers for the send-html
	checkbox and for the mark-message-as timeout spinbutton.

2001-01-23  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (apply_changes): Save the source and
	transport changes whether the user can connect to the host or not.

2001-01-23  Ettore Perazzoli  <ettore@ximian.com>

	[Applied patch from Tuomas Kuosmanen <tigert@ximian.com>]

	* folder-browser.c: Added enum value `ESB_SENDER_CONTAINS' as well
	as a "Sender contains" item to the search menu.  Also add a
	corresponding "(match-all)" rule to the `search_string' array.
	(search_save): Handle `ESB_SENDER_CONTAINS' here.

2001-01-23  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.oafinfo: Fixed the repo_ids so that they
	use the right syntax.

2001-01-23  Dan Winship  <danw@ximian.com>

	* folder-browser-factory.c: 
	* mail-callbacks.c (send_receive_mail): Fix spelling.

2001-01-24  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (fetch_mail_fetch): Set the default folder when
	copying to mbox.  This is a quick fix, i might need to do a slight
	redesign to clean it up.

2001-01-23  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-send-recv.c (build_dialogue): Make sure the source->url is
	not NULL (which is perfectly valid).
	(mail_send_receive): Where oh where should my prototype be?
	(receive_get_folder): Make sure to ref the folder before you add
	it to the hash table.

	* openpgp-utils.c:
	* mail-crypto.c: A few minor tweaks.

2001-01-23  Not Zed  <NotZed@Ximian.com>

	* message-list.c (build_tree): Try turning off the BROKEN_ETREE
	thing.  It seems to work ok (better?) now, but if its still broken
	i'll remove it again for the next release.

2001-01-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (set_defaults): Automagically fill in the
	user's default transport if he/she has setup previous accounts.

	* mail-format.c (handle_multipart_signed): Just wrote a temp way
	of reporting success/fail of PGP/MIME signature verification
	status.

2001-01-22  Iain Holmes  <iain@ximian.com>

	* evolution-outlook-importer.c: Outlook Express 4 .mbx importer.

	* component-factory.c (component_factory_init): initialise the
	outlook importer.

	* GNOME_Evolution_Mail.oafinfo: Add the details for the Outlook
	importer.

2001-01-22  Dan Winship  <danw@ximian.com>

	* mail-mt.[ch]: make mail_gui_thread non-static.

	* main.c (main): Set up signal handler for SEGV, BUS, FPE
	(segv_redirect): if a gnome-segv'ing signal is received in
	a thread other than mail_gui_thread, re-deliver it to that
	thread to work around a problem with the gnome segv handler.

2001-01-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (handle_multipart_signed): Fixed to display
	subparts (other than the signature part) and started to write a
	pretty way to show if the signature verified or not.

2001-01-23  Not Zed  <NotZed@Ximian.com>

	* mail-crypto.c (pgp_mime_part_verify): Fix a double-free problem.

2001-01-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (incoming_type_changed): Oops, danw didn't
	know 'provider' could be NULL :-)

2001-01-22  Dan Winship  <danw@ximian.com>

	* mail-config-druid.c (incoming_type_changed): Change "Path:"
	label to "Namespace:" for IMAP. Use $MAILDIR rather than $MAIL for
	Maildir. If $MAIL isn't set, guess.

	* component-factory.c (mail_hash_storage): Function to add a
	store/storage mapping.
	(add_storage): Use it.

	* mail-vfolder.c (vfolder_uri_to_folder): Use the vfolder name
	rather than the string "mbox" (which wasn't ever used for
	anything) in the vfolder URL. (Combined with the CamelVeeFolder
	change, this makes camel_folder_get_name() return a pretty name
	for vfolders now.) Call mail_hash_storage() to record the
	CamelVeeStore/vfolder_storage mapping. (Ideally, there'd only be a
	single CamelVeeStore... this is just a quick hack.)

	vfolders now display their unread count once you've looked at them
	once.

2001-01-22  Dan Winship  <danw@ximian.com>

	* mail-tools.h: s/filter-driver.h/camel-filter-driver.h/ and
	update first arg of mail_too_filter_get_folder_func

	* mail-tools.c (mail_tool_filter_get_folder_func): Update first
	arg to CamelFilterDriver *

	* mail-send-recv.c (receive_status): 
	* mail-ops.c (send_queue_send): s/FILTER/CAMEL_FILTER/

	* mail-callbacks.c: Remove filter-driver.h include

	* mail-accounts.c: Put the news functions inside #ifdef
	ENABLE_NNTP to prevent warnings about unused statis functions.

	* subscribe-dialog.c (subscribe_folders, unsubscribe_folders,
	subscribe_refresh_list): Update prototype to match BONOBO_UI_VERB. 
	(populate_store_list): add a de-constifying cast

2001-01-22  Not Zed  <NotZed@Ximian.com>

	* .cvsignore: Added temp profiling files.

	* component-factory.c (owner_set_cb): remove a warning with
	conditional news compilation.

	* mail-ops.h: Cleaned up the header list.
	
2001-01-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c (mail_crypto_is_rfc2015_signed): Helps if I spell
	stuff correctly so it can pass the tests ;-)

2001-01-22  Not Zed  <NotZed@Ximian.com>

	* folder-browser-factory.c: Replace the old get_send mail with the
	new one (button).

	* mail-ops.c (set_x_mailer): 
	(mail_load_evolution_rule_context): 
	(mail_do_fetch_mail): 
	(mail_do_filter_ondemand): 
	(mail_send_mail_old): 
	(mail_do_send_queue): All removed, (for) now lives in mail-send-recv.c.
	(load_context): 
	(setup_filter_driver): 
	(filter_get_folder): 
	(mail_filter_folder): 
	(mail_fetch_mail): 
	(mail_update_subfolders): 
	(mail_send_mail): 
	(mail_send_queue): New equivalents of all these fundtions, moved
	from mail-send-recv.c ...
	(mail_filter_on_demand): Moved here too.
	(mail_load_filter_context): Export this.

	* mail-callbacks.c (apply_filters): Use the new
	mail_filter_on_demand() call.
	(send_receieve_mail): Use mail_send_receive to do the work.  Add a
	little error handling here that used to be elsewhere.
	(send_queued_mail): Removed.
	(fetch_mail): Removed.
	(select_first_unread): #ifdef'd this out.  Not sure if this still
	makes sense, but it doesn't get run right now anyway.
	(composer_postpone_cb): Fix the setting of message flags.  You
	dont need to get them first, ever.

	* mail-send-recv.c (mail_send_message): Dont use
	mail_tool_send_via_transport anymore (it does nothing useful).

	* mail-tools.c (mail_tool_camel_lock_up): Turned into a noop.
	(mail_tool_camel_lock_down): And here too.
	(mail_tool_move_folder_contents): Removed from the code (hasn't
	bene used for ages).
	(mail_tool_send_via_transport): Removed, it doesn't save anything.

2001-01-21  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c (owner_set_cb): Initialize OpenPGP.

	* openpgp-utils.c (openpgp_init): No longer takes a passphrase
	callback, we'll just use the mail-session one. Makes life simpler.
	(pgp_get_passphrase): Use mail_session_request_dialog().

	* mail-ops.c (do_send_queue): Remove the X-Evolution header before
	we send.

	* mail-crypto.c (pgp_mime_part_sign): Don't forget to unref the
	filters.
	(pgp_mime_part_verify): Same.
	(pgp_mime_part_encrypt): Same.
	(pgp_mime_part_decrypt): Take NotZed's advice and use
	camel_stream_mem_new_with_buffer instead of writing to a new
	stream_mem. Also use camel_data_wrapper_construct_from_stream
	instead of creating a parser and using that.

2001-01-21  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c: Updated header comment and fixed some ref/unref
	count problems in the various functions. Also fixed some other
	little things.
	(pgp_mime_part_encrypt): Do some canonical CRLF action before
	encrypting.
	(pgp_mime_part_sign): Make sure we are the owners of the byte
	array.
	(pgp_mime_part_verify): Same.
	(pgp_mime_part_encrypt): Same.
	(pgp_mime_part_decrypt): Same.

2001-01-21  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (message_list_get_layout): Added
	draw-focus="true" and selection-mode="browse" attributes to the
	ETableSpecification.
	(message_list_construct): Removed setting the "draw_focus"
	argument since it doesn't exist any more.

2001-01-21  Not Zed  <NotZed@Ximian.com>

	* mail-mt.c (mail_msg_new): Init a cancel field in the message.
	(mail_msg_free): Free it.
	(mail_msg_cancel): New function to attempt to cancel an operation
	by id.  Impelementation functions can still be uncancellable by
	not registering for cancellation, etc, or do it themselves as
	well.

	* mail-send-recv.c (fetch_mail_filter_folder): set folder_uid's
	properly, so we can save it later.
	(filter_folder_filter): Renamed from fetch_mail_filter_folder,
	since its going to be used for all filtering.
	(mail_fetch_mail): Changed from mail_filter_mail.
	(mail_filter_folder): New function, replaces
	mail_do_filter_ondemand functionality.
	(mail_filter_on_demand): New function, actually replaces
	mail_do_filter_ondemand.
	(receive_get_folder): Added an exception arg.
	(mail_send_message): New function to just send a message.
	(send_mail_send): Use mail_send_message.
	(send_queue_send): New send qeue code, use mail_send_message, and
	clean up some stuff.
	(mail_send_receive): Changed from mail_receive.
	(build_dialogue): Setup the sending data, as well.
	(mail_update_subfolders): New function to update folder info.
	(send_mail_send): hook into cancellation if we want.

2001-01-20  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (do_send_queue): Strip leading space from the
	transport url gotten from the message.

2001-01-19  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (mail_generate_reply): If the name is empty
	string, use the address.

2001-01-19  Dan Winship  <danw@ximian.com>

	* mail-display.c (pixmap_press): Update for e_popup_menu_run
	change.

	* folder-browser.c (etable_key): On GDK_Menu (the menu key on
	105-key keyboards), pop up the right-click menu.
	(on_right_click): update for e_popup_menu_run change.
	
	* subscribe-dialog.c (recursive_add_folder): New function to add a
	folder and any parents of it that don't yet exist. Fixes bugzilla
	#1028.

2001-01-19  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c: New swanky send/recieve thingy, well it so far
	only receives (pop/mbox).  Ignore all the warnings for now, and
	the ugly 'button' to run it.

2001-01-18  Jeffrey Stedfast  <fejj@ximian.com>

	* folder-browser-factory.c: Added the next/previous toolbar
	buttons.

	* mail-callbacks.c (next_msg): New callback so we can have a next
	toolbar button.
	(previous_msg): Same but for previous.

2001-01-17  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (construct): Anna's dialog now supports
	SSL so we can get rid of the ssl-support checks. Also work around
	the fact that Anna's dialog doesn't have an optionmenu for the
	transport type, it's a label instead.
	(transport_type_init): Cast the transport_type widget to a
	GtkOptionMenu where appropriate as the widget that stores it is
	now generic.
	(apply_changes): Modify code to work with anna's dialog...*sigh*
	(ok_clicked): Alert the user that one or more servers failed to
	validate and allow him to continue anyway.

2001-01-17  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_set_pgp_path): New config function to
	set the path to the pgp binary.
	(mail_config_get_pgp_path): Gee I wonder...
	(mail_config_set_pgp_type): This one sets the type (ie PGP5, PGP2,
	or GnuPG - see openpgp-utils.h for values)
	(mail_config_get_pgp_type): Der.

2001-01-17  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (construct): Handle NULL source and, while
	we're at it, transport URLs. Apparently camel_url_new() and/or
	camel-url_free() don't handle NULL input well.

	* mail-accounts.c (load_accounts): Handle NULL source URLs.

2001-01-17  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (construct): Oops. "url && url->host"
	doesn't do much without the '?' and ':' ;-)

2001-01-17  Ettore Perazzoli  <ettore@ximian.com>

	* mail-ops.c (set_x_mailer): New function.
	(send_mail_send): Use it.
	(do_send_queue): Use it.

2001-01-17  Martin NorbÃ¤ck  <d95mback@dtek.chalmers.se>

	* openpgp-utils.c (pgp_get_passphrase): Changed the word entry
	to enter, which is the correct word to use.

2001-01-17  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (ask_confirm_for_empty_subject): Update to use
	EMessageBox and to record if the user doesn't want to ever see
	this dialog again.

	* mail-config.c (mail_config_get_prompt_empty_subject): New config
	function.
	(mail_config_set_prompt_empty_subject): Another new one.

2001-01-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (apply_changes): Modify to be able to
	handle a NULL source_url.
	(source_auth_init): Allow for a NULL source url.
	(source_check): Same.

	* mail-config.c (mail_config_write): Allow for NULL source
	URLs. And while we're at it, NULL transport URLs as well. Might as
	well save the use_ssl variable too.
	(config_read): Same.

	* mail-config-druid.c (druid_finish): Modify to allow a NULL
	source url.
	(incoming_next): Modify to check for a NULL source and jump to the
	transport page if one is encountered (this means the user decided
	not to config a source).
	(incoming_type_changed): Modify to set all widgets insensitive if
	the user selected the "None" source menu item (aka NULL provider).
	(incoming_check): Modify to allow the user to go to the next page
	when he/she has chosen "None" for their source type.
	(mail_config_druid_get_source_url): Return NULL if the provider is
	NULL.
	(mail_config_druid_get_transport_url): Same.

2001-01-16  Dan Winship  <danw@ximian.com>

	* mail-display.c (on_object_requested): Don't do thumbnails for
	offline images

2001-01-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (save_msg_ok): If the user hits "No", then
	don't destroy the filesel window.

	* mail-ops.c (save_messages_save): Open with mode 0666 as danw
	suggests.

2001-01-16  Chris Toshok  <toshok@helixcode.com>

	* component-factory.c (owner_set_cb): only load the news storage
	if ENABLE_NNTP.

	* mail-accounts.c (construct): if !ENABLE_NNTP, remove the news
	page from the dialog.

2001-01-16  Radek Doulik  <rodo@helixcode.com>

	* mail-format.c (mail_generate_reply): use
	e_msg_composer_mark_text_orig

2001-01-16  Dan Winship  <danw@ximian.com>

	* mail-ops.c (send_mail_send, do_send_queue): Update the X-Mailer
	header to use the string specified by configure.

2001-01-16  Jason Leach  <jasonleach@usa.net>

	* subscribe-dialog.c: removed unecessary #inlcude "e-title-bar.h"

2001-01-16  Jason Leach  <jasonleach@usa.net>

	* openpgp-utils.c (pgp_get_passphrase): Fix a string causing
	translation problems.  Bug #1147.

2001-01-16  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (mail_do_fetch_mail): Setup a cancellation handle.
	(do_fetch_mail): REgister for cancellation here.
	(cleanup_fetch_mail): And unregister for cancellation here.
	(mail_get_message): Add a cancel handle.
	(get_message_get): Register/deregister for cancel.
	(get_message_free): & clean up.

	* mail-mt.c (mail_msg_received): Removed debuggng.

	* mail-callbacks.c (stop_threads): Callback for stopping.

	* folder-browser-factory.c: Add a stop button verb thingy.
	(control_activate): Disable the stop button by default.

2001-01-15  Christopher James Lahey  <clahey@ximian.com>

	* message-list.c, message-list.h: Change from using filters for
	date and size to using e_cell_date and e_cell_size.  Moved a bunch
	of includes from the message-list.h to the message-list.c.

2001-01-15  Miguel de Icaza  <miguel@ximian.com>

	* mail-callbacks.c (configure_mail): Set the default button to
	`Yes' here. 

2001-01-13  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (source_auth_init): If the preferred
	authmech isn't found, default to the first one in the list.
	(transport_construct_authmenu): This function already did the
	above but I made it simpler.
	(apply_changes): A number of cleanups.

2001-01-13  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (druid_finish): Fixed mail_load_storages to
	make a mini GSList of the account, not the account->source. Oops.

	* mail-accounts.c (news_delete): Updated to use the remove_news()
	function.

	* mail-config.c (mail_config_remove_news): New convenience
	function for removing news accounts.
	(mail_config_remove_account): Pretty much the same thing.

	* mail-ops.c (do_send_queue): Get the X-Evolution-Transport URL
	and use that if it exists, else fall back on the default
	transport.

	* mail-callbacks.c (composer_postpone_cb): Set an
	X-Evolution-Transport header.

2001-01-12  Jeffrey Stedfast  <fejj@ximian.com>

	* Makefile.am: Removed GPG_* variables.

	* component-factory.c (mail_load_storages): Now takes a
	'is_account_data' variable to specify whether the sources is a
	list of accounts of a list of services. Basically, the only time
	you should pass in FALSE is when you are setting up NNTP storages.
	(add_storage): Now takes a 'name' argument that specifies the name
	to use in the storage.
	(owner_set_cb): Updated to pass TRUE for accounts and FALSE for
	news servers into mail_load_storages.

2001-01-12  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Changed filter_date and filter_size to match the
	changes in gal.

2001-01-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.glade: Anna's dialogs.

	* mail-config.c (mail_config_get_account_by_address):
	Removed. Danw and I decided on setting a X-Evolution-Transport
	header on messages going to the Outbox so we can later guess which
	transport to use when sending it.

	* mail-account-editor.c (apply_changes): Update to some day be
	able to support SSL.
	(construct): Update for Anna's dialogs...

	* subscribe-dialog.c (populate_store_list): Updated to reflect
	past changes to the mail-config API.

2001-01-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (composer_send_cb): Get the account by using
	the new e_msg_composer_get_preferred_account() function. Also
	check to make sure everything is configured (in case they deleted
	their accounts while composing mail?).

	* mail-config.c (mail_config_get_account_by_address): New
	convenience function.

2001-01-12  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (component_fn): Pass NULL as the
	@copy_folder_fn arg to `evolution_shell_component_new()'.

	* folder-browser.c (on_right_click): Removed hide menu.  It
	belongs to the view menu now.

2001-01-12  Miguel de Icaza  <miguel@ximian.com>

	* message-list.c: Add strings for localization

	* folder-browser.c: Rename "Save" to "Store search as vFolder".

2001-01-11  Miguel de Icaza  <miguel@gnu.org>

	* mail-display.c (on_object_requested): Unref the property bag
	when we are done with it.
	(get_embedded_for_component): Moved the code to request the
	embeddable/control to a separate function.

2001-01-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_get_account_by_name): New convenience
	function that I will need later when I redo the composer From
	field.

	* mail-display.c (on_object_requested): Update to reflect past
	changes to the mail-config API.

	* session.c (mail_session_set_password): strdup() the key.

	* mail-config-druid.c (construct): We don't want to be able to set
	the reply-to in the config druid.
	(druid_finish): Don't set a reply-to anymore.
	(mail_config_druid_finalise): Don't unref the providers.

	* mail-config.glade: Took out the Reply-To field in the druid.

2001-01-11  Miguel de Icaza  <miguel@gnu.org>

	* mail-config-druid.c (incoming_type_changed): Guess the default
	MAIL value for MBOX and Maildir files.

	* mail-callbacks.c (configure_mail): Force finalization of the
	function before returning fixing the FIXME that was there.

2001-01-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c (transport_next): If the service_check
	fails, pop-up a warning dialog letting the user know he or she may
	have problems and then let them continue on with their lives.
	(incoming_next): Same (+ jump them over the auth page to the
	transport page).

	* mail-account-editor.c (apply_changes): Eek! Don't destroy the
	account if the connection fails, duh. This is what is causing the
	segfaults.

2001-01-11  Dan Winship  <danw@ximian.com>

	* folder-browser.c (got_folder): Connect to folder_changed as well
	as message_changed for updating unread count

2001-01-10  Miguel de Icaza  <miguel@helixcode.com>

	* GNOME_Evolution_Mail.oafinfo: Add Bonobo/ItemContainer as the
	set of supported interfaces in GNOME_Evolution_Mail_Composer
	component.

2001-01-11  Dan Winship  <danw@ximian.com>

	* mail-format.c (write_field_to_stream): Translate the header name
	to UTF8.

2001-01-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (configure_mail): New function that explains to
	the user why he can't do the action he requested and then procedes
	to ask if he'd like to configure his accounts now.
	(check_send_configuration): If the user doesn't have configured
	accounts, don't let him continue and call configure_mail().
	(fetch_mail): Same.
	(send_queued_mail): Same.
	(send_receieve_mail): Same.

	* mail-config.c (mail_config_write): Don't save a "is_configured"
	variable. Instead we'll just check to see if we have accounts - if
	yes, then configured == TRUE.
	(mail_config_is_configured): return accounts != NULL.
	(mail_config_get_default_account): Mark the first account as the
	default if none are marked.

2001-01-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-account-editor.c (source_auth_type_changed): Set the
	sensitivity of the Password label too.

	* mail-config-druid.c (transport_back): New callback to handle
	when the user hits the "back" button when on the transport
	page. This is needed to handle the case where we don't want to
	show the user the auth page (due to there being no auth choices).
	(incoming_next): If we are going to skip over the auth page, set
	the 'have_auth_page' variable to FALSE.
	(construct): Initialize the have_auth_page to TRUE.

2001-01-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c (incoming_type_changed): Grab the focus of
	the first widget that is sensitive.
	(transport_type_changed): Same.
	(identity_prepare): Grab the focus of the name entry.

	* mail-callbacks.c (send_queued_mail): Prevent Federico's segfault.

2001-01-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c (auth_type_changed): Clear the password
	entry if it's not allowed.
	(transport_type_changed): Clear the hostname if it is not allowed
	by the provider type.

	* mail-account-editor.c (transport_type_changed): If the hostname
	is allowed, clear it.

	* mail-config-druid.c (incoming_type_changed): Clear the contents
	of the entry boxes that are not to be used.
	(mail_config_druid_get_source_url): If the text in the entry is
	emptry string, don't set it' contents in the url.

2001-01-10  Miguel de Icaza  <miguel@helixcode.com>

	* mail-callbacks.c (print_msg): Fix proto.
	(print_preview_msg): Fix proto.

	* subscribe-dialog.c: Remove more UNSAFE macros.

2001-01-09  Jason Leach  <jasonleach@usa.net>

	* mail-display.c (pixmap_press): Bugfix for #1077: scrollwheel
	doesn't work while hovering over an attachment icon.

2001-01-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.glade: Moved to mail-config.glade

	* mail-accounts.c (construct): Updated to use mail-config.glade.

	* mail-account-editor.c (construct): Updated to use
	mail-config.glade.

	* mail-config-druid.c (construct): Updated to use
	mail-config.glade.

	* mail.h: Added the new mail config headers.

2001-01-09  Dan Winship  <danw@helixcode.com>

	* mail-local.c (local_folder_changed_proxy): Change
	mail_op_forward_event to mail_proxy_event.

2001-01-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (save_messages_save): Let the system umask determine
	the permissions of this file.

	* mail-config-druid.c (incoming_type_changed): Gray out the
	appropriate labels too.
	(auth_type_changed): And here.
	(transport_type_changed): Here too...

	* mail-account-editor.c (source_check): Gray out the appropriate
	labels too.
	(transport_type_changed): And here too.

2001-01-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-account-editor.c: For all optionmenu's, set the appropriate
	'history'.
	(keep_mail_check): Set the keep-on-server checkbutton sensitivity
	based on whether or not the store is a storage or not.
	(construct): Call keep_mail_check().

	* mail-config-druid.c (incoming_type_changed): Set the
	keep-on-server checkbutton sensitivity based on whether or not the
	store is a storage or not.

	* mail-accounts.c (construct): Make sure the dialog isn't a
	scrunched little thingy.

2001-01-09  Dan Winship  <danw@helixcode.com>

	* Makefile.am (evolution_mail_LDFLAGS): Add -export-dynamic, so
	libglade can resolve evolution-mail symbols.

2001-01-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c: Updated.
	(decode_pgp): Get rid of #ifdef PGP_PROGRAM's and handle
	appropriately.
	(handle_multipart_signed): Same.
	(handle_multipart_encrypted): Same.

	* Makefile.am: Added openpgp-utils.[c,h] to the build.
	
	* openpgp-utils.c: New source file containing all of the pgp
	interface code.

	* mail-crypto.c: Removed all of the openpgp funtions as they are
	being moved to a new file.
	(mail_crypto_is_rfc2015_signed): Renamed.
	(mail_crypto_is_rfc2015_encrypted): Renamed.

2001-01-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* session.c (mail_session_set_password): New function to set the
	password for a given url.
	
	* mail-config-druid.c (druid_finish): Don't save the password in
	the source url, instead insert it into the save-password hash.
	(mail_config_druid_get_source_url): Check to make sure the
	authmech isn't "", if it is then don't set the authmech.

	* mail-account-editor.c (apply_changes): Don't save the password
	in the source url, instead insert it into the save-password
	hash. Also check to make sure we don't set an empty string as the
	authmech for the source or transport.
	
	* mail-accounts.c (mail_default): After reloading the accounts,
	reselect the previously selected account.
	(mail_delete): Same.

	* mail-config-druid.c (druid_cancel): Fixed segfault bug.

2001-01-09  Radek Doulik  <rodo@helixcode.com>

	* mail-format.c (write_headers): remove </center><p>
	(handle_text_plain): add <font size=\"-3\">&nbsp</font><br> before
	msg text
	(handle_text_plain_flowed): ditto

2001-01-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-accounts.c (mail_default): Write the config data and reload
	the accounts list so the "default" tag is relocated.
	(mail_delete): Write the config data here too.

2001-01-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* Makefile.am: 
	* component-factory.c: 
	* folder-browser-factory.c:
	* folder-browser.c: 
	* mail-accounts.[c,h]:
	* mail-account-editor.[c,h]:
	* mail-callbacks.c: 
	* mail-config.[c,h]: 
	* mail-config-druid.[c,h]:
	* mail-config-druid.glade:
	* mail-display.c: 
	* mail-format.c: 
	* mail-tools.c: Brand spankin' new config druid, editor, 
	and manager.

2001-01-08  Dan Winship  <danw@helixcode.com>

	* mail-ops.c: Add an #include <errno.h>

2001-01-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* Makefile.am: 
	* component-factory.c: 
	* folder-browser-factory.c:
	* folder-browser.c: 
	* mail-callbacks.c: 
	* mail-config.[c,h]: 
	* mail-display.c: 
	* mail-format.c: 
	* mail-tools.c: Reverted mail-config changes temporarily until 
	I get it working correctly.

2001-01-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c: More lovely fixes...

	* mail-callbacks.c: Don't segfault if a default account doesn't
	exist.

2001-01-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c: A bunch of fixes.

	* mail-accounts.c: More fixes...

	* mail-account-editor.c (construct): Reparent the notebook to the
	editor->vbox and set the resize policy.

2001-01-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (providers_config): Use a
	gnome_dialog_run_and_close().

	* mail-accounts.c (construct): Reparent the notebook to the
	dialog->vbox not to the dialog itself. Also set the resize policy
	to allow the user to stretch it.

2001-01-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-tools.c (mail_tool_quote_message): Updated to reflect
	changes to the mail-config API.

	* mail-display.c (redisplay): Updated to reflect changes to the
	mail-config API.

	* mail-callbacks.c (providers_config): Use the new account dialog.

	* mail-config-druid.c (druid_finish): Load the new storage into
	the shell.
	(mail_config_druid_new): Take a shell argument.

	* mail-format.c (mail_generate_reply): Updated to reflect changes
	to the mail-config API.

	* mail-config-druid.c: Fixed this to build.

	* mail-callbacks.c (check_send_configuration): Updated to reflect
	changes to the mail-config API.
	(create_msg_composer): Same.
	(forward_get_composer): Same.
	(send_queued_mail): Same.
	(composer_send_cb): Same.

	* mail-account-editor.c: Updated to build cleanly.  *
	mail-config-druid.c: Same.  * mail-accounts.c: Same.

	* folder-browser-factory.c (control_activate): Updated for API
	changes in mail-config.

	* folder-browser.c (done_message_selected): Updated for API
	changed in mail-config.
	(folder_browser_gui_init): Same.
	(got_folder): Same.

	* component-factory.c (owner_set_cb): After using the sources
	list, free it as it is no longer a const GSList as with the older
	mail-config code.

	* mail-config.c: Totally rewritten.

2001-01-07  Jeffrey Stedfast  <fejj@helixcode.com>
	
	* mail-accounts.c (mail_edit): Implemented.

	* mail-account-editor.c (apply_clicked): Implemented.
	(ok_clicked): Implemented.
	(cancel_clicked): Implemented.
	(source_auth_type_changed): Implemented.
	(source_auth_init): Implemented.
	(transport_construct_authmenu): Implemented.
	(transport_type_changed): Updated to change regenerate the auth
	option menu.
	(construct): Attached callbacks to OK, Apply and Cancel buttons.

	* mail-account-editor.c (source_auth_init): Use the new
	mail_config_check_service().

	* mail-config-druid.c: Remove check_service() as it will be moved
	into mail-config.

2001-01-06  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (message_list_select): Made it so that going to
	the next or previous message in the list will at least move one
	message, even if the current message matches the query.  This
	makes 'n' go to the next unread message, even if the current
	message is unread.

2001-01-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-account-editor.c: Coded a bunch of the methods.

2001-01-04  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (idle_check): Check if the HTML for the current
	summary has been created, and if not then keep trying until it
	has.
	(new_folder_cb)
	(removed_folder_cb)
	(create_summary_view): Use the idle_check function to generate the
	summary.
	(create_summary_view): Don't set the HTML here. Set it via the
	pipe.

2001-01-05  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-account-editor.[c,h]: New source files to provide an
	account editor widget.

	* mail-config-druid.c (auth_type_changed): Set the authproto on
	the druid so we can look it up later.

2001-01-05  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-accounts.c (mail_add): Since the druid now handles adding
	the new account to the config, we'll just connect to the destroy
	event and show the druid.
	(mail_add_finished): Just reload the account list here.

	* mail-config-druid.c (druid_finish): New callback to handle the
	"finish" signal. On second thought, it seems it would be best for
	the finish callback to be here rather than in mail-accounts.c.

	* mail-accounts.[c,h]: Added. Contains source for the Account manager
	window. And just like mail-config-druid.c, it's not yet complete.

	* mail-config-druid.c (mail_config_druid_get_incoming_keep_mail):
	Renamed from _delete_mail
	(mail_config_druid_get_transport_url): New convenience function
	that replaces the get_hostname, get_protocol, etc.
	(mail_config_druid_get_source_url): Same.

	* mail-config-druid.glade: Changed "Delete mail from server" to
	"Keep mail on server" as this has a more positive ring to it. Both
	I and Aaron agree this is the better phrase.

2001-01-04  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c: Fixed a few 'Oops'es.

	* mail-config-druid.glade: Added a "Default" button for marking an
	account as the default.

2001-01-04  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.glade: Updated. What else can I say?

2001-01-04  Dan Winship  <danw@helixcode.com>

	* folder-browser.c (got_folder): Connect to "message_changed" on
	the folder if it's on a remote storage.
	(update_unread_count): Update the folder unread count / highlight
	in the shell when the unread message count changes

2001-01-04  Not Zed  <NotZed@HelixCode.com>

	* mail-ops.c (mail_do_send_mail): Removed old implementation.

	* folder-browser.c (do_message_selected): If we haven't got a real
	uid, then clear the display instead.

	* message-list.c (message_list_drag_data_get): Use new save
	message function, and also wait for it to finish before
	continuing.
	(folder_changed): 
	(message_changed): Use mail_proxy_event instead of
	mail_do_forward.
	(mail_regen_list): New iplementation to replace the old.
	: remove <gnome.h> from headers.  Dont define timeit by default.
	(main_folder_changed): 
	(message_list_set_folder): 
	(message_list_set_threaded): 
	(message_list_set_search): 
	(message_list_hide_add): 
	(message_list_hide_uids): 
	(message_list_hide_clear): Use mail_regen_list instead of
	mail_do_regenerate_messagelist.
	(mail_do_regenerate_messagelist): Removed the old stuff.  No
	functionality changed yet, just using different thread stuff.

	* mail-callbacks.c (save_msg_ok): Use new save message function.

	* component-factory.c (create_view):
	(add_storage): Use mail_scan_subfolders to build the folder info.
	(create_folder): Use new implementation with our own callback.
	(owner_set_cb): Changed b ack to use mail_get_folder, but now wait
	for it to finish.  This will let any gui still run, but also gives
	us the required synchronous operation.
	(got_folder): Callback for when the folder has been opened.

	* mail-ops.c (mail_get_folderinfo): New function to just get the
	folder info in another thread.
	(mail_scan_subfolders): New scan subfolder implementation that
	uses mail_get_folderinfo.
	(mail_do_scan_subfolders): Removed old implementation.
	(mail_create_folder): Nerw implementation to create a folder, only.
	(mail_do_create_folder): Removed old implementation.
	(mail_save_messages): New implementation, fixes a couple of minor
	problems, and now provides a return so it can be waited on.  Also
	check that the writes worked, etc.
	(mail_do_save_messages): Remove previous implementation.
	(mail_do_flag_messages): Removed, nothing uses it.
	(mail_do_flag_messages): Removed, nothing uses it anymore.
	(mail_get_folder): REturn the operation id, so callers can wait
	for it.
	(sync_folder_desc): 
	(expunge_folder_desc): Add describe functions so we know what its
	doing.
	(mail_send_mail): More generic implementation of sending mail.

	* mail-mt.c (mail_msg_new): Lock around seq increment.  And insert
	each new message into a hash table of active messages.
	(mail_msg_init): Init the active message table.
	(mail_msg_free): Remove the message from the active message table.
	(mail_msg_wait): New function, waits for a message to be
	processed, by id.
	(mail_msg_check_error): Dont display the error if it is a
	user-cancelled operation.
	(mail_proxy_event): new implementation of mail_op_forward_event.
	Only real difference is it uses the new	thread stuff, and you can
	wait for it to finish if you want.
	(mail_proxy_event): If we're already in the main thread, just call
	the function.

2001-01-03  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config-druid.c: New source file that implements
	mail-config-druid. Note: this is not yet complete.

2001-01-03  Not Zed  <NotZed@HelixCode.com>

	* mail-view.c (view_forward_msg): Call
	mail-callbacks.c:forward_messages(), so the behaviour is the same
	as from the folder browser.

	* mail-callbacks.c (forward_messages): New function to forward
	messages, attached or not.
	(forward_inlined): Changed to use new forward-messages
	implementation.
	(forward_attached): Likewise.
	(do_forward_attach): Callback for forwarding as attachment, once
	we have built it.
	(do_forward_inline): Likewise, for inline, once we have retrieved
	the message.
	(forward_message): Removed.

	* mail-ops.c (mail_build_attachment): New function to build an
	attachment of messages.
	(mail_do_attach_message): Removed, functionality superceeded by
	above.
	(mail_do_forward_message): Removed.  Likewise.
	(mail_create_folder): Started work on an alternative
	implementation of create_folder, but not sure about it yet.

	* mail-tools.c (mail_tool_generate_forward_subject): Remove locking.
	(mail_tool_make_message_attachment): Free the description when done.

2001-01-03  Radek Doulik  <rodo@helixcode.com>

	* mail-format.c (write_headers): add font color setting for table,
	changed border behavior

	* mail-display.c (redisplay): don't set body bg and text color

2001-01-02  Not Zed  <NotZed@HelixCode.com>

	* mail-callbacks.c (view_msg): Fix for mail_get_message change,
	use queue thread.

	* folder-browser.c (done_message_selected): Fix mail_Get_message
	calls, use new thread.
	(do_message_selected): "

	* mail-ops.c (mail_get_message): Add a thread argument so callers
	can specify which queue it executes on.

	* mail-mt.c (mail_msg_free): Fix a free order problem.
	(mail_msg_destroy): Call mail_msg_free to do the work.
	(mail_msgport_replied): "
	(mail_msgport_replied): Check/display errors if we get them.
	(mail_msgport_received): If we have a describe function, say what
	we're doing, also set busy/unbusy.
	(mail_msgport_replied): Clear busy when we get a reply.
	(mail_get_password): Unset busy.
	(mail_msg_received): Set busy as we go.
	(mail_msg_destroy): Unset busy when done.
	(mail_status): Blah blah, new status interface, the other wans't
	workable with the way the shell api works.

2000-12-29  Not Zed  <NotZed@HelixCode.com>

	* folder-browser.c (do_message_selected): If we are reconfiguring,
	just keep polling till we are done (yeah kinda shitty, but easy).
	(folder_browser_set_uri): Clear reconfigure flag here.  ick.
	(got_folder): And here too.
	(on_right_click): Remove locking.
	(hide_sender): and here too.
	(hide_subject): And here.
	(on_right_click): If we are in reconfigure, then the whole menu is disabled.

	* mail-mt.c (status_busy_timeout): Clear the status_busy_timeout_id.

	* mail-local.c (local_storage_new_folder_cb): Made getting folders
	completely synchronous.  The shell expects it, and it was only
	synchronous before by a sideeffect.
	(do_reconfigure_folder): Remove locking stuff.
	(do_reconfigure_folder): Use our own much simpler copying routine
	than that stupid move_folder_contents thing.
	(update_progress): Use mail_status_message() instead.
	(do_reconfigure_folder): Set the reconfigure flag during
	reconfigure & set busy flag.
	(cleanup_reconfigure_folder): clear busy flag.

	* mail-tools.c (mail_tool_uri_to_folder): Remove the tool_lock
	stuff.
	(mail_tool_uri_to_folder_noex): Clear exception on exit.
	(mail_tool_move_folder_contents): Get rid of this really stupid
	function that is only used in one place.

	* component-factory.c (owner_set_cb): Use direct calls to get the
	folders, as this code must run synchronous.  Remove the event wait
	stuff.

	* mail-callbacks.c (edit_msg): Call mail_get_messages, and create
	the composers ourself.
	(do_edit_messages): get_messages callback, create the composers
	and connect to signals we need.
	(view_msg): Dont call do_view_messages, just call
	mail_get_messge for each to get them in parallel.
	(do_view_message): view a single message.

	* mail-ops.c (mail_edit_messages): Just use mail_get_messages
	for this operation.  Removed the other async operation stuff.
	Changed my mind, just removed entirely.
	(mail_do_view_messages): Removed.
	(mail_do_setup_folder): Removed.
	(mail_do_scan_subfolders): Make this run synchronously, as every
	caller expects it to (even if they didn't realise).

2000-12-28  Not Zed  <NotZed@HelixCode.com>

	* mail-callbacks.c (send_queued_mail): Dont expunge the folder
	here, but in send_queue, otherwise it might execute out of order.
	(expunge_folder): Remove the talbe prechange stuff, and infact
	references to the message_list folder, as we have our own folder.
	Also, dont allow expunge if we're already expunging.
	(expunged_folder): Clkear the expunging flag if we're finished.

	* folder-browser-factory.c (control_deactivate): Likewise here.
	Hrm, i thought this function required a callback, silly me.

	* mail-tools.c (mail_tool_make_message_attachment): Remov e
	locking.

	* folder-browser.c (on_message_selected): Use a timeout handler so
	we dont select immediately.
	(folder_browser_set_uri): Changed to use mail_get_folder.
	(got_folder): New callback called when get_folder is finished.
	(folder_browser_destroy): Use new sync interface.

	* mail-ops.c (mail_get_message): New function to asynchrounously
	get a message.
	: #define out mail_tool_camel_lock stuff entirely.
	(mail_get_folder): New function to asynchrounously get a folder.
	(mail_do_load_folder): Removed, replaced by more generic function
	above.
	(mail_do_display_message): Removed, replaced by the more generic
	funciton get_message.
	(mail_get_messages): New function to get a list of messages
	asynchronously.
	(mail_sync_folder): New interface to sync a folder async.
	(mail_expunge_folder): New interface for expunging folder, with
	callback.
	(do_send_queue): Remove lock stuff, and expunge if (and only if)
	successful, also sync the sent folder while we're at it.

	* session.c (mail_session_request_dialog): Changed to use new
	mail_get_password call.

	* mail-mt.[ch]: New threading/interthread messaging framework.

	* main.c (main): Init the message/thread system.

2001-01-02  Dan Winship  <danw@helixcode.com>

	* mail-format.c (mail_part_is_inline): 
	(find_preferred_alternative): 
	* mail-display.c (launch_cb): Use header_content_type_simple, not
	header_content_type_format.

2000-12-26  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-crypto.c (mail_crypto_openpgp_verify): Implemented.

2000-12-23  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (mail_do_setup_trash): New function similar to
	mail_do_setup_folder() except that this creates the Trash VFolder
	(special-case).

2000-12-21  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_send_mail): Don't free info inside the last
	if-statement, if sent_folder doesn't exist we'll have a memory
	leak. Instead free it afterward.

2000-12-29  Dan Winship  <danw@helixcode.com>

	* mail-crypto.c: Oops. Update this for CamelContentType stuff too.

2000-12-28  Dan Winship  <danw@helixcode.com>

	* mail-format.c (mail_part_is_inline, mail_get_message_body): Use
	CamelContentType, and use header_content_type_is instead of doing
	it by hand.
	
	(handle_text_plain): 
	(handle_multipart_related): 
	(find_preferred_alternative): 
	(handle_message_external_body): Use CamelContentType and
	header_content_type_* functions instead of GMimeContentField.

	* mail-display.c (write_data_to_file, launch_cb): Use
	CamelContentType and header_content_type_* functions instead of
	GMimeContentField.

2000-12-26  Iain Holmes  <iain@helixcode.com>

	* mail-display.c (mail_display_init): Initialise the thumbnail cache.
	(mail_display_destroy): Free the cache.
	(pixbuf_gen_idle): Check the cache for a pixbuf, add the pixbuf to the
	cache if it's not there.

2000-12-26  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (create_summary_view): Create a shared 
	BonoboEventSource object and use it for all the objects that
	aggregate Bonobo::EventSource.

2000-12-27  Dan Winship  <danw@helixcode.com>

	* subscribe-dialog.c (setup_subscribe_folder): Use info->name, not
	input->full_name. Fixes #1029 in bugzilla.helixcode.com.
	({setup,do,cleanup}_subscribe_folder): Update previous fix: Jeff
	had changed it to use ->full_name instead of ->name because that's
	what camel_store_subscribe_folder needed. So we need to have
	*both* names available, one for Camel, one for the shell.

2000-12-24  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (filter_date): Changed this to format times in 12
	hour time instead of 24 hour time.

2000-12-24  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (filter_date): Changed this to do different
	formatting of dates within the last week.

2000-12-24  Not Zed  <NotZed@HelixCode.com>

	* Merge from camel-mt-branch.

2000-12-23  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (filter_date): Changed this to do different
	formatting of dates based on the current time.

2000-12-23  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (message_list_get_layout): Added titles to the
	pixbuf columns.

2000-12-21  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c: Added code to detect and regenerate the summary
	when a new vfolder is created or removed.

	* mail-vfolder.c: Export the vfolder_storage variable, so that
	the summary can add a listener to it.

2000-12-05  Iain Holmes  <iain@helixcode.com>

	* component-factory.c (factory_destroy): Wait till all views have
	gone and then destroy both factories.

2000-12-21  Dan Winship  <danw@helixcode.com>

	* mail-display.c (pixbuf_for_mime_type): Deal with the possibility
	that we have an icon-filename listed for a MIME type, but the icon
	file doesn't actually exist. Also, if gnome-unknown.png can't be
	found, fall back. Might fix a crash people have been reporting...

2000-12-18  Chris Toshok  <toshok@helixcode.com>

	* mail-format.c (handle_multipart_encrypted): for now #ifdef
	PGP_PROGRAM falling back to handle_multipart_mixed.
	(handle_multipart_signed): same.

2000-12-18  Dan Winship  <danw@helixcode.com>

	* message-list.c (hide_save_state): Unlock camel when done to
	prevent a hang later.

2000-12-18  Miguel de Icaza  <miguel@helixcode.com>

	* mail-tools.c (mail_tool_move_folder_contents): Only update
	display every 2 seconds.

	* mail-ops.c (do_view_messages): Only update display every 2 seconds.

2000-12-23  Not Zed  <NotZed@HelixCode.com>

	* message-list.h (MessageList): Add a specific hide data lock.

	* message-list.c (message_list_drag_data_get): Do not use
	cursor_uid, but get all currentlys elected messages directly off
	the message-list.
	(message_list_destroy): Removed mail_tool_camel_lock stuff.
	(on_click): "
	(message_list_hide_add, message_list_hide_uids, hide_load_state,
	hide_save_state, message_list_hide_clear): ", but use a specfic
	lock for the hide data.
	(do_regenerate_messagelist): remove mail_tool_camel_lock stuff,
	add hide_lock where required.
	(message_list_init): Setup the hide_lock.
	(message_list_destroy): Free the hide_lock.

2000-12-22  Not Zed  <NotZed@HelixCode.com>

	* mail-ops.c (mail_do_sync_folder): Run sync in different thread
	each time.  Just a quick litlte hack to check multithreading.
	There are now few operations that single-queue.  Need to work out
	a way to make the allocation of threads & resources easier, so we
	dont get overwhelmed with threads, but we dont block when we dont
	have to, either.

	* message-list.c (main_folder_changed): If we have only changed
	events, then process them directly.
	(mail_do_regenerate_messagelist): Run regenerate in a new thread
	each time, another quick hack to check mutlithreading.

	* mail-view.c (view_delete_msg): Call camel folder set message
	flags directly.  mail_do_set_message_flags() is now completely
	unused.

	* folder-browser.c (mark_msg_seen): Call camel folder
	set_message_flags directly.

	* mail-callbacks.c (flag_messages): New function, that just sets
	flags of all selected messages, without all that messy thread
	stuff (setting flags is	in-memory).
	(mark_as_seen): Use flag_messages().
	(mark_as_unseen): "
	(undelete_msg): "
	(delete_msg): "

2000-12-20  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_select): Free messageinfo lookups.
	(message_list_drag_data_get): "
	(subtree_unread): "
	(subtree_size): "
	(subtree_earliest): "
	(ml_tree_value_at): "  Also, keep the message info around in a
	static variable, and ref'd, so that any internal references we
	have to it dont vanish while we're not looking.  This has a couple
	of problems ... esp since we never unref the last access, although
	camel-folder-summary wont check this when its unref'd, so we're
	'safe'.
	(save_node_state): free messageinfo lookups.
	(on_click): "
	(get_message_info): deconstify return.

	* mail-tools.c (mail_tool_move_folder_contents): Free messageinfo
	lookups.

	* mail-ops.c (do_filter_ondemand): Free messageinfo lookups.
	(do_flag_messages): "
	(do_fetch_mail): Remove mail_tool_lock stuff.
	(mail_operation_run): Quick hack to run an operation
	asynchrounously, in a brand-new thread.

	* folder-browser.c (on_right_click): Free messageinfo lookups.

2000-12-16  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (build_tree): Always use the slow (full-update)
	version of the tree update code, to get around a bug(?) in etree.
	(build_flat): Likewise.

2000-12-15  Not Zed  <NotZed@HelixCode.com>

	* mail-display.c (write_data_to_file): Dont blindly convert all
	parts to utf8, e.g. image/jpg.  We only convert text/* parts, and
	only then if required.

2000-12-14  Not Zed  <NotZed@HelixCode.com>

	* component-factory.c (create_view): cast over a warning.

	* folder-browser-factory.c: Add verbs for hide functions.

	* message-list.c (message_list_hide_clear):
	(message_list_hide_uids): 
	(message_list_hide_add): Some api renaming.
	(message_list_hide_add): Allow ML_HIDE_SAME to be passed to mean
	not to change the upper/lower range at all.
	(hide_save_state): Save the state of the hide list to stable
	storage.
	(hide_load_state): Load the state of hte hide list.
	(message_list_set_folder): Load/save the state of the folder if it
	is changed/set.
	(message_list_destroy): Save the state of the folder hide list
	when done.
	(save_tree_state): If we wrote out an empty state file, simply
	remove it instead.

	* folder-browser.c (on_right_click): Add some hide menus.
	(hide_read): Hide read messages.
	(hide_deleted): Hide deleted messages.
	(hide_selected): Hide selected/current message.
	(hide_none): Show all hidden messages.
	(on_right_click): Lock around accesses to the message (inside
	mlist_detect_magic).
	(on_right_click): Free the mailing list name.

2000-12-13  Not Zed  <NotZed@HelixCode.com>

	* folder-browser.c (on_right_click): Add camel locking since we
	call it directly.  Whoever heard of a lock you 'down' to unlock?

	* message-list.c (mail_do_regenerate_messagelist): Added hide
	expression, messages to hide.  Fixed all callers.
	(do_regenerate_messagelist): IF we have a hide expression, search
	and remove those from the uid list.  If we have a hide range,
	apply that afterwards.
	(cleanup_regenerate_messagelist): Handle freeing the hide uid
	temporary data, if required.
	(message_list_destroy): Free hide data, also lock around all camel
	object stuff.
	(message_list_length): New function to get the number of messages
	avaialble to be hidden by range.
	(message_list_set_hide): Set the hide expression and range.
	Issue: Should hiding be remembered?
	(message_list_unhide_all): Turn off all hiding.
	(message_list_hide_uids): Hide a list of uid's.

2000-12-15  Dan Winship  <danw@helixcode.com>

	* subscribe-dialog.c (folder_toggle_cb): Update this for the new
	signal handler prototype. Fixes the crash on double-click.

2000-12-15  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (handle_multipart_signed): New callback to handle
	multipart/signed parts.
	(decode_pgp): Update to account for the cipherlen argument needed
	for openpgp_decrypt.
	(is_rfc2015): Removed as we now have a better version in
	mail-crypto.
	(handle_multipart_encrypted): Updated to use the PGP/MIME utility
	functions.

	* mail-crypto.c (mail_crypto_openpgp_decrypt): Don't check
	(!*plaintext) as it could be a binary stream. Now also takes a
	cipherlen argument.
	(mail_crypto_openpgp_sign): New function.
	(pgp_mime_part_sign): New function to replace a mime part with the
	pgp signed equivalent.
	(pgp_mime_part_encrypt): New function to replace a mime part with
	the pgp encrypted equivalent.
	(pgp_mime_part_decrypt): New function to decrypt a pgp encrypted
	mime part (like from pgp_mime_part_encrypt) and replace it.
	(is_rfc2015_signed): New function to determine if a mime part is
	an rfc2015 signed part.
	(is_rfc2015_encrypted): New function to determine if a mime part
	is an rfc2015 encrypted part.
	(mail_crypto_openpgp_verify): New openpgp function to verify a
	signature.

2000-12-14  Christopher James Lahey  <clahey@helixcode.com>

	* mail-threads.c (update_active_views): Unref the iterator when
	we're done with it.

2000-12-14  Larry Ewing  <lewing@helixcode.com>

	* mail-display.c (mail_display_new): call
	gtk_html_set_default_content_type to make gkthtml default to utf-8
	when parsing.  This requires gtkhtml >= the released 0.8.

2000-12-14  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-threads.c (read_msg): Call `ui_set_busy()' before
	`ui_set_message()' so that we are sure that the
	set_busy/unset_busy calls always happen in order.

2000-12-13  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser.c (my_folder_browser_init): Made the vertical
	scrollbar always be there.

	* message-list.c (message_list_get_layout): Changed the minimum
	width of some of the pixmap column headers.

2000-12-12  Christopher James Lahey  <clahey@helixcode.com>

	* component-factory.c (create_view): Added a cast.

	* mail-summary.c: Added #include "mail-summary.h".  Commented out
	folder_free, summary_free, and view_destroy_cb since they're not
	used.
	(do_changed): Added a cast.
	(create_summary_view): Changed some types so that casting would be
	easier.

	* session.c (mail_session_remember_password): Added a cast.

2000-12-12  Dan Winship  <danw@helixcode.com>

	* mail-summary.h: Fix to use the right .h instead of the
	deprecated one.

2000-12-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (forward_message): Attach a signature when
	forwarding, fixes bug #826.

2000-12-11  Dan Winship  <danw@helixcode.com>

	* session.c (mail_session_enable_interaction): New function to
	tell the code that it's ok (or not) to interact with the user when
	trying to authenticate to a service. Starts out turned off.
	(mail_session_request_dialog): If interaction is disabled, fail if
	the password isn't in the cache.

	* component-factory.c (owner_set_cb): Call
	mail_session_enable_interaction() after everything else. (This
	means that the IMAP password dialog will no longer pop up [under
	the splash screen] at startup.)

2000-12-11  Dan Winship  <danw@helixcode.com>

	* component-factory.c (create_view): Deal with "mailstorage" type
	views (top-level mail storages) by trying to fill the storage's
	folder tree again if we failed before.
	(add_storage): Create new storages with a URI and type
	"mailstorage".

	* mail-ops.c (cleanup_scan_subfolders): On success, mark the
	storage as having been loaded, so create_view won't try again.

2000-12-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (decode_pgp): Updated to reflect arguments to the
	openpgp functions - now also takes an outlen argument.
	(try_inline_pgp): Updated.
	(handle_multipart_encrypted): Updated here too.

	* mail-crypto.c (crypto_exec_with_passwd): Updated to handle
	binary streams and such.
	(mail_crypto_openpgp_encrypt): Always initialize the passwd_fds
	even if we don't plan on signing. Added an 'inlen' to specify the
	length of the input data (as it could be binary). Also added a
	'userid' argument for cases when we want to sign as well as
	encrypt.
	(mail_crypto_openpgp_decrypt): Updated to take an outlen argument
	in case the ciphertext is encrypted binary data.
	(mail_crypto_openpgp_clearsign): Added a 'hash' and 'detach'
	arguments. 'hash' allows the program to specify the preferred hash
	function (which will come in handy when generating
	PGP/MIME). 'detach' allows the program to specify whether it wants
	a detached signature or the entire signed text.

2000-12-11  Dan Winship  <danw@helixcode.com>

	* message-list.c: Remove the never-once-used BonoboObject stuff
	and make MessageList be a GtkWidget instead. Also, keep track of
	the ETable directly rather than repeatedly calling
	e_table_scrolled_get_table.

	* folder-browser.c (folder_browser_destroy): Use gtk methods
	rather than bonobo methods to destroy the message list.
	(on_right_click, on_double_click): These are being attached to the
	ETable directly now, so fix the first argument (which isn't being
	used anyway, but...). Ignore double-clicks on "active" columns
	(the ones where clicking does something beyond "select"), fixing
	bug #811, which is what got me started on this to begin with...
	(folder_browser_gui_init): simplify now that MessageList itself is
	a widget. Also use message_list->table rather than
	e_table_scrolled_get_table.

	* mail-local.c (mail_local_reconfigure_folder): Add "mail_" to
	the beginning of this function name to match its prototype and the
	other vague namespace conventions in the mailer.

	* mail-callbacks.c (select_all, invert_selection): Use ml->table.
	(configure_folder): s/local_reconfigure_folder/mail_&/
	
	* mail-ops.c (do_flag_messages): clean up the cleanup a bit

	* mail-tools.c (mail_tool_quote_message): Remove an unused
	variable.

2000-12-11  Not Zed  <NotZed@HelixCode.com>

	* local-config.glade: reordered the options and added maildir,
	mbox, maildir, mh, in that order.

	* mail-local.c (reconfigure_clicked): Added maildir, re-ordered to
	match the changed xml file too.
	(do_reconfigure_folder): WHoever 'threaded' this code forgot to
	check that folder_browser functions shouldn't be called here.
	(cleanup_reconfigure_folder): Call it here instead.
	(lookup_folder): Blah blah, we have to lookup the folder and
	verify its still the same format, joy.  Becaause someone thought
	it would be wise to make the code 5x more complicated for no
	reason, and totally break 'mail reconfigure' in the process. i'm
	really happy about that one.
	(cleanup_register_folder): Uh, yeah, so like, the
	local_store->folders hashtable is supposed to point to like,
	LocalFolders, not CamelFolders.
	(free_local_folder): Free the localfolder struct properly.
	(free_folder): Call above to free data properly.
	(get_folder): Fix for fixing folders hashtable.
	(local_storage_removed_folder_cb): Same here.
	(local_storage_new_folder_cb): Ref the local_store when putting it
	in the local_folder.
	(cleanup_register_folder): Properly free the local_folder if the
	op failed.
	(free_local_folder): Unhook events also.
	(d): Oops, left debug turned on.

2000-12-09  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (message_list_init): Change the "drawfocus"
	argument on e_table_scrolled_get_table(etable) instead of on
	etable (etable is an ETableScrolled.)

2000-12-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (save_msg_ok): Check to see if the file already
	exists, if it does prompt the user to for permission to overwrite
	the file.
	(forward_message): g_strdup the cursor_uid if there is only a
	single message to be forwarded or we'll segfault later.

	* mail-ops.c (do_save_messages): Rewrote yet again. I'm back to
	almost an identical implementation as the first time I wrote this
	except now we write the From line which I had forgotten last
	time. This means that we no longer have to unlink the .ev-summary
	file created and we also use fewer resources (no need to create a
	CamelMboxFolder object).

2000-12-08  JP Rosevear  <jpr@helixcode.com>

	* folder-browser.c (on_double_click): the e-table double-click
	signal now has extra params

2000-12-07  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (add_storage): Pass `NULL' as the
	@toplevel_node_handler_id arg in `evolution_storage_new()'.
	FIXME: We should be passing the ID of the mail component here.
	* mail-vfolder.c (vfolder_create_storage): Likewise.

2000-12-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (message_list_get_layout): Set the "Size" field
	to sort using integer comparison instead of string.
	(filter_size): New function to transform a integer size into a
	more readable form.
	(ml_value_to_string): Use filter_size.
	(ml_value_is_empty): COL_SIZE is no longer a string, so handle
	this as an integer.
	(ml_initialize_value): Here too.
	(ml_free_value): And here.
	(ml_duplicate_value): And here too.
	(message_list_create_extras): Setup the size etable cell.

2000-12-08  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser.c: Connect to signals on the ETable instead of
	the ETableScrolled.

	* subscribe-dialog.c: Used the e_table_scrolled_get_table function
	instead of accessing the variable directly.

2000-12-08  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Connect to signals on the ETable instead of the
	ETableScrolled.

2000-12-07  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Got rid of code referencing the ETableScrolled
	proxy functions.  Changed the call to e_table_set_cursor_row to
	send a model row instead of a view row.

2000-12-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (forward_message): Only do a
	message_list_foreach if we plan on attaching messages, otherwise
	just use ml->cursor_uid.

	* mail-ops.c (cleanup_forward_messages): If attaching multiple
	forwarded message, wrap them in a multipart/digest otherwise just
	attach the single message as a message/rfc822.

2000-12-07  Dan Winship  <danw@helixcode.com>

	* mail-display.c (on_object_requested): Make the iTip hack spew a
	g_warning and not crash if you have no identity configured. To be
	revisited.

	* mail-callbacks.c: (various)
	* folder-browser.c (filter_mlist): 
	* mail-autofilter.c (filter_gui_add_from_message): 
	* mail-vfolder.c (vfolder_gui_add_from_message): Add some
	g_return_if_fail()s to protect from crashes until the code to
	enable/disable commands based on how many messages are selected is
	done.

2000-12-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-vfolder.c (vfolder_gui_add_rule): Make the vfolder editor
	resize correctly. Fixes bug #835.

2000-12-06  Dan Winship  <danw@helixcode.com>

	Fix up shutdown so that things that should be destroyed get
	destroyed. Among other things, this fixes the bug where IMAP
	stores weren't disconnected at shutdown.

	* mail-threads.c (update_active_views): Update for
	folder_browser_factory_get_control_list change to EList.

	* folder-browser-factory.c: Turn control_list into an EList so
	that we can safely remove items from it while it's being iterated
	(which will happen as FolderBrowsers are destroyed at shutdown
	while the thread code is trying to update the status bars).
	(control_destroy_cb): Just destroy the folder_browser.
	(browser_destroy_cb): New callback for FolderBrowser destroy.
	Remove the control from control_list here instead of
	control_destroy_cb, because the controls don't seem to get
	destroyed reliably...

	* component-factory.c: Clean up stuff.
	(factory_destroy): Get rid of this.
	(owner_unset_cb): Schedule an idle handler to quit.
	(idle_quit): Wait for all of the FolderBrowsers to be destroyed
	and then destroy the storages and quit.

	* mail-summary.h (create_summary_view): Fix prototype

2000-12-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (mail_config_folder_to_cachename): Use
	e_filename_make_safe (which used to be e_str_make_safe).

	* mail-display.c (make_safe_filename): And here.

	* message-list.c (message_list_drag_data_get): Here too.

2000-12-06  Dan Winship  <danw@helixcode.com>

	* mail-local.c (cleanup_register_folder): Run the folder_changed
	code on message_changed as well, so the unread message counts
	update as messages are read.

	* folder-browser.c: Remove bits of filter-on-demand and toolbar
	bug workaround cruft that don't do anything useful any more.

	* mail-ops.c (cleanup_load_folder): unref the ref we added in
	setup_load_folder.

2000-12-05  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-display.c (write_data_to_file): Use a charset filter to
	make sure the data is written out in the charset it was meant to
	be in instead of UTF-8.

	* mail-format.c (mail_format_raw_message): Don't use the raw
	message body as the format argument, use "%s" instead. If the raw
	message contains %'s then it will segfault otherwise.

2000-12-04  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c (service_page_item_new): Fix a typo so that
	toggling the "remember password" checkbox will activate the "OK"
	button if it was inactive.

2000-12-05  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-vfolder.c (vfolder_create_storage): Updated the call to
	`evolution_storage_new()': pass NULL for @toplevel_node_uri.

	* component-factory.c (add_storage): Updated the call to
	`evolution_storage_new()': pass NULL for @toplevel_node_uri.

2000-12-04  Jeffrey Stedfast  <fejj@helixcode.com>

	* subscribe-dialog.c (setup_subscribe_folder): Use info->full_name
	rather than info->name so that we get the namespace part of the
	folder path as well.

2000-12-04  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c: Updated to define verbs
	"MessageForwardInlined" and "MessageForwardAttached" instead of
	"MessageForwardInline" and "MessageForwardAttach".

	* folder-browser.c (on_right_click): Make forwarding as an
	attachment the default.

	* mail-callbacks.c (forward_inlined): Renamed from `forward_msg'.
	(forward_attached): Renamed from `forward_attach'.
	* mail-callbacks.h: Updated accordingly.

2000-12-01  Dan Winship  <danw@helixcode.com>

	* session.c (mail_session_remember_password): Writes out passwords
	(to .gnome_private) in our patented proprietary "Best Awesome
	Super Encryption 64" ("BASE64") format which could not possibly
	ever be cracked by even the most cryptographically knowledgeable
	five-year-olds.
	(mail_session_init): Load remembered passwords at startup.
	(mail_session_forget_passwords): Erase them from disk as well as
	memory.

	* mail-config.c: Add "remember_password" field to
	MailConfigService.
	(mail_config_write_on_exit): Call mail_session_remember_password
	for services with "remember_password" set.
	* mail-config-gui.c: Add "remember password" checkbox to the
	dialogs, and make it appear and disappear as appropriate.

	* component-factory.c (mail_load_storages): Unref the store
	regardless of whether or not we're using it, so we don't leak
	references to non-storage stores.

2000-12-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (e_mail_address_new): Perform better
	error-handling.

2000-12-01  Radek Doulik  <rodo@helixcode.com>

	* mail-ops.c (mail_op_report_status): use mail_op_set_message_plain

	* mail-threads.c (mail_op_set_message_plain): plain version of
	mail_op_set_message, doesn't use printf, passes message untouched,
	use set_message
	(mail_op_set_message): set_message
	(set_message): helper function
	
2000-11-30  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (cleanup_fetch_mail): Don't display a dialog, instead
	inform the user that there was no new mail by setting a status
	message.

	* message-list.c (message_list_drag_data_get): Use the new
	e_str_make_safe function.

	* mail-display.c (make_safe_filename): And here.

	* mail-config.c (mail_config_folder_to_cachename): Here too.

2000-11-30  Not Zed  <NotZed@HelixCode.com>

	* mail-ops.c (cleanup_load_folder): Set threaded view before
	setting the folder (cleanup some flash ons tartup).

	* message-list.c (message_list_init): Initialise a mempool for uid
	string storage.
	(new_id_from_uid): Added messagelist arg, allocate strings from
	uid_pool.
	(new_id_from_subject): Same.  Fixed all callers.
	(remove_node_diff): Dont free uid here.
	(build_flat_diff): Nor here.
	(clear_tree): Flush the mempool, rather than freeing the id's
	directly.
	(free_tree_ids): Removed, no longer required.
	(free_tree_ids): Likewise.
	(message_list_init): Dont connect to the table destroy signal
	anymore to free the uid table.
	(message_list_destroy): Free the uid pool here.
	(*): Use accessors for messageid stuff.
	(content_is_attachment): Removed, no longer required.
	(ml_tree_value_at): Get the attachment flag directly from the
	summary.
	(ml_tree_value_at): For 'fake' nodes, try and do something better
	than "?" for from, to, and size.
	(subtree_size): New function, add up the total size of a subtree.
	(subtree_earliest): Get the earliest date from a subtree.
	(ml_tree_value_at): Return earliest date sent/received for fake
	nodes.
	(ml_tree_value_at): Return something to mark a fake subject line
	as a fake subject, although i dont know, i guess this buggers up
	sorting ...
	(subtree_size): Check the info node is still there.
	(subtree_earliest): Same here.
	(subtree_unread): And here.  The info node might vanish if the
	folder has changed/is changing and we try and redraw stuff while
	its doing it.
	(message_list_drag_data_get): Use accessors.

2000-11-29  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (message_list_drag_data_get): Implement.
	(message_list_init): Connect the d&d signal.

	* mail-ops.c (do_save_messages): Use camel a bit more to help us
	out. Don't create the file ourselves, treat it as a CamelFolder so
	we don't have to worry about formatting.

2000-11-29  Dan Winship  <danw@helixcode.com>

	* main.c (main): Remove no-longer-needed e_unicode_init.

	* mail-tools.c (mail_tool_quote_message): Fix the allocation here
	(again) and put a comment explaining it. (Fixes a crash when
	replying.)

2000-11-28  Dan Winship  <danw@helixcode.com>

	* component-factory.c (owner_set_cb): Wait until after setting up
	the local storage to find the Drafts/Outbox/Sent folders.

	* mail-ops.c (do_setup_folder): Use the file: store rather than
	mbox:.

2000-11-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Added the SaveAs bonobo menu verb
	thingy.

	* mail-callbacks.c (save_msg): New callback for saving messages.
	(save_msg_ok): 

	* folder-browser.c (on_right_click): Add a Save Ass menu item.

	* mail-ops.c (cleanup_save_messages): Save all emails to the path
	given.

2000-11-28  Dan Winship  <danw@helixcode.com>

	* mail-local.c (cleanup_register_folder): Fix the initial unread
	counts after the last patch.

2000-11-27  Dan Winship  <danw@helixcode.com>

	* mail-local.c (local_folder_changed): This needs to run from the
	main thread, not the camel thread, so add a proxy signal handler
	to call mail_op_forward_event. Fixes hangs (eg bugzilla #909).

2000-11-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-display.c: Removed some unecessary debugging printf's

2000-11-27  Dan Winship  <danw@helixcode.com>

	* mail-config-druid.glade: Revert the new druid for now, until the
	corresponding code is done, so that the druid will work again.

2000-11-21  Iain Holmes  <iain@helixcode.com>

	* mail-config-gui.c (mail_config): Don't use the "delete-event"
	signal.

2000-11-21  Iain Holmes  <iain@helixcode.com>

	* mail-display.c (pixbuf_for_mime_type): free fm_icon.

	* component-factory (summary_fn): Remove the configure param.
	(factory_destroy): Made into a generic function so that the
	summary_factory can be ref-counted as well as the normal
	factory.

2000-11-21  Dan Winship  <danw@helixcode.com>

	* Makefile.am: add GPGME_CFLAGS and GPGME_LIBS

2000-11-21  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (mail_config_view_source): New function to return
	if user wants to view message source.
	(mail_config_set_view_source): New function to set whether the
	view wants to view source.

	* mail-ops.c (mail_do_view_message_sources): Removed. We're not
	gonna view-source this way anymore.

	* folder-browser-factory.c: Removed the ViewSource bonobo verb
	from the Message menu.
	(control_activate): Added ViewSource.

	* folder-browser.c (on_right_click): Removed Message menu item to
	view message source.
	(folder_browser_toggle_view_source): New callback to set whether
	or not the MailDisplay shows the raw message or the pretty-ified
	message.

	* mail-callbacks.c: Removed view_source.

	* mail-display.c (redisplay): If toggle_raw is set then display
	the raw message else display the pretty formatted message.
	(mail_display_redisplay): New function to force the redisplay of a
	message.

	* mail-format.c (mail_format_raw_message): New function to
	write the raw message data.

2000-11-21  Not Zed  <NotZed@HelixCode.com>

	* mail-vfolder.c (vfolder_uri_to_folder): IF we dont find a
	source, clear the exception and ignore it silently.  for e.g. if
	the user reconfigured their mailboxes and one of them no longer
	exists.
	
2000-11-21  Radek Doulik  <rodo@helixcode.com>

	* mail-display.c: #include <gtkhtml/gtkhtml-embedded.h>

2000-11-21  Not Zed  <NotZed@HelixCode.com>

	* message-thread.[ch]: Removed.  No longer serves a purpose.
	
	* Makefile.am (evolution_mail_SOURCES): Removed message-thread.[ch].

	* message-list.c (build_subtree):
	(node_equal): 
	(add_node_diff): 
	(build_subtree_diff): 
	(do_regenerate_messagelist):
	(cleanup_regenerate_messagelist): Changed to use camel-folder-thread.
	(message_list_set_folder): If we get set a new folder, unhook any
	events before unrefing the folder too (the folder is never reset
	currently, but this would cause problems).
	(subtree_unread): Check for uid null, wont crash, but its a bug.
	(ml_tree_value_at): If the uid is null, then fake an obviously bad
	line.
	(build_subtree): Yeah well, we can't like freeze/thaw here,
	because this is called recursive, and freeze/thaw isn't
	recursive, like pre model and post model change was.
	(build_tree): Maybe we can try it here, although i dont think
	it'll help much.
	(build_flat): And this is also a tree.  yes a tree.
	(build_tree): Added changes arg.  If set, then try the 'diff'
	approach, unless the tree is already empty.
	(message_list_set_threaded): Dont clear the tree here.
	(message_list_set_search): Or here.

2000-11-20  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (save_node_state): Save out the md5 hash of the
	messageid as hex, since thats all we have for those nodes.
	(build_subtree): Expand the messageid to a hex string first, then
	check it.
	(add_node_diff): And the same here.

	* message-thread.c (thread_messages): Changed for changes to
	messageid/references items.
	(id_hash, id_equal): New functions to hash on the binary message id hash.
	(thread_messages): removed some more no longer used dead code.

2000-11-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (e_mail_address_compare): New comparison function
	that will replace address_compare if/when we ever go to save the
	preparsed addresses in the ETable rather than parsing them each
	time. Also fixed it so that we should get better sorting when
	addresses don't contain name parts (I was checking for NULL but
	not '\0').
	(address_compare): Use e_mail_address_compare.

2000-11-19  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (update_changed_folders): Instead of making the CORBA
	call in the dispatch thread, store the new display names and have
	cleanup_fetch_mail make the CORBA calls. Fixes deadlocks.
	(cleanup_fech_mail): Loop through the update_infos and make the
	CORBA calls.
	(setup_fetch_mail): Clear some new data items.

2000-11-17  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_generate_reply): Use the new quote_message
	function and make it start with "On %s, %s wrote:" since people
	seem to want that.

	* mail-ops.c (cleanup_forward_messages): Use the new quote_message
	function.

	* mail-tools.c (mail_tool_quote_message): New convenience function
	to quote a message body (since both the reply and forward code do
	similar quoting)

2000-11-17  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_destroy): Before we destroy
	ourselves, unhook ourselves from the folder update events.  Should
	fix a common crash on exit case.

2000-11-16  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Added the MessageViewSource bonobo
	menu verb.

	* mail-ops.c (mail_do_save_messages): New async function to save
	messages as individual files in a given path.

2000-11-15  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Added a new Forward as Attachment
	bonobo menu item verb.

	* mail-view.c (view_forward_msg): Updated to reflect changes to
	mail_do_forward_message(). It now forwards the message without
	attaching it - is this what we want?

	* mail-ops.c (mail_do_view_message_sources): New async function to
	display message source dialog windows.
	(setup_forward_messages): If we were asked not to forward the
	message(s) as attachment(s) and the user chose more than a single
	message, then default to making each message an attachment.
	(cleanup_forward_messages): If we aren't forwarding the message as
	an attachment, then quote the text and set the composer's body
	with it.

	* mail-callbacks.c (view_source): New callback to view the message
	source of all messages that are currently selected.
	(forward_attach): New callback to forward a message as an
	attachment (forward_msg is now for forwarding a message without it
	being an attachment).
	(forward_message): Convenience function for forwarding messages.

2000-11-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* subscribe-dialog.c (subscribe_do_subscribe_folder): Take a
	'subscribe' argument so that this can function as a subscribe AND
	unsibscribe method.
	(describe_subscribe_folder): Updated.
	(do_subscribe_folder): Updated.
	(cleanup_subscribe_folder): Updated.
	(subscribe_folder_info): Pass along a TRUE as the 'subscribe'
	param.
	(unsubscribe_folder_info): Pass along a FALSE as the 'subscribe'
	param.

2000-11-13  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Removed some e_table_model calls and replaced
	them with e_tree_model calls.

2000-11-12  Dan Winship  <danw@helixcode.com>

	* mail-local.c (mail_do_register_folder): Do this the normal way
	rather than calling mail_operation_wait_for_finish. There was some
	reason for it originally, but it no longer applies. This makes
	adding new folders from the folder selection dialog no longer
	hang.

2000-11-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_filter_ondemand): Sync the source folder.

2000-11-11  Matt Bissiri  <bissiri@eecs.umich.edu>

	* evolution-mail.oafinfo:
	* mail-threads.c: (retrieve_shell_view_interface_from_control):
	Update the remaining "IDL:Evolution*" to "IDL:GNOME/Evolution*"
	to sync up with yesterday's IDL re-scoping.

2000-11-10  Michael Meeks  <michael@helixcode.com>

	* Makefile.am ($(EVOLUTION_MAIL_CORBA_GENERATED)): sort include order.

2000-11-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* subscribe-dialog.glade[.h]: New glade file for possibly using to
	create the subscribe dialog.

2000-11-08  Radek Doulik  <rodo@helixcode.com>

	* mail-format.c (mail_generate_reply): likewise

	* mail-callbacks.c (create_msg_composer): added send_html arg to
	e_msg_composer_new_with_sig_file call

2000-11-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-search-dialogue.c (mail_search_dialogue_construct): Allow
	rule part to expand when the user resizes the dialog.

2000-11-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (search_save): Don't handle custom searching
	anymore... we don't want this.
	(search_full): Same.
	(folder_browser_search_menu_activated): Set the search entry
	widget sensitive.
	(folder_browser_search_query_changed): Same.

2000-11-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (search_full_clicked): Updated to use the
	ESearchBar object rather than the previously used search widgets.
	(search_full): Same.
	(search_save): Same. Also use enums to make it a little easier to
	read now that we have to have enums anyway.
	(folder_browser_search_menu_activated): New ESearchBar menu
	callback.
	(folder_browser_search_query_changed): New ESearchBar query
	callback. Replaces search_set()
	(folder_browser_clear_search): Updated to use the ESearchBar
	object rather than the previously used search widgets.
	(folder_browser_gui_init): Don't hand construct a search widget,
	use the new ESearchBar convenience widget.

	* mail-ops.c (cleanup_load_folder): Updated to reflect changes to
	FolderBrowser.

2000-11-07	Jesse Pavel   <jpavel@helixcode.com>

	* mail-display.c (pixmap_press): modified some of the EPopupMenu
	structures to account for differences in the popup menu API (as
	informed by Jeff. 
	(on_object_requested): passed the user's default email address
	to the iTip control.

2000-11-07  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (INCLUDES): Add the composer dirs.

2000-11-07  Not Zed  <NotZed@HelixCode.com>

	* mail-display.c (on_object_requested): God, I sure wish people
	would listen when i'm saying i'm changing and API. I mean
	I even mailed everyone and everything.  Can't see any changelog
	either.
	
2000-11-06  Not Zed  <NotZed@HelixCode.com>

	* mail-autofilter.c (rule_from_message): Updates for api changes.

	* mail-tools.c (mail_tool_generate_forward_subject): Fixed for api
	changes.  Sigh, whoever wrote the multithread code of the mailer,
	had little idea.  You can't just lock for getting a const value,
	until you are finished with it, cause the owner still owns it.
	Fixed this too.  Yuck, what a horrid forwarding format, can we
	change this, or make it configurable?  The mail headers show who
	forwarded it, we dont need to duplicate it in that UGLY subject.

	* mail-format.c (write_field_to_stream): Removed some jeffness.
	dont g_strdup stuff we dont need to, and remove the
	value_is_encoded thing since we can get the unencoded address
	now.
	(write_address): New function to write an address field.
	(write_headers): Uses write_address to write addresses, cleaner,
	fixed the god-awful unreadable indenting too.
	(handle_text_plain): Use a 'smarter' printf format, so we dont
	need to allocate and copy substrings unecessarily (esp since
	they're about to be allocated any copied another few times
	anyway *sigh*).
	(write_field_to_stream): Commented out the isprint check, which
	afaik serves no purpose.
	(list_add_addresses): New function to build a list of
	display-ready addresses.  Although I think the composer then uses
	these as internet-ready addresses.  It should probably take a list
	of CamelAddress's if thats what it wants.
	(mail_generate_reply): Cleaned up the address list creation stuff
	a heap, and fixes for camel api changes.  Also fixed a small
	memory leak as a side effect (fulladdr wasn't freed if it was the
	same as the sender).

	* mail-display.c (on_object_requested): Changed for interface
	changes to the from address.  I think passing the encoded
	(internet version) of the address is right here.

2000-11-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (on_right_click): Move filter stuff into a
	submenu of the popup menu.

2000-11-06	Jesse Pavel   <jpavel@helixcode.com>

	* mail-display.c: used Camel to parse the full address before
	passing the email address to my iTip control.

2000-11-06  Dan Winship  <danw@helixcode.com>

	First draft of folder tree unread message indication for /local
	mail folders.
	
	* mail-local.c: Add a new CamelStore subclass, MailLocalStore,
	which attaches to an Evolution_LocalStorage on one side and
	CamelSession on the other, and keeps track of local folders. Some
	of this code was previously in mail-local-storage.c, which no
	longer exists.
	(local_reconfigure_folder, etc): Various mail_op-related cleanups,
	and wrap d() around a bunch of printfs.

	* mail-tools.c (mail_tool_get_local_inbox_url,
	mail_tool_get_local_movemail_url): Removed
	(mail_tool_get_local_inbox): Simplified.
	(mail_tool_do_movemail): Remove unused dest_url variable.
	(mail_tool_uri_to_folder): Simplify. Now down to two cases
	(vfolder, and everything else).

	* component-factory.c (owner_set_cb): Pass evolution_dir to
	mail_local_storage_startup.

	* Makefile.am (evolution_mail_SOURCES): Remove
	mail-local-storage.[ch]

	* mail-summary.c: Remove mail-local-storage.h include

2000-11-06  Kjartan Maraas  <kmaraas@gnome.org>

	* mail-autofilter.c: Fix up #include <config.h>
	* mail-crypto.c: Same here.
	* mail-search-dialog.c: Here too.
	* main.c: Fix indentation of #ifdef
	* message-thread.c: Fix include.
	
2000-11-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (delete_msg): Don't invert the flag.
	(undelete_msg): Same (when multiple messages are selected).

2000-11-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Updated to have the same menu items as
	the new right-click menu - eventually these 2 menus should be the
	same.

	* folder-browser.c (on_right_click): Now correctly handles the
	case of multiple selection.

	* mail-callbacks.c (enumerate_msg): Make public so it can be used
	in other source files (it's a useful function!)

2000-11-05  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (on_right_click): Added an "Undelete" option to
	the right-click menu and also set a mask so it was only selectable
	if the message is marked as deleted. Also set a mask for "Mark as
	Read" and "Mark as Unread".

	* mail-callbacks.c (undelete_msg): New callback to undelete
	messages.

2000-11-03  Dan Winship  <danw@helixcode.com>

	* message-list.c (cleanup_regenerate_messagelist): don't free the
	MessageList search when it's being reused

2000-11-03  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-local.c (mail_local_map_uri): Don't show the passwd in the
	url string.
	(mail_tool_local_uri_to_folder): Same.
	(do_reconfigure_folder): Same.

2000-11-03  Jeffrey Stedfast  <fejj@helixcode.com>

	* Makefile.am: Added new header files.
	
	* component-factory.c (owner_set_cb):
	s/session_init/mail_session_init

	* session.c: Renamed public functions to mail_session_*.
	FIXME: Rename session.c to mail-session.c

	* folder-browser-factory.c: #include "mail-callbacks.h", #include
	"mail-session.h" and replace forget_passwords with
	mail_session_forget_passwords

	* mail.h: Move session prototypes to mail-session.h, Move
	mail-crypto prototypes to mail-crypto.h, Move mail-callback
	prototypes to mail-callbacks.h

	* mail-session.h: New header file containing public prototypes
	for session.c

	* mail-format.c: #include "mail-crypto.h"

	* mail-view.c: 
	* folder-browser.c: #include "mail-callbacks.h"

	* mail-crypto.h: New header file containing public prototypes
	for mail-crypto.c

	* mail-callbacks.h: New header file containing public prototypes
	for mail-callbacks.c

	* message-list.c (message_list_get_layout): Set useful defaults.
	(message_list_setup_etable): Don't set the Outbox defaults on a
	folder just because it doesn't have a corresponding saved file.

2000-11-03  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c (service_page_item_new): url_flags are now on
	CamelProvider, not CamelService

	* main.c: 
	* subscribe-dialog.c: 
	* mail-threads.c: Kill warnings

2000-11-03  Federico Mena Quintero  <federico@helixcode.com>

	* Makefile.am: Clean the idl-generated files properly.

2000-11-03  Not Zed  <NotZed@HelixCode.com>

	* mail-view.c: Added mail-display.h.

	* mail-autofilter.c: Removed unecessary headers.  Who ran indent
	over this code?  Sigh.

	* mail-ops.c (display_message_input_s): Added messagedisplay.
	(mail_do_display_message): Added messagedisplay arg.
	(mail_do_display_message): Dont bother doing another thread when
	we know we dont have a uid.
	(): Added folder-browser.h to headers.  Sigh.

	* folder-browser-factory.c (control_activate): Setup the
	viewthreaded callback to the folder_browser function.

	* folder-browser.c (my_folder_browser_init): Connect to
	right_click of etable of the messagelist here.
	(on_right_click): Changed for argument changes.
	(folder_browser_toggle_threads): Changed to take a fb, and to set
	threaded mode on the messagelist.
	(my_folder_browser_init): Connect also to the double_click signal.
	(my_folder_browser_init): Connect to the message_selected signal
	of the message_list.
	(on_message_selected): Signal handler for message selected.
	(my_folder_browser_init): Fix for change to message_list_new().

	* message-list.h: Dont include folder-browser.h.
	(message_list_toggle_threads): Moved into folder-browser.h.
	(struct _MessageList): Removed folderbrowser.

	* mail.h: Dont include folder-browser.h here either, but
	mail-types.h instead.
	Moved prototypes moved into folder-browser.c into
	folder-browser.h. (vfolder_*, filter_*).

	* mail-display.h: Dont include folder-browser.h here, but
	mail-types.h and specific camel headers.

	* message-thread.c (sort_node): Invert the sort order logic so the
	list is sorted in mailbox order, not reverse mailbox order.

	* message-list.c (free_tree_ids): Fix a merge foo.
	(remove_node_diff): Removed unused row argument.  Fixed
	callers/prototype.
	(clear_tree): pre_change on the removal of the root node.
	(build_flat): Only perform pre_change if we are rebuilding the
	whole lot.  For incremental change let etable do its thing.
	(build_tree): Likewise for building the tree view.  If making
	incremental updates, do them as we build it.
	(vfolder_subject):
	(vfolder_sender):
	(vfolder_recipient):
	(filter_subject):
	(filter_sender):
	(filter_recipient):
	(filter_mlist):
	(on_right_click): Moved to folder-browser.c, where they belong.
	(message_list_init): Dont connect to right_click anymore.
	(message_list_toggle_threads): Moved to folder-browser.c, renamed.
	(on_double_click): Moved to folder-browser.c
	(on_click): Set the flags directly, rather than in anothre thread,
	which is just not necessary.
	(message_list_class_init): Added a new signal 'message_selected',
	to indicate when a message was selected.
	(on_cursor_change_idle): Emit a signal, rather than directly
	triggering the display update.
	(select_row): Removed, no longer used.
	(idle_select_row): And this too.
	(select_msg): Removed as well.
	(message_list_select): Emit a signal, rather
	thandisplaying/clearing the mail-display directly.
	(mark_msg_seen): Moved to folder-browser.c
	(message_list_new): Removed folderbrowser argument.

2000-11-02  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (on_right_click): Sync with message
	menu. Addresses bugzilla bug #778.

2000-11-02  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Turn on draw grid for the main ETable (this may
	not be working in ETable itself.)

2000-11-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-threads.c (mail_op_set_message): fmt argument should be
	const.

2000-11-01  Dan Winship  <danw@helixcode.com>

	Make "Get Mail" even more functional on IMAP (scans all folders),
	and do a first cut at folder tree highlighting (for IMAP/news
	only).

	* mail-ops.c (do_fetch_mail): For imap (sigh, we *still* shouldn't
	be hardcoding that), rescan the store's folder tree, rescan each
	changed folder for new messages, and update the shell folder tree.
	(do_scan_subfolders): Update for component-factory.c changes, and
	set folder display names and highlights appropriately when
	building the storage.

	* component-factory.c (add_storage): Make this static (was
	mail_add_new_storage). Use camel_service_get_name for the name
	rather than url->host. (Among other things, this lets you use a
	single machine as both an IMAP server and a news server.)
	(mail_lookup_storage): Hash storages based on their CamelStore
	rather than the URL.
	(factory_destroy): Disconnect each of the CamelStores in the
	storages_hash.

	* subscribe-dialog.c (cleanup_subscribe_folder): 
	* mail-vfolder.c (vfolder_refresh): Pass "highlighted" flag to
	evolution_storage_new_folder 

2000-11-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (mail_op_report_status): Don't call the default
	logging function.
	(do_fetch_mail): Set the logfile and don't pass the logfile to
	filter_driver_set_status_func - it's purpose has been altered.
	(do_filter_ondemand): Same.

2000-11-02  Not Zed  <NotZed@HelixCode.com>

        ** Merged in camel-incremental-branch.

	* mail-format.c (mail_get_message_body): Jeff!  Sigh.
	We should definetly not be strduping the
	content, it has already been copied and duplicated.  Look at
	get_data_wrapper_text.

2000-11-01  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.h: add fields search_entry and search_top.

	* subscribe-dialog.c: add mail-ops.c style async operations for
	getting the store (to remove deadlock in the case where a auth
	dialog is dismissed at startup and then the subscribe dialog is
	brought up), and subscribing/unsubscribing to folders.  One case
	remains, that is getting the list of all folders.
	(subscribe_search): flesh out this function
	(build_tree): use the search_top field so we can search for
	groups/folders.
	(subscribe_dialog_destroy): free search_top.
	(subscribe_dialog_construct): init search_top.

2000-10-30  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (generate_folder_summaries): Fix spelling :)
	Set folder->uri to NULL for the Inbox.

2000-10-26  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (generate_html_summary): Add view:// uris to 
	switch the display to that folder.

2000-11-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Hmmm, someone can't spell Filder,
	er...I mean Filter ;-)

2000-11-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-autofilter.c (rule_from_message): If the name is NULL or
	empty, then set the title to "Mail from <address>". Closes
	bugzilla bug #777. Also when filtering on Subject, set the file
	name to "Subject is <subject>" rather than just "<subject>" - I
	think this is a bit more user-friendly.
	(strip_re): Use unsigned char when passing to is<type>()
	functions from ctype.h.
	(rule_add_subject): Use the "is" rule instead of "contains".

2000-11-01	Jesse Pavel   <jpavel@helixcode.com>

	* mail-display.c: added property bag support for Bonobo
	controls, support which helps only the iTip control, currently.

2000-11-01  Dan Winship  <danw@helixcode.com>

	* mail-display.c (pixbuf_gen_idle): Lots of fixes and
	simplifications. Should get rid of the "missing icon" problem.
	There is still a problem with some images failing to get
	thumbnails, even though they display correctly.
	(pixbuf_for_mime_type): New function to try really hard to get the
	right icon for a MIME type, including looking in mc and nautilus's
	pixmap directories.
	(on_object_requested): Always use pixbuf_gen_idle, even for
	non-image types, to prevent code duplication.

2000-10-31  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_get_message_body): Shouldn't we be
	strdup'ing the content? This seems to fix the memory corruption
	problems.
	(mail_generate_reply): Make sure that the last char in the
	generated reply text is '\0' (when body text doesn't end with a
	\n, a random char will appear otherwise).

2000-10-31  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c (do_test_service): Update for
	camel_service_disconnect change.

2000-10-31  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-autofilter.c (filter_gui_add_for_mailing_list): Match "is"
	rather than "contains" now that we have the "is"-rule.

2000-10-30  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c (config_do_query_authtypes): Redo this so that
	it works for all pages, not just the first page. (Now that this is
	finally working again, I expect Anna to finish her redesign in the
	next 15 minutes.)
	(service_page_item_new): Fix up the sizing of the Auth line to
	look more like everything else.

2000-10-29  Dan Winship  <danw@helixcode.com>

	* mail-tools.c (mail_tool_uri_to_folder): Simplify this a lot by
	making IMAP and NNTP use the same code, now that the IMAP
	namespace doesn't need special magic handling.

	* message-list.c (mail_do_regenerate_messagelist): Don't try to
	regenerate the message list if there is no folder. (The Bonobo UI
	code will call this as the callback for the "Threaded View"
	command.)

	* mail-ops.c (do_fetch_mail): Sync the folder before refreshing so
	we don't lose flag settings.

2000-10-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (composer_send_cb): Check to make sure that the
	recipient list is neither NULL nor a 0-length list of addresses
	and pop up a dialog letting the user know why we are not allowing
	him/her to send the message.

2000-10-26  Dan Winship  <danw@helixcode.com>

	* mail-display.c (write_data_to_file): Don't destroy a dialog
	after run_and_close'ing it.

2000-10-26  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (composer_send_cb): Check for the TO recipient
	list being NULL and don't send.

2000-10-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_send_mail): Don't forget to unref the
	FilterDriver.

	* mail-callbacks.c (apply_filters): New callback for applying
	on-demand filters. (removed the old on-demand filters callback).

	* mail-ops.c (do_filter_ondemand): Rewrote to apply "incoming"
	filters to all selected messages.
	(mail_do_filter_ondemand): No longer takes a FilterContext
	argument or a destination folder argument (why did we ever need
	this last one??) but now takes a uids argument.

	* folder-browser-factory.c: Add a MessageApplyFilters menu item.

2000-10-25  Iain Holmes  <iain@helixcode.com>

	* mail-summary.[ch]: Updated for the new ExecutiveSummary code.

	* Makefile.am: Added the summary files and the evolution-services CFLAGS
	and LIB stuff.

	* component-factory.c: Re-enabled the summary stuff.

2000-10-25  Dan Winship  <danw@helixcode.com>

	* main.c (main): Pass send/postpone signal handler functions to
	evolution_composer_factory_init.

2000-10-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* subscribe-dialog.c (subscribe_select_all): Implemented.
	(subscribe_invert_selection): (was unselect_all) Implemented.

2000-10-25  Dan Winship  <danw@helixcode.com>

	* message-list.c: Add a "flagged" column, based on the Camel
	"flagged" flag, for assigning an arbitrary "hey, I care about
	this" flag to a message.
	(ml_tree_set_value_at): Remove
	(ml_tree_is_cell_editable): No, it's not.
	(on_click): Handle the read/unread and flagged fields via the
	click handler. Among other things, this makes it not select
	a message when you change its read status.

2000-10-24  Dan Winship  <danw@helixcode.com>

	* subscribe-dialog.c (folder_info_subscribed,
	subscribe_folder_info, unsubscribe_folder_info): Don't prepend "/"
	to the folder's full_name. Deal with hierarchy in the
	EvolutionStorage tree better.
	(storage_tree_path): Helper function to build a storage path from
	a CamelFolderInfo.

2000-10-23  Dan Winship  <danw@helixcode.com>

	* *: Add some missing _()s and N_()s.

2000-10-23  Dan Winship  <danw@helixcode.com>

	* Makefile.am (INCLUDES): Update EVOLUTION_LOCALEDIR.

2000-10-23  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_send_mail): Apply outgoing filters to the
	message.

2000-10-23  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Fixed a possible error in row numberings.  This
	needs to be changed quite a bit anyway, but this should make
	things slightly nicer in some cases.

2000-10-23  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser.c: Made the top of the folder browser a little
	prettier.

	* mail-display.c, mail-vfolder.c: Made more dialogs resizable.

2000-10-23  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-autofilter.c (filter_gui_add_from_message): Don't forget to
	set the rule source! (eg "incoming", "demand", or "outgoing")

2000-10-22  Ettore Perazzoli  <ettore@helixcode.com>

	* message-list.c (message_list_init): Always display the vertical
	scrollbar.

	* mail-display.c (mail_display_new): Always display the vertical
	scrollbar.

2000-10-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.h: #include <camel/camel-folder.h>

2000-10-20  Michael Meeks  <michael@helixcode.com>

	* mail.h: s/BonoboUIHandler/BonoboUIComponent/

	* mail-callbacks.c (run_filter_ondemand): ditto.

	* session.c (forget_passwords): ditto.

2000-10-20  Dan Winship  <danw@helixcode.com>

	* evolution-mail.oafinfo: Declare composer factory.

	* main.c (main): Initialize it

2000-10-19  Chris Toshok  <toshok@helixcode.com>

	* message-list.c (nuke_uids): e-tree-model is now opaque.  use the
	accessor to get the root node.

2000-10-19  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c: #include "mail-vfolder.h"
	(vfolder_edit_vfolders): Don't call the dummy vfolder_edit
	function.

	* folder-browser-factory.c: s/VFolderEdit/SetVFolder

2000-10-19  Dan Winship  <danw@helixcode.com>

	* mail-ops.c: (do_fetch_mail): For an imap store, just refresh the
	INBOX.

	* folder-browser-factory.c (control_deactivate): Don't sync
	non-existent folders.
	* message-list.c (nuke_uids): Don't traverse non-existent trees.

2000-10-19  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (glade_messages): New.
	(EXTRA_DIST): Add `$(glade_messages)'.

2000-10-19  Dan Winship  <danw@helixcode.com>

	* mail-ops.c: Clean up some old #if 0 code.

2000-10-19  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_generate_reply): Get the MailConfigIdentity
	*before* we create a new composer object so that we can set the
	signature file.

2000-10-18  Michael Meeks  <michael@helixcode.com>

	* folder-browser-factory.c (register_ondemand): kill.
	(create_ondemand_hooks): die.
	(control_activate): remove hook.

	* test-mail.c (create_container): kill old UI handler.

2000-10-18  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Fixed some column widths.

2000-11-02  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (get_message_info): Call get_message_uid to get
	the uid, save some duplicated code.
	(folder_changed): Handle the case of a NULL changes input.

	* message-thread.c (thread_messages): Removed pointless
	variable/assignment 'container'.
	(thread_messages): Try and cope with duplicate message id's.

2000-11-01  Not Zed  <NotZed@HelixCode.com>

	* mail-callbacks.c (main_select_first_unread): Changed to use 0 as
	the first row to select a message.

	* mail-ops.h (mail_do_regenerate_messagelist): Removed from
	header.  This function is no longer public since it is really an
	internal message-list function.

	* folder-browser.c (search_full_clicked): Call the set_search()
	function, rather than messagelist_rebuild, which is going private.
	(search_set): Same here.
	(folder_browser_clear_search): And here.
	(etable_key): Call message_list_select() instead of
	message_list_home and message_list_end.  Removing some odd code
	duplication.

	* message-thread.c (do_thread_messages): Moved the mail lock to
	here, rather than locking for each message lookup (which is
	useless anyway).  This is still not correct either, as the tree
	references folder data ... but a bit better than it was.
	(thread_messages): Removed the mail tool lock stuff, lock in
	higher functions.

	* message-list.h: Added a threaded indicator to the message list
	itself.
	(threaded_view): removed a mystery variable.

	* message-list.c (do_regenerate_messagelist): Made the code a
	little more readable.
	(build_tree): Fixed argument to be a thread_messages struct, not a
	container.
	(cleanup_regenerate_messagelist): Free changeinfo.
	(mail_do_regenerate_messagelist): If we are adding changes to a
	flat view, we dont need to goto the other thread at all, so
	process immediately.
	(message_list_toggle_threads): Clear the tree if we're changing
	the view mode.
	(message_list_toggle_threads): And reset the rowmap, since it is no
	longer valid.
	(build_tree): If we are building into an already empty tree, just
	build into that (probably irrelevant optimisation).
	(build_subtree): Build hte subtree in the same order as we got it,
	not inverted order.
	(message_list_set_threaded): New function to select the threaded
	view/flat view.
	(mail_do_regenerate_messagelist): Removed references to
	mail_config, get it from the ml->threaded var instead.
	(message_list_destroy): No longer free the key data for the
	uid_rowmap.
	(new_id_from_uid): Convert a uid string into an id string.
	(new_id_from_subject): Likewise for subject strings.
	 'id' strings replace the 'uid:' and 'subject:' stuff with
	 accessors and macros and use less memory and is more readable.
	(id_is_uid): macro to check if an id string is a uid.
	(id_uid): Returns the uid part of a uid id string.
	(id_subject): Returns the uid part of a subject id string.
	(build_subtree): Use the new id functions, and dont duplicate the
	uid in the uid rowmap, but just reference it from the tree node.
	(node_equal): Use new id functions.
	(add_node_diff): And here too.
	(remove_node_diff): And here.  Also remove the uid from the
	rowmap, and dont free it anymore.
	(get_message_info): And here.
	(get_message_uid): And here.
	(subtree_unread): And here.
	(ml_tree_value_at):  "
	(ml_tree_set_value_at): Noted a memory leak.  do_flag_messages()
	doesn't free the contents of the uid array, just the uid array
	(well that i can tell, teh code has more problems anyway).
	(ml_tree_set_value_at): And fix the id accessors.
	(save_node_state):  " 
	(build_flat): Use id macros/functions.  Dont alloc memory for hash
	key.
	(build_flat_diff): Use id macros.
	(build_flat_diff): Remove the hash table entry before freeing its
	key data (in the node).
	(free_key): Removed.  Keys are no longer alloc'd.
	(clear_tree): When we clear the tree, also clear the uid_rowmap,
	as it is no longer valid (or contains allocated keys!).
	(free_tree_ids): Renamed from nuke_uids.
	(free_ids_cb): Renamed from nuke_uids_cb.
	(free_tree_ids): Changed arg to be a ETreeModel directly.
	(ml_tree_value_at): Map id to subject using the right macro.
	(free_tree_ids): Check we have any nodes to traverse first.
	(build_flat): Insert to row -1 to append the nodes (faster).
	(remove_node_diff): Only remove the uid rowmap entry if it is
	referencing this node (i.e. the key string is the same key string,
	not just a matching key string).
	(add_node_diff): Remove the uid rowmap entry before inserting a
	new one to force the key to be replaced.  This is required as the
	tree may temporarily contain duplicate messages during the
	rebuilding phase.
	(message_list_set_search): New function, set the search string.
	Only redo the search if it has changed, etc.
	(mail_do_regenerate_messagelist): Made static.  There is no need
	for external code to call this.
	(message_list_set_folder): NOP if the new folder is the same.
	(message_list_set_folder): Clear the tree before rebuilding it.
	(message_list_select): Ok, this wins the award for 'most bizarre
	interface'.  Changed the start row to mean the end of the list if
	we supply -1, rather than the start of the list.  Also fixed the
	endpoints (it would never select message 0 if searching
	backwards).
	(idle_select_row): Changed start row to 0 from -1.
	(message_list_end): Removed.
	(message_list_home): Removed.
	(go_to_message): Removed.  message_list_select can do this.
	(message_list_select): Check that direction is one of the valid
	ones, otherwise we could be thrown for loops.

2000-10-31  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (node_equal): Compares an etree node with a
	message-thread node to see if they point to the same object.
	(add_node_diff): Adds a new thread node to the etree.
	(remove_node_diff): Removed an etree node, freeing any additional
	data.
	(build_subtree_diff): Takes an existing etree definition, and a
	new thread definition and makes the etree match, using as few
	operations as possible.
	(do_regenerate_messagelist): No longer free/clear the uid/rowmap
	here.
	(regenerate_messagelist_input_t): Added a tree field - are we
	building a tree view?
	(regnerate_messagelist_data_t): Added a tree field, if we built a
	tree result.  Added a changes parameter, for building diff's after
	search/etc.
	(mail_do_regenerate_messagelist): Setup the tree indicator.
	(build_flat_diff): Apply a changeset to a message list.
	(build_flat): Added a changes argument, if present, use
	build_flat_diff() to build the list.
	(do_regenerate_messagelist): If we are generating a threaded view,
	build the threaded list here, rather in another separate
	invocation.
	(cleanup_regenerate_messagelist): Call build_tree directly on the
	threaded list.
	(message_list_init): Init the uid_rowmap hash table here instead
	of somewhere odd.
	(message_list_destroy): Assume uid_rowmap exists.
	(do_regenerate_messagelist): Remove the code here that is messing
	with the message list data (search/uid_rowmap).  We're in a
	different thread boys ...

2000-10-26  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (cleanup_regenerate_messagelist): Fixed some
	logic to make more sense (gboolean)!pointer replaced with
	(pointer != NULL).
	(build_tree): Put the tree pre/post change stuff in here, where it
	should be.
	(build_flat): Same here.
	(cleanup_regenerate_messagelist): Remove model_changed stuff here.
	(setup_regenerate_messagelist): Remove pre_change stuff here.

2000-10-20  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (main_folder_changed): Perform incremental update
	of the display for flat view.
	(ml_tree_value_at): Spit out a mroe meaningful warning when we
	can't find the uid in our tree, in the folder.

	* message-thread.c (thread_messages): Made public.
	(thread_messages_free): Made public.
	(thread_messages): Now we also return a struct _thread_messages,
	which is passed to other functions.
	(container_free): Renamed from thread_messages_free.
	(thread_messages_free): Take a thread_messages argument.
	(thread_messages_add): New function to add a list of uid's to the
	thread list.
	(thread_messages_remove): Likewise, for removing them.
	(cleanup_thread_messages): Change for struct changes.
	(do_thread_messages): Likewise.

2000-10-19  Not Zed  <NotZed@HelixCode.com>

	* mail-tools.c (mail_tool_do_movemail): removed unused var

	* folder-browser.c (search_full_clicked): Fix for api changes,
	such as it can be called an api, its mroe an utter mess infact.
	(search_set): Same.
	(search_set): And here.
	(folder_browser_clear_search): And here.

	* message-list.c (folder_changed): Copy and forward the changeinfo
	list to the mian thread.
	(main_folder_changed): Free the changeinfo. Todo: something smart
	with this information.
	(struct regenerate_messagelist_input_s): Added a changes field.
	(mail_do_regenerate_messagelist): Added a change list argument.
	(message_list_set_folder): Fix for mail_do_regenreate_messagelist
	api.
	(message_list_toggle_threads): Same.

2000-10-18  Iain Holmes  <iain@helixcode.com>

	* mail-config-gui.c (mail_config): Make all the CLists have passive
	titles.
	(identity_dialog): Make the default button the "OK" button, and set
	the dialog to close on pressing return on the entryboxes.

2000-10-17  Iain Holmes  <iain@helixcode.com>

	* mail-config-gui.c (service_page_item_new): Disable the optionmenu
	because it is empty.
	(service_page_item_auth_fill): Enable the optionmenu as there's stuff
	in it now.

	* mail-callbacks.c (reply_to_sender): Call check_send_configuration
	when we have the FolderBrowser because if it is done in mail_reply
	(with passing NULL) it will only be able to continue if the mailer
	has already been configured.
	(reply_to_all): Same.

2000-10-18  Not Zed  <NotZed@HelixCode.com>

	* folder-browser.c (folder_browser_gui_init): No, we REALLY dont
	want to perform an immediate search as the keys are pressed.

	* mail-display.c (on_object_requested): Kill a minor warning with
	a cast.

	* mail-config.c: Include mising ctype.h to kill a warning.

	* message-thread.c (main): Fixed the test case for api changes.

	* message-list.c (message_list_drag_data_get): Set some flags to
	get_folder().  I dont even think this will work because
	mail_tool_get_folder doesn't handle file url's.

	* mail-vfolder.c (vfolder_uri_to_folder): Pass appropriate flags.

	* mail-ops.c (do_setup_folder): Pass appropriate flags.  Hmm,
	whats the difference between setup and create.  *shrug*
	(do_create_folder): Pass appropriate flags to get_folder.  Needs a
	way to specify the index flag.

	* mail-tools.c (mail_tool_get_folder_from_urlname): Changed create
	to flags argument.
	(mail_tool_get_local_inbox_url): Add an index argument.
	(mail_tool_get_local_inbox): honour index flag.
	(mail_tool_get_inbox): Changed for api change.
	(mail_tool_uri_to_folder): Fixed calls to store_get_folder();

	* mail-local.c (load_metainfo): Added an indexed field to the metainfo.
	(save_metainfo): And save it too.
	(do_reconfigure_folder): Honour index flag when creating the new
	folder.  Do not open the old folder with an index at all.
	(mail_local_map_uri): Add an index argument - tells if the mbox is
	indexed.
	(mail_tool_local_uri_to_folder): Create & pass flags properly.
	(#include gnome.h): Dont include all of gnome, just what we use,
	and explicity include xml-memory, so we get xmlFree().

2000-10-16  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (search_full_clicked): Un #if 0'd out
	(search_full): Same.
	(folder_browser_gui_init): Connect search_full and search_activate.
	(search_set): Uncomment search_full()

	* Makefile.am: Re-add `mail-search-dialogue.h' and
	`mail-search-dialogue.c'.

2000-10-16  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_generate_reply): Decode recipient names so
	that they display nicely in the To and Cc fields.
	(write_field_to_stream): Now takes another argument
	'value_is_encoded' so that we know if we should decode that string
	before proceding onward. Since the message subject is already
	decoded before it's passed in, we don't want to decode it again
	(wasted cpu time and/or any 8bit chars will be assumed to be
	latin1 encoded and thus the decoded value will be corrupt).

2000-10-16  Chris Toshok  <toshok@helixcode.com>

	* mail-config-gui.c (service_page_get_url): only set the url->user
	field if the user string is non-NULL and not empty.

2000-10-16  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_setup_etable): Uh, fixed jeff's
	wrong fix for setting the speficiation (the function changed to
	set_state(), as can be seen in the e_table-scrolled_load_state()
	call only 2 lines above).

2000-10-13  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_setup_etable): oops, chose the
	wrong thing to cut out after a merge conflict.

2000-10-15  Chris Toshok  <toshok@helixcode.com>

	* message-list.c (subtree_unread): ETreePath != GNode now, use
	accessors.
	(ml_tree_value_at): same.
	(save_node_state): same.
	(save_tree_state): same.
	(nuke_uids_cb): convert to e_tree_model_node_traverse required
	type.
	(nuke_uids): g_node_traverse -> e_tree_model_node_traverse.

2000-10-14  Ettore Perazzoli  <ettore@helixcode.com>

	* evolution-mail.oafinfo: Add "evolution:shell-component-icon"
	attribute.

2000-10-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (message_list_setup_etable): Don't free the
	service name.

2000-10-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): sync & expunge the source folder
	after filtering.

2000-10-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (message_list_setup_etable): Create the 'spec'
	and 'extras' arguments and call e_table_scrolled_new() rather than
	set_specification as that function no longer (?) exists. 

	Also started to add drag & drop functionality to something like
	Nautilus (but #if 0'd it out until I had time to finish it and
	till after 0.6).

2000-10-12  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_setup_etable): Duh, fix the test
	for the folder name, strstr != strcmp is it.

2000-10-10  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (folder_to_cachename): Removed, changed callers
	to use mail_config_folder_to_cachename instead.

	* mail-config.c (mail_config_folder_to_cachename): New utility
	function to get a cache name for a folder.

	* mail-tools.c (mail_tool_do_movemail): Changed to return the path
	to the mbox, rather than opening a folder of it.

	* mail-ops.c (mail_incorporate_messages): Dont bother making the
	pseudo messageinfo, filder_driver_filter_message will do it for
	us.
	(report_status): Callback to report status of filtering operation.
	(do_fetch_mail): Changed significantly - for the api changes to
	the filtering system.  Also now incorporates a mailbox file
	directly, without having to import it into a camel folder first.
	(mail_incorporate_messages): Removed entirely, no longer needed.

	* mail-vfolder.c (vfolder_refresh): Fix for context api changes.
	(vfolder_uri_to_folder): Likewise.

	* folder-browser-factory.c (create_ondemand_hooks): Changed for
	api changes.  Also only adds demand filters to the menu (fixed a
	small logic bug).

2000-10-11  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (folder_etree_value_at): special case for
	folders with NULL urls (which aren't selected/subscribeable).
	(unsubscribe_folder_info): can't (un)subscribe from folders with
	non-NULL urls.
	(subscribe_folder_info): same.

2000-10-12  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Replace To with From except in Drafts, Outbox,
	or Sent boxes.  Make Subject column pay attention to text
	attributes like bold and strikethrough.

2000-10-12  Iain Holmes  <iain@helixcode.com>

	* component-factory.c: Disable the executive summary.

2000-10-11  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (FOLDER_ETABLE_SPEC): set expansion to 0.0,
	minimum-width to 16, and resizable to false for the subscribed
	column.
	(folder_info_subscribed): new function so we can do the correct
	path munging.
	(subscribe_folder_info): only add the folder to the storage if
	there wasn't an exception subscribing it.
	(unsubscribe_folder_info): same, but unsubscribing.
	(folder_etree_value_at): use folder_info_subscribed.
	(folder_toggle_cb): same.
	(unsubscribe_folder_foreach): same.
	(subscribe_folder_foreach): same.
	(subscribe_dialog_gui_init): set the bold column on the text cell,
	and add the subscribed pixbuf.

2000-10-11 Anna Marie Dirks   <anna@helixcode.com>
	* mail-threads.c: Changed the password-getting dialog so that the
	text entry has focus. 

2000-10-11  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (STORE_ETABLE_SPEC): change cell type to
	"string" since we're not including it in the extras.

2000-10-11  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, message-list.h, subscribe-dialog.c: Changed
	these to use the proper form for the column element.

2000-10-11  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, message-list.h, subscribe-dialog.c: Updated
	these to the new ETable style of specifications.

2000-10-11  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (subscribe_dialog_gui_init): convert to the
	new gal e-table stuff.
	(html_size_req):
	(html_new):
	(put_html): #if 0 out the html functions since description stuff
	isn't used and we don't want the warnings.

2000-10-11  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (subscribe_dialog_gui_init): remove the html
	description stuff for now.

2000-10-10  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (folder_toggle_cb): umm.. duh :) only
	subscribe if it's not subscribed, and vice versa.
	(subscribe_folder_foreach): make sure to call
	e_tree_model_node_changed.
	(unsubscribe_folder_foreach): make sure to call
	e_tree_model_node_changed.

2000-10-10  Chris Toshok  <toshok@helixcode.com>

	* mail-ops.c (setup_scan_subfolders): add a ref to input->storage
	here so that the ref/unref pattern more closely matches other
	mail-ops.  also, this keeps the storage from being freed when we
	hit the unref in cleanup_scan_subfolders, which is important
	because we maintain a reference to it in the storage_hash in
	component-factory.c

	* subscribe-dialog.h: add storage field.

	* subscribe-dialog.c (subscribe_folder_info): new function,
	subscribe to a folder given it's CamelFolderInfo, and add it to
	the shell - we're generating a path from the name of the folder
	which is bad.
	(unsubscribe_folder_info): same (except we unsubscribe and remove
	from the shell).
	(storage_selected_cb): unref the currently selected storage.
	(subscribe_dialog_destroy): unref the currently selected storage.
	(subscribe_dialog_construct): sc->storage = NULL.

	* component-factory.c (mail_lookup_storage): new function, to look
	up a EvolutionStorage corresponding to a CamelService.  we ref the
	EvolutionStorage before passing it back.
	(mail_add_new_storage): insert the storage into storages_hash if
	result is EVOLUTION_STORAGE_OK.

	* mail.h: add prototype for mail_lookup_storage.

2000-10-10  Larry Ewing  <lewing@helixcode.com>

	* mail-format.c (mail_generate_reply): make sure we dup the return
	value of get_reply_to or get_from when building the recipient list. 

2000-10-10  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (generate_html_summary): Removed the <li> from the
	HTML.
 
2000-10-10  Cody Russell  <bratsche@gnome.org>

	* mail-threads.c: Added #include <errno.h>

2000-10-09  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c: Removed the extra arguments to rule_context_load.

2000-10-09  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c, subscribe-dialog.h: use our own etable to
	display the stores, and get them from the mail-config api.  put
	#if 0'ed code in place to add/remove the folders from the shell
	when they're subscribed/unsusbcribed.  also, react to double
	clicks in the folder etable by toggling subscription status.

2000-10-08  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (create_summary_view): Updated to use new icon code.

2000-10-08  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c (generate_html_summary): Generic function to 
	recreate the HTML of the summary. Checks all the folder summaries.
	(generate_folder_summarys): Create a summary of all the vfolders
	and the Inbox.
	(create_summary_view): Generate the folder summarys before the
	HTML.

2000-10-09  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser.c: Don't #include "mail-search-dialogue.h" as
	it's missing from the repository.
	(search_full_clicked): Temporarily `#if 0'ed out.
	(search_full): Likewise.
	(folder_browser_gui_init): Don't connect `search_full'.
	(create_option_menu): Don't connect `search_menu_deactivate'.
	(folder_browser_gui_init): Don't connect `search_activate'.
	(search_set): Don't do `search_full()'.
	(folder_browser_gui_init): Likewise.

	* Makefile.am (evolution_mail_SOURCES): Remove
	`mail-search-dialogue.h' and `mail-search-dialogue.c' as NotZed
	forgot to put them into CVS.

2000-10-06  Not Zed  <NotZed@HelixCode.com>

	* mail-search-dialogue.c: New widget, full search dialogue for
	mail.

	* folder-browser.c (search_set): If we click on custom search, run
	the full search dialogue.
	(folder_browser_gui_init): Add a button to perform a full search.
	(search_full): Bring up the mail search dialogue asynchronously.
	(search_full_clicked): Handle search options.
	(folder_browser_destroy): Free the saved rule if there is one
	there.
	(search_options[]): Added a custom option option - brings up the
	full search dialogue.
	(search_set): Disable the search entry if we are doing a full
	search.

	* mail-vfolder.c (vfolder_create_storage): Yay, finally
	depeterised this stuff.
	(vfolder_uri_to_folder): Removed an irrelevant comment.

	* mail-callbacks.c (filter_edit): And here.

	* mail-ops.c (do_fetch_mail): And here too.

	* mail-autofilter.c (filter_gui_add_from_message): Fixed call to
	context_load.
	(filter_gui_add_for_mailing_list): And here too.

	* folder-browser-factory.c (create_ondemand_hooks): Remove that
	ondemand callback snot.

2000-10-05  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_init_etable): Build the etable once
	we know what folder we are going to use.
	(save_header_state): Save the header spec to a cache file.
	(message_list_destroy): Save the header spec.
	(message_list_setup_etable): Setup the etable spec for this
	folder, from a saved version if one exists, or to suit the folder
	type (sent/received).
	(message_list_set_folder): Setup the etable here once we have a folder.

2000-10-09  Michael Meeks  <michael@helixcode.com>

	* message-list.c (message_list_toggle_threads): re-write.

	* folder-browser-factory.c (control_activate): update paths, need
	CVS HEAD bonobo, use a listener not a verb.

2000-10-08  Miguel de Icaza  <miguel@helixcode.com>

	* mail-ops.c (mail_incorporate_messages): Tag string for translation
	(do_flag_messages): ditto.

	* mail-threads.c (pipe_write): Repeates writes on EINTRS.
	(pipe_read): Repeats reads on EINTRS.
	(mail_operation_queue): Use pipe_write
	(mail_op_set_percentage): ditto.
	(mail_op_hide_progressbar): ditto.
	(mail_op_show_progressbar): ditto.
	(mail_op_set_message): ditto.
	(mail_op_get_password): ditto.
	(mail_op_error): ditto.
	(mail_op_forward_event): ditto.
	(mail_operations_terminate): ditto.
	(dispatch): use pipe_read.
	(dispatch): use pipe_write
	(dispatch): ditto.

	* mail-ops.c (mail_incorporate_messages): Only show message being
	incorporated every 2 seconds, to avoid a bunch of CORBA round trips.
	(do_transfer_messages): ditto.
	(do_forward_messages): ditto.

2000-10-07  Miguel de Icaza  <miguel@helixcode.com>

	* mail-ops.c (do_fetch_mail): Move the functionality to
	incorporate messages into mail_incorporate_messages.
	(mail_load_evolution_rule_context): New function.  Move the
	functionality for loading the context rules to its own function.

2000-10-06  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c: Fix the locking up of the mail by only calling
	camel functions from the camel thread, and ORBit functions from
	the GTK thread. Watch for the message-changed signal again.

	* component-factory.c (summary_fn, component_factory_init):
	Re-enabled it, cos I think it works again.

	* mail-display.h: Remove the pb_cache.

	* Makefile.am: Readd the mail-summary.[ch] files and add the
	evolution-services library to the link.

2000-10-06  Chris Toshok  <toshok@helixcode.com>

	* mail-ops.c (do_scan_subfolders): set the @subscribed_only
	parameter to TRUE, since the subscribe UI is the only interface
	that should show unsubscribed groups.

2000-10-06  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (do_scan_subfolders): Add missing @subscribed_only
	parameter in the call to `camel_store_get_folder_info()'.  [FALSE,
	I hope that's right.]

2000-10-05  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (write_field_to_stream): Decode the header before
	writing it to the header box.

	* mail-callbacks.c (send_receieve_mail): fetch mail before
	sending, this is a temp fix for POP-before-SMTP authentication.

2000-10-05  Michael Meeks  <michael@helixcode.com>

	* component-factory.c (summary_fn, component_factory_init):
	Disable summary stuff, it appears to be badly broken.

	* Makefile.am (evolution_mail_SOURCES): add mail-summary.[ch]

	* subscribe-dialog.c (update_pixmaps): upd.
	(set_pixmap): upd.
	(subscribe_dialog_gui_init): upd.
	remove redundant and annoying forward definitions.

	* folder-browser-factory.c (control_deactivate): upd.
	(control_activate_cb): upd.
	(control_activate): upd.
	(set_pixmap): upd.
	(update_pixmaps): upd.
	(register_ondemand): upd.
	(create_ondemand_hooks): upd.

2000-10-04  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (address_compare): Use CamelInternetAddress
	instead of my quick hack (aka InternetAddress).

2000-10-05  Iain Holmes  <iain@helixcode.com>

	* mail-summary.c: Don't watch for the message-changed signal.

2000-10-05  Iain Holmes  <iain@helixcode.com>

	* component-factory.c (component_factory_init): Setup the summary
	factory as well.
	(summary_fn): New function to create the ExecutiveSummaryComponent.

	* mail-summary.c: Create the view, and update it when something 
	changes.

2000-10-04  Iain Holmes  <iain@helixcode.com>

	* mail-display.c (on_object_requested): Removed the pixbuf cache
	as it would return the pixbufs in the reverse order every so often
	and generally get all confused.

2000-10-04  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (control_deactivate): Add back the
	"sync folder on leave" hack that got lost in the UIHandler merge.

2000-10-04  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Instead of UnSelectAll, we want
	InvertSelection.

	* mail-callbacks.c (select_all): Finished this function.
	(invert_selection): Finished. (was unselect_all - but that's not
	what we really wanted as it'd be pointless. invert_selection is a
	much more useful callback :-)

2000-10-04  Chris Toshok  <toshok@helixcode.com>

	* mail-tools.c (mail_tool_get_root_of_store): remove news specific
	check.
	(mail_tool_uri_to_folder): news: -> nntp:

2000-10-04  Jeffrey Stedfast  <fejj@helixcode.com>
	
	* mail-ops.c (do_filter_ondemand): Don't expunge the source
	mailbox on completion.

2000-10-04  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (do_scan_subfolders): Don't try to add_folders if
	get_folder_info returned NULL.

2000-10-04  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (message_list_init_header): Fix the attachment
	icon width.
	(content_is_attachment): Perform some simple tests to see if the
	message contains an attachment.
	(build_subtree): Kill a pointless warning.

2000-10-04  Miguel de Icaza  <miguel@helixcode.com>

	* mail-callbacks.c (delete_msg): Added a comment to a piece of
	code that I was trying to "fix" just to find that the strange
	behaviour here that was about to be fixed, was actually a fix to
	the problem I was trying to fix.

	So put the original comments from Dan, and will hope that someone
	with more knowledge about this can figure why the delete key wont
	delete messages and select the next unread message.

2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (subscribe_dialog_destroy): destroy our
	tree_model and remove the root node.  also, release_unref our
	control and view, and unref the listener.

	* mail-tools.c (mail_tool_uri_to_folder): news url's contain host
	names too, now.

2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c, subscribe-dialog.h: add a
	storage-set-view-listener, and add a little printf saying what
	storage was selected.
	
2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.c (subscribe_dialog_gui_init): get
	Evolution::StorageSetView interface on our storage set view
	control, and set "show_folders" to FALSE.

2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* Makefile.am (INCLUDES): add -I$(top_srcdir)/widgets/misc

	* subscribe-dialog.c (subscribe_dialog_gui_init): change the
	window title to Manage Subscriptions, bold subscribed folders, and
	add a title bar ala the evolution shell (but without the close
	button).

2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* subscribe-dialog.h: add fields for the storage set
	Bonobo_Control and Evolution_StorageSetView interfaces.

	* subscribe-dialog.c (subscribe_dialog_gui_init): create the uih
	as early as possible, and add the storage set view to the left
	side of the hpaned.

2000-09-22  Michael Meeks  <michael@helixcode.com>

	* folder-browser-factory.c (set_pixmap): upd.
	(control_activate): upd.

2000-10-02  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c: Remove "Port" entry from source dialog. We'll
	use "host:port" like Netscape and other programs do.
	(service_page_get_url): If host ends in ":###", use that as port.
	(service_page_set_url): If URL contains a port, append it to the
	hostname, separated by a colon.

2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* Makefile.am (evolution_mail_SOURCES): subscribe-control.[ch] ->
	subscribe_dialog.[ch]

	* mail-callbacks.c (manage_subscriptions): subscribe_control ->
	subscribe_dialog.  Also, pass the shell to subscribe_dialog_new.

	* mail-types.h: SubscribeControl -> SubscribeDialog.

	* subscribe-dialog.c, subscribe-dialog.h: rename from
	subscribe-control.[ch].

	* subscribe-dialog.c (subscribe_dialog_construct): pass
	Evolution_Shell in.
	(subscribe_dialog_new): takes Evolution_Shell argument now.

2000-10-02  Chris Toshok  <toshok@helixcode.com>

	* message-list.c (message_list_init_renderers): remove the 2 tree
	pixbufs, so adjust the offsets to the score pixbufs.  also, pass
	NULL for the open/closed pixbufs to the tree cell renderer.

2000-10-02  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (mail_do_scan_subfolders, etc): Update for
	CamelFolderInfo changes.

	* message-list.c (message_list_destroy): Don't save_tree_state if
	there's no folder associated with the MessageList.

	* folder-browser.c (folder_browser_set_uri): Only call
	mail_do_load_folder if the URI is not "".

2000-10-02  Iain Holmes  <iain@helixcode.com>

	* mail-display.[ch]: Add a cache for the pixbufs, hashed on CID,
	so that we only have to make a thumbnail once.

2000-10-01  Iain Holmes  <iain@helixcode.com>

	* mail-display.c: Generate the thumbnails on an idle function so
	that the user interface isn't locked. Checks in case the widget it
	will use to display the image isn't destroyed.

2000-10-01  Iain Holmes  <iain@helixcode.com>

	* mail-display.c (on_object_requested): If the attachment is an
	image display a thumbnail of it, instead of the generic image
	icon.

2000-09-29  Miguel de Icaza  <miguel@helixcode.com>

	* folder-browser-factory.c: Add print preview verb here.

	* mail-callbacks.c (do_mail_print): Handle printing here, the
	complete engine.
	(mail_print_preview_msg): new. does print previewing.
	(mail_print_msg): does printing of the message.

2000-09-29  Chris Toshok  <toshok@helixcode.com>

	* subscribe-control-factory.c, subscribe-control-factory.h: nuked.
	
	* subscribe-control.c, subscribe-control.h: lots of changes.  we
	now pop up a dialog, and will have a storage set view on our left
	side, like the shell does.

	* mail.h: add prototype for manage_subscriptions.

	* mail-callbacks.c (manage_subscriptions): new function, pops up
	the subscribe dialog.

	* folder-browser-factory.c: add the verb for managing
	subscriptions.

	* Makefile.am (evolution_mail_SOURCES): add subscribe-control.[ch]
	again.

2000-09-28  Chris Toshok  <toshok@helixcode.com>

	* subscribe-control.h (subscribe_search): added prototype.

	* subscribe-control.c (subscribe_search): new function.

	* subscribe-control-factory.c (make_folder_search_widget): new
	function, to add search widget to toolbar.
	(control_activate): create the search widget and add it to the
	toolbar.

2000-09-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_send_queue): Messages should be appended to Sent
	as Seen.
	(do_send_mail): Same.

2000-09-28  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am: Don't compile `subscribe-control' for now.  It
	needs to be converted to the new UI handler code in Bonobo; it
	doesn't compile right now.

2000-09-27  Chris Toshok  <toshok@helixcode.com>

	* subscribe-control.c (subscribe_refresh_list): new function.

	* subscribe-control.h (subscribe_refresh_list): new prototype.

	* subscribe-control-factory.c (update_pixmaps): add RefreshList
	pixmap.  also, add it to the verbs list.
	
2000-09-27  Chris Toshok  <toshok@helixcode.com>

	* mail-types.h: add SubscribeControl typedef.

	* Makefile.am (evolution_mail_SOURCES): add the subscribe stuff.

	* subscribe-control-factory.h * subscribe-control-factory.c *
	subscribe-control.c: * subscribe-control.h: Mostly mocked up
	subscribe ui.

2000-09-27  Jeffrey Stedfast  <fejj@helixcode.com>
	Note: We need a configuration option to specify whether to log
	filtering actions or not.

	* mail-ops.c (do_filter_ondemand): Updated to pass a log file
	pointer to filter_driver_run.
	(do_fetch_mail): Same.
	(mail_do_fetch_mail): Fixed a compiler warning.

2000-09-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (composer_postpone_cb): Fix it so that "send
	later" will still mark a message as being replied, forwarded,
	whatever. Closes bug #568 on bugzilla.

2000-09-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_filter_ondemand): If the message has been
	deleted, don't try filtering it - skip to the next message.  Fixes
	bugzilla bug #639.

2000-09-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Shuffling (un)select all menu items to
	the Edit menu.

2000-09-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Added new menu items
	
	* mail-callbacks.c (mark_as_seen): New callback to mark all
	selected messages as Seen.
	(mark_as_unseen): New callback to mark all selected messages as
	Unseen.
	(select_all): New callback to select all messages (not yet
	finished)
	(unselect_all): New callback to unselect all messages (not yet
	finished)

2000-09-25  Not Zed  <NotZed@HelixCode.com>

	* message-list.c (folder_to_cachename): Function to convert a
	folder name/path to a filename for per-folder data.
	(save_tree_state):
	(load_tree_state):
	(free_tree_state): For loading/saving the state of the expansion
	of nodes in the tree.
	(message_list_destroy): Save the tree state when done.
	(save_node_state): Changed logic, we save when the node should be
	closed on startup.  i.e. any new nodes with children automatically
	default to being open.
	(subtree_unread): Check for unread messages in a subtree.  So
	false messages (for tree roots) are properly displayed.

2000-09-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (address_compare): Updated to use Nat's
	ENameWestern parser.

	* Makefile.am: link against e-util/ename/libename.la

2000-09-25  Dan Winship  <danw@helixcode.com>

	* mail-ops.c: CamelException is not for compile-time errors.
	Replace lots of argument checks in setup_ functions with
	g_return_if_fails in the public functions. Also remove some
	prototypes that weren't needed because they were for static
	functions that are defined before they're used.

2000-09-23  Michael Meeks  <michael@helixcode.com>

	* folder-browser-factory.c (set_pixmap): upd.
	(control_activate): upd.

2000-09-23  Ettore Perazzoli  <ettore@helixcode.com>

	* message-list.c (internet_address_new_from_string): Skip spaces
	at the beginning of the string first before doing anything else.
	The code that follows doesn't like the first character of the
	string to be a space.

2000-09-22  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (address_compare): New comparison function for
	email addresses.
	(subject_compare): New comparison function for message subjects.
	(message_list_init_header): Updated to use the new compare funcs.

2000-09-21  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_generate_reply): Fixed some memory
	leakage. Call free_recipients() so we don't leak memory.

2000-09-19  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_scan_subfolders): Use the folder's full_name so
	recursive directory structures display correctly ;-)

2000-09-19  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (do_scan_subfolders): Update for CamelFolder changes
	(subfolder_names -> subfolder_info).

2000-09-19  Dan Winship  <danw@helixcode.com>

	* mail-callbacks.c (create_msg_composer, compose_msg, send_to_url,
	mail_reply, forward_msg): * mail-format.c (mail_generate_reply): *
	mail-ops.c (cleanup_edit_messages):

	* mail-view.c (view_forward_msg): Deal with NULL composer.

2000-09-18  Dan Winship  <danw@helixcode.com>

	* main.c (main): Call gnome_vfs_init() since the composer now does
	file operations (to get the MIME type of attachments).

2000-09-18  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c: Removed COL_ONLINE_STATUS because we don't want
	that. Renamed COL_PRIORITY to COL_SCORE and set it up to sort-of
	work, I'm not really sure which renderer I should use.

2000-09-18  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Added $(EXTRA_GNOME_CFLAGS) and
	$(EXTRA_GNOME_LIBS).  Removed unneeded libraries.

	* component-factory.c, folder-browser-factory.c, folder-browser.c,
	mail-callbacks.c, mail-config-gui.c, mail-display.c,
	mail-display.h, main.c, message-list.c, message-list.h: Fixed the
	#include lines to deal properly with gal.

2000-09-16  Michael Meeks  <michael@helixcode.com>

	* Makefile.am (INCLUDES): add datadir

	* folder-browser-factory.c (control_activate): use it.

2000-09-15  Dan Winship  <danw@helixcode.com>

	* mail-callbacks.c (transfer_msg): Revert **Temp fix** from below
	since the relevant shell bug has been fixed now.

	* mail-ops.c (do_fetch_mail): Fix the sense of the "keep on
	server" check so we're not doing this backwards. Don't
	get_message_flags, because POP doesn't support it and it's
	pointless anyway since we're setting deleted, not toggling it.
	call camel_folder_sync with expunge=TRUE so that the deletions are
	actually recorded.

2000-09-15  Dan Winship  <danw@helixcode.com>

	This bug was so much fun to fix the first time that I decided to
	fix it again.

	2000-07-11  Dan Winship  <danw@helixcode.com>

		* mail-ops.c (real_send_mail): Set the post_send_data flag
		rather than toggling it. (Maybe we'll need more control
		over it later, but for now, the only flag we set is
		"replied", and we want that set, not toggled.)

2000-09-14  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (transfer_msg): **Temp fix** Send "" as the
	default folder to select as anything else seems to cause a
	segfault in shell's user_get_folder().
	(check_configured): A spoon full of 'line wrapping' makes the
	medicine go down, the medicine go dowwwwn...

2000-09-14  Iain Holmes  <terrorist@gegl.org>

	* mail-callbacks.c (check_configured): Ask if you want to 
	configure the mail client if it isn't configured already.
	(check_send_configuration): Remove the error box if mail isn't
	configured.
	(send_queued_mail): Same.

2000-09-14  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (setup_append_mail): camel_folder_append is perfectly
	happy to take a NULL info.

2000-09-14  Michael Meeks  <michael@helixcode.com>

	* folder-browser-factory.c: move fn to bonobo.
	(set_pixmap): update.
	(control_deactivate): add bonobo_ui_handler_unset_container

2000-09-14  Christopher James Lahey  <clahey@helixcode.com>

	* mail-config-gui.h: Changed the include here because it caused
	make distcheck to fail for me.  I changed it from <Evolution.h> to
	"shell/Evolution.h".  This seems to have fixed things.

2000-09-14  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Only use the cache if the user plans
	to keep_on_server.

2000-09-14  Michael Meeks  <michael@helixcode.com>

	* folder-browser-factory.c (control_deactivate): kill
	warning. (control_activate): set threaded toggle state,
	add freeze / thaw.
	(set_pixmap, fill_toolbar, update_pixmaps): update.

2000-09-13  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser-factory.c: Fixed a warning (Missing include
	file.)

2000-09-12  Ettore Perazzoli  <ettore@helixcode.com>

	($(EVOLUTION_MAIL_CORBA_GENERATED)): Add space after `-I'.

2000-09-12  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am: Remove `ui.xml' stuff.

2000-09-12  Dan Winship  <danw@helixcode.com>

	* mail-local-storage.c (mail_local_storage_startup): set
	folder_tree before adding the listener, since that will eventually
	invoke callbacks that will look at it.

	* folder-browser-factory.c (control_deactivate): sync the folder
	on deactivate.

2000-09-12  Ettore Perazzoli  <ettore@helixcode.com>

	* message-list.c (on_right_click): Also display the name of the
	mailing list in the "Filter on Mailing List" item for additional
	Coolness factor.

	* mail-autofilter.c (filter_gui_add_for_mailing_list): Create the
	rule with `filter_filter_new()' so that it also has an action
	part.

	* mail-mlist-magic.c (get_header): Use the right header name to
	retrieve the header.

2000-09-12  Ettore Perazzoli  <ettore@helixcode.com>

	* message-list.c (on_right_click): Grey out the mailing list
	filter item if `mail_mlist_magic_detect_list()' returns NULL on
	this message [i.e., if we cannot figure out a mailing list for
	this message].
	(filter_mlist): Good boys don't use F words.

	* mail-mlist-magic.c (check_sender): Work safely if
	`header_name_return' or `header_value_return' are NULL.
	(check_x_been_there): Likewise.
	(check_delivered_to): Likewise.
	(check_x_mailing_list): Likewise.
	(check_x_loop): Likewise.
	(get_header): Use the right header name to retrieve the header.

	* message-list.c (on_right_click): Mark strings for translation.

2000-09-12  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c: Use the latest, shiny, amazing TigerT
	art for the toolbar.

	* component-factory.c: #include "mail-local-storage.h".
	(owner_set_cb): Removed unused variable.

	* message-list.c (filter_sender): Made static.
	(filter_recipient): Likewise.
	(filter_subject): Likewise.
	(vfolder_recipient): Likewise.
	(vfolder_sender): Likewise.
	(vfolder_subject): Likewise.

	* mail.h (vfolder_subject): Removed prototype [WTF was this doing
	here?!?!].
	(vfolder_sender): Likewise.
	(vfolder_recipient): Likewise.
	(filter_subject): Likewise.
	(filter_sender): Likewise.
	(filter_recipient): Likewise.

	* message-list.c: Added a new "Filter on mailing list" menu item.
	(filter_mlist): Callback for this menu item.  Use
	`filter_gui_add_for_mailing_list' to pop up the filter dialog with
	the appropriate rule.

	* mail-autofilter.c (filter_gui_add_for_mailing_list): New.

	* message-thread.c (dump_tree): Removed unused variable.

	* mail-mlist-magic.c: New.
	* mail-mlist-magic.h: New.

	* mail-autofilter.c (rule_match_recipients): Mark strings for
	translation.
	(rule_from_message): Likewise.
	(filter_gui_add_from_message): Likewise.

2000-09-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Was trying to unhook an event from
	the wrong folder - oops.

2000-09-12  Not Zed  <NotZed@HelixCode.com>

	* message-thread.c: Reverted to version 1.15.
	(remove_node): Ok, if a node has a parent, remove it from the
	parent list, otherwise remove it from the (supplied) root list.
	(group_root_set): When we merge children, free the lost node.
	(thread_messages_free): Remove the return, run as is.
	(prune_empty): Plugged another small leak.

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (run_filter_ondemand): Updated to use the new
	mail_do_filter_ondemand.

	* mail-ops.c (do_fetch_mail): Update to use the new
	filter_driver_run args.
	(do_filter_ondemand): Updated to use the new filter_driver_run
	args.
	(mail_do_filter_ondemand): Take a FilterContext as a argument
	instead of a driver as we need to destroy the filter inside the
	do_filter_ondemand function and things'd get messy.

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Don't have the filter driver
	self_destruct.

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): If we're fetching from an mbox
	formatted file then we need to do some special-casing.

2000-09-11  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (owner_set_cb): Call
	`mail_local_storage_startup()' to set up handling of the local
	storage.

	* mail-local-storage.c: New.
	* mail-local-storage.h: New.

2000-09-11  Christopher James Lahey  <clahey@helixcode.com>

	* mail-display.c: Fixed some warnings.

2000-09-11  Dan Winship  <danw@helixcode.com>

	* mail-display.c, mail-format.c: Another big rewrite of this
	stuff. Now all (well, most) attachments get a small icon with a
	description and a (non-obvious) right-click pop-up menu with
	options to save, open in an external program, or show/hide inline.

	TODO: antialias the icon, add more options to the pop-up for
	certain MIME types, add an icon to the headers, fix PGP to work
	like everything else, fix message/external-body to work again,
	add some icon caching action, etc, etc.

2000-09-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Use the CamelUIDCache so that we
	only retrieve *new* messages and also send notes to the status bar
	telling it which message we're downloading so that Ettore can
	sleep at night ;-)

2000-09-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Updated to not send hook/unhook data
	to filter_driver_run as it no longer takes those args.
	(do_filter_ondemand): Same. Also wrap filtering in freeze/thaw to
	prevent signals from being queued up

2000-09-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Freeze the default folder before
	filtering and thaw it afterward to prevent a ton of
	"folder_changed" signals from being queued.

2000-09-08  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser.c, mail-config-gui.c, mail-ops.c: Fixed some
	warnings.

	* message-list.c: Added base ETableModel functions.

2000-09-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Updated to pass a CamelMessageInfo
	to filter_driver_run
	(do_filter_ondemand): Same.

2000-09-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_filter_ondemand): Updated to check the boolean
	return code from filter_driver_run to find out whether or not the
	message was filtered so that it can decide whether or not to
	delete the message from the source folder or not.

2000-09-07 Jesse Pavel <jpavel@helixcode.com>

	* mail-format.c (mail_generate_reply) Changed the behavior of
	Reply-to-All so that the sender's address does not appear in
	the cc: list.

2000-09-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Updated to pass an exception to
	filter_driver_run and also check the exception before deleting the
	message from the source folder.
	(do_filter_ondemand): Updated to pass an exception to
	filter_driver_run

2000-09-07  Dan Winship  <danw@helixcode.com>

	* session.c (session_init): Pass a storage dir to
	camel_session_new now.

	* main.c (main): Can't call session_init here now, because it
	requires evolution_dir to be set.

	* component-factory.c (owner_set_cb): call session_init here.

	* mail-ops.c (do_fetch_mail): Fix previous fix. (Free the uids,
	just do it correctly.)

2000-09-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (do_fetch_mail): Don't free uids, let the camel
	folder do that when it gets finalized

2000-09-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (mail_do_filter_ondemand): New async function to
	filter messages on demand.
	(do_fetch_mail): Updated to filter 1 message at a time using the
	new filter-driver code
	
	* mail-callbacks.c (composer_postpone_cb): Send NULL as the
	message info.
	(run_filter_ondemand): Use mail_do_filter_ondemand instead of
	filter_driver_run
	
	* mail-tools.c: Removed mail_tool_filter_contents_into and
	mail_tool_fetch_mail_into_searchable as they have now been
	deprecated.

2000-09-06  Dan Winship  <danw@helixcode.com>

	* message-list.c (clear_tree): set the data to NULL for the tree
	root, so nuke_uids won't try to free anything.

2000-09-06  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser.c (folder_browser_new): @shell made const.
	`CORBA_Object_duplicate()' it before storing it.
	(folder_browser_destroy): Free the shell object with
	`CORBA_Object_release()', not `CORBA_free()'.

	* folder-browser-factory.c (folder_browser_factory_new_control):
	@shell made const.

2000-09-05  Dan Winship  <danw@helixcode.com>

	* mail-display.c (make_safe_filename): 
	* mail-format.c (handle_mystery): 
	* mail-identify.c (mail_identify_mime_part):
	camel_mime_part_get_filename now deals with both
	Content-Disposition and Content-Type.

2000-09-05  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (cleanup_load_folder): Check for NULL folder.
	(mail_do_setup_folder): Copy the 'name' parameter so that
	we can free it.

	* message-list.c (nuke_uids): Depth '-1' means "unlimited", not 0.

2000-09-05  Dan Winship  <danw@helixcode.com>

	* component-factory.c (owner_set_cb): Re-rename "Sent".

	* folder-browser.c (fb_resize_cb): Remove the "+ 90" here since it
	seems to break things for me, and it's not commented anyway and
	there's no excuse for adding 90 to a number with no explanation.

2000-09-05  Peter Williams  <peterw@helixcode.com>

	* folder-browser.c (folder_browser_destroy): Don't free the shell;
	it's not ours.

2000-09-05  Dan Winship  <danw@helixcode.com>

	* mail-tools.c (mail_tool_move_folder_contents): only call
	camel_folder_get_message_info if the folder has
	summary_capability. Don't hack up a fake CamelMessageInfo:
	append_message will take NULL.

	* mail-ops.c: Replace mail_do_setup_draftbox,
	mail_do_setup_outbox, and mail_do_setup_sentbox with
	mail_do_setup_folder.
	(do_send_mail, do_send_queue): s/sentbox_folder/sent_folder/

	* component-factory.c (owner_set_cb): Use mail_do_setup_folder,
	rename sentbox_folder to sent_folder, and call
	mail_operation_wait_for_finish after the setup_folder calls in
	case anything needs to use the _folder variables.
	
2000-09-04  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_generate_reply): Applied Jesse's patch that
	will append a signature to the replied message text

	* folder-browser-factory.c: Changed "Send & Receieve" back to "Get
	Mail" temporarily so that the toolbar buttons don't all get
	stretched to some weird proportion

2000-09-03  JP Rosevear  <jpr@helixcode.com>

	* mail-config.c (mail_config_add_news): Copy the passed in item
	before adding
	(mail_config_add_source): ditto
	(mail_config_add_identity): ditto

	* mail-config-gui.c (mail_config): We don't actually need a notebook
	pointer.
	(identities_edit_clicked): Don't explicitly destroy, we are using
	gtk_clist_set_data_full now
	(sources_edit_clicked): ditto
	(news_edit_clicked): ditto
	(mail_config): Use gtk_clist_set_row_data_full to kill leaks

2000-09-03  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Change the "Get Mail" toolbar button
	to become "Send & Receieve"

	* mail-callbacks.c (send_queued_mail): New callback function for
	sending queued mail
	(send_receieve_mail): New callback for Send & Receieve that
	basically just calls send_queued_mail and then fetch_mail

	* mail-ops.c (cleanup_send_mail): Mod to be able to handle a NULL
	composer window
	(setup_send_mail): Modified to handle a NULL composer widget
	(mail_do_send_queue): New convenience async function to send all
	messages in a folder (aka all messages in a queue)

2000-09-02  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-tools.c (mail_tool_move_folder_contents): Since POP3
	doesn't implement get_message_info, we need to check for info to
	be NULL. In this case, we need to make our own info structure to
	pass to append_message and then remember to free it
	afterward. Should we even bother with get_message_info? And if so,
	should we then implement get_message_info for POP3?

2000-09-02  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser.c (etable_key): Make the `Home' key to move to
	the beginning of the list and `End' to the end of it, using
	`message_list_home()' and `message_list_end()'.

	* message-list.c (message_list_home): New.
	(message_list_end): New.

	* folder-browser.c (folder_browser_new): Don't ref the shell here.
	(folder_browser_destroy): Don't unref the shell.  Instead,
	`CORBA_free()' the object reference.

	* folder-browser-factory.c (control_activate): Bind "Open in New
	Window" to `Ctrl-O'.

2000-09-02  Lauris Kaplinski  <lauris@helixcode.com>

	* mail-config-gui.c: Use e_utf8 wrappers

	* main.c (main): Do e_unicode_init, so we are not confusing
	libunicode

2000-09-01  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser.c: Removed a warning.

2000-09-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (compose_msg): Attach a callback to the
	postpone signal
	(send_to_url): Same
	(mail_reply): Same
	(forward_msg): Same
	(composer_postpone_cb): Callback function for the postpone signal

	* mail-ops.c (mail_do_setup_outbox): New convenience function to
	load the Outbox folder
	(mail_do_setup_sentbox): Same, but for Sentbox.
	(do_send_mail): Now saves messages in Sentbox if sent successfully
	(mail_do_append_mail): New convenience async function for
	appending messages to a folder
	
	* component-factory.c: Added outbox_folder and sent_folder
	(owner_set_cb): Call our new convenience functions to load Outbox
	and Sentbox

2000-09-01  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (cleanup_scan_subfolders): Update for the extra arg
	needed by `evolution_storage_new_folder()'.
	* mail-vfolder.c (vfolder_refresh): Likewise.

2000-08-31  Peter Williams  <peterw@helixcode.com>

	* folder-browser.c (folder_browser_new): Don't ref the shell:
	causes a race upon exit.
	(folder_browser_destroy): Don't unref it.

	* mail-config-gui.c (service_page_item_new): Add a checkbutton
	"use default port" to make life simple.
	(service_page_get_url): Honor use_default_port.
	(service_page_set_url): Set use_default_port based on the input
	URL.
	(toggle_port): New function, sets the sensitivity of the
	port entry based on "use default port"

	(config_do_query_authtypes): Make this asynchronous, as it
	may involve connecting to a server.
	(service_page_detect): Call the async auth querier.
	(service_page_item_new): Put the authentication stuff in if
	the url_flags have URL_ALLOW_AUTH. Call the async auth querier
	to get the info.
	
2000-08-30  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-view.c (mail_view_create): Make the HTML widget grab the
	focus.

2000-08-30  Peter Williams  <peterw@helixcode.com>

	* mail-config-gui.c (do_test_service): Explicitly connect to
	the service again.

	* component-factory.c (mail_load_storages): Now that 
	camel_service_get_provider exists, use it to make this function
	much simpler.

2000-08-29  Peter Williams  <peterw@helixcode.com>

	* folder-browser.c (folder_browser_new): Ref the Evolution_Shell.
	Is this correct, or is it a circular reference?
	
2000-08-29  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (mail_do_send_mail): Update this and related
	functions to no longer take a From address. (The composer deals
	with it itself now.)
	(do_send_mail): Add the Evolution version back to the X-Mailer
	header (this change got lost in the thread migration).

	* mail-callbacks.c (composer_send_cb): Don't re-fetch the From
	address. It's set by the composer now. Don't free the
	post_send_data from here.
	(mail_reply): Attach to the composer's destroy signal to free the
	psd. (The current code would free it more than once if an error
	occurred while trying to send the first time.)

2000-08-28  Peter Williams  <peterw@helixcode.com>

	* mail-config-gui.c (mail_config_apply_clicked): Add new news sources,
	not only stores.

2000-08-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (composer_send_cb): Free the from address when
	we're done with it. Also, e_msg_composer_hdrs_get_from returns
	alloc'd memory so don't strdup it.

2000-08-28  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (do_transfer_messages): Add status messages.
	(do_flag_messages): Same.
	(do_scan_subfolders): Same.
	(do_forward_messages): Same.
	(do_view_messages): Same.

2000-08-28  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-view.c (mail_view_create): Use `gnome_app_set_toolbar()'
	the easy way instead of doing things manually with `GnomeDock' and
	`gnome_app_add_toolbar()'.
	(MINIMUM_WIDTH): New #define.
	(MINIMUM_HEIGHT): New #define.
	(view_size_allocate_cb): New, callback for the "size_allocate"
	signal of the mail view.  It saves the last allocation in a static
	`last_allocation' variable.
	(mail_view_create): Connect it.
	(set_default_size): New function.  Set the default width/height to
	the last allocation width/height; if the width/height is less than
	the `MINIUM_WIDTH' or `MINIMUM_HEIGHT', use that value instead.

	* mail-tools.c (mail_tool_move_folder_contents): Show `i + 1', not
	`i', so that we correctlly start counting from one instead of zero.

2000-08-28  Peter Williams  <peterw@helixcode.com>

	* *.c: s,mail_dialog_run,gnome_dialog_run,g.

	* main.c (main): Since only the main thread is dealing with GTK+,
	free the GDK threads mutex and never worry about locking again.

2000-08-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-crypto.c (mail_crypto_openpgp_encrypt): Fix to prevent
	possible buffer overflows and a logic fix.

2000-08-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-crypto.c (mail_crypto_openpgp_clearsign): New crypto
	function to clearsign plaintext

2000-08-27  Ariel Rios  <ariel@arcavia.com>

	* folder-browser-factory.c (control_activate): Added bonobo menu
	handler for mark_all_deleted function.

	* mail.h: (mark_all_deleted): Added prototype.

	* mail-callbacks.c (mark_all_deleted): Added callback for marking
	all displayed messages in a folder as deleted.

2000-08-26  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-view.c (mail_view_create): Use
	`gtk_window_set_default_size' on the toplevel instead of
	`gtk_widget_set_usize()', and make the default size smaller.

2000-08-25  Christopher James Lahey  <clahey@helixcode.com>

	* mail-crypto.c: Fixed an uninitialized variable.

2000-08-26  JP Rosevear  <jpr@helixcode.com>

	* evolution-mail.gnorba: Kill

	* Makefile.am: Remove gnorba related stuff

2000-08-25  Peter Williams  <peterw@helixcode.com>

	* mail-config-gui.c (service_page_item_new): If the service wants
	a host, also let the user specify a port.
	(MailDialogServicePageItem): Add members for the port GtkEntry and
	the default port.
	(service_page_get_url): Translate the port in the entry back into
	the CamelURL.
	(service_page_set_url): Read in the port from the URL or use
	the default.

2000-08-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-crypto.c (mail_crypto_openpgp_encrypt): Implemented PGP 2.x
	encryption. We only need to get the passphrase if we plan to sign
	the text, otherwise we don't need to worry about getting the
	passphrase.

2000-08-24  Lauris Kaplinski  <lauris@helixcode.com>

	* folder-browser.c: Use e_utf8 wrappers

	* mail-config-gui.c: Use e_utf8 wrappers

2000-08-24  Peter Williams  <peterw@helixcode.com>

	* folder-browser-factory.c (control_activate): Add all the
	functions from message-list.c's popup menu to the main
	menu as well

	* message-list.c (vfolder_subject): These functions become
	public.

	* mail-callbacks.c (mark_all_seen): Don't call camel_folder_get_uids
	here. IMAP, for example, will try to communicate with the IMAP
	server during that call.

	* mail-ops.c (cleanup_fetch_mail): Tell the user
	which URL has no new mail, as they may be checking
	more than one source.
	(mail_do_flag_all_messages): New function. Flags all of
	the messages in a folder. Something of a hack. This merely
	extends the flag_messages operation; it doesn't implement
	a new one.
	(do_flag_messages et al): Fetch the uids if we need to;
	use camel_folder_free_uids if necessary, etc.
	
	* mail-tools.c (mail_tool_move_folder_contents): Add
	messages to tell the user what's going on.

2000-08-24  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser-factory.c: Fixed some warnings in the uihandler
	code.

2000-08-24  Peter Williams  <peterw@helixcode.com>

	* component-factory.c (mail_load_storages): New function.
	Loads a list of URI's as mail storages, and inserts them
	into the shell's folder tree if appropriate (really, only
	puts them into the folder tree.)
	(mail_add_new_storage): Insert a storage into the folder
	tree. Not always appropriate (eg, /var/spool/mail/user is
	a storage that shouldn't be in the folder tree.)
	(create_view): Generate the Evolution_Shell and pass it
	to folder_browser_factor_new_control so that its member
	'shell' can be set.
	(owner_set_cb): Instead of create_news_storage and
	creating the imap storages, load the news storages and
	mail storages via mail_load_storages().

	* folder-browser-factory.c (control_activate): Change to
	use providers_config again instead of mail_config. Pass
	the folderbrowser so that the config code knows where
	to insert the new storages if any are created. Pass
	forget_passwords the folderbriwser, too, for good luck.
	(folder_browser_factory_new_control): Take a new parameter,
	the Evolution_Shell that we belong to. The field in
	FolderBrowser has been there but was never getting set by
	anything, and we need this to be able to insert new storages
	into the shell's folder list.

	* folder-browser.c (folder_browser_new): Accept the
	new Evolution_Shell parameter. Set it. (Should we 
	ref it or something?)

	* mail-config-gui.c (struct MailDruidDialog): Store an
	Evolution_Shell. With this we can insert the stores into 
	the shell's folder list.
	(struct MailDialog): Same.
	(service_page_item_changed): Close a leak.
	(identity_dialog): Unswitch the Add/Edit identity titles.
	(news_dialog): Analogous to above.
	(mail_druid_finish): Add the new mail source to the shell
	view.
	(mail_config_druid): Take a new Evolution_Shell parameter
	for later use.
	(mail_config_apply_clicked): Add all the mail sources to
	the shell view.
	(mail_config): Take a new Evolution_Shell parameter.

	* mail-callbacks.c (check_configured): Accept a FolderBrowser
	so that we know where to put the new storages if any are
	created. Almost all the callbacks are passed a FB * anyway
	so this isn't a big deal.
	(check_send_configuration): Make sure that we're configured
	enough to be able to send mail. composer_send_cb() used to
	do this, but it would need a FolderBrowser *, and there are
	too many entry points to composer_send_cb to make this
	feasible.
	(fetch_mail): Pass the extra parm to check_configured().
	(free_psd): Move so that composer_send_cb can call this
	directly.
	(composer_send_cb): Don't check for proper configuration
	here -- it is the caller's responsiblity to call
	check_send_configuration(). Call free_psd() directly.
	(compose_msg): Call check_send_configuration().
	(send_to_url): Same. This is called from mail-display.c,
	though, and cannot reasonably be passed a FB. So: we can't
	start up the config dialog directly; the user must do it
	manually. Oh well.
	(mail_reply): Same as above.
	(forward_msg): Same as compose_msg().
	(edit_msg): Same as above.
	(providers_config): Reenable so that we can pass mail_config
	its FolderBrowser.
	
	* mail-display.c (write_data_to_file): Use the much more
	straightforward run_and_close to retrieve the user's answer,
	instead of the reply callback stuff.

	* mail-threads.c (mail_dialog_run): New wrapper for 
	gnome_dialog_run that will take care of the GDK lock correctly.
	Far far more complicated than it should be.
	(mail_dialog_run_and_close): Analogous to above.
	(read_msg): Set inside_read_msg and unset it for the benefit
	of the two above functions. Don't bracket ourselves in 
	GDK_THREADS_ENTER/_LEAVE anymore.
	(mail_operation_queue): Use mail_dialog_run_and_close.
	(show_error): As above.
	(get_password): As above.
	
	* mail-display.c (write_data_to_file): This has the only
	exception to the rule that "use mail_dialog_run(_and_close)
	instead of the gnome equivalent always." Not quite sure why
	it doesn't work here (the file selection window?).

	* mail-config-gui.c (identity_dialog): Change to
	mail_dialog_run_and_close.
	(source_dialog): Same as above.
	(news_dialog): Same as above.
	(cleanup_test_service): Same as above.
	(mail_config): Change to mail_dialog_run().

	* session.c (mail_request_dialog): Change to 
	mail_dialog_run_and_close.

	* mail-tools.c (mail_tool_uri_to_folder_noex): As above.

	* mail-ops.c (cleanup_fetch_mail): As above.

	* mail-local.c (local_reconfigure_folder): As above.

	* mail-callbacks.c (check_send_configuration): As above.
	(ask_confirm_for_empty_subject): As above.
	(edit_msg): As above.
	(filter_edit): As above.

2000-08-23  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (control_activate): Reformat a bit,
	make "Folder" appear before "Message", fill in the Message menu
	more.

2000-08-23  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (describe_fetch_mail): Don't use the camel calls
	to describe the operation.

2000-08-22  Peter Williams  <peterw@helixcode.com>

	* mail-tools.c (mail_tool_get_folder_from_urlname): Don't connect 
	to the service explicitly.
	(mail_tool_send_via_transport): Don't connect to the transport
	explicitly.
	(mail_tool_get_root_of_store): Same.

	* mail-config-gui.c (do_test_service): Just try camel_session_get_service,
	which will now connect for us.

	* message-thread.h: Add a note about *next being the first member
	of struct _container... if it isn't, everything goes Very Wrong.

	* message-thread.c (free_container): Extra debug print.
	(remove_node): Handle the case of empty containers holding the child
	that we're interested in.
	(thread_messages_free): Extra debug print.

2000-08-20  Jeremy Wise  <jwise@pathwaynet.com>
	* folder-browser.c: (fb_resize_cb) Added function to monitor resize
	of the e_paned in the main view.

2000-08-18  Peter Williams  <peterw@helixcode.com>

	* mail-tools.c (mail_tool_filter_contents_into): Fix a race. filter_driver_run is an
	async operation so it won't even be started by the time we sync the folders and check
	for the movemailbox to be emtpy. Thus the empty check for the movemail would fail
	99% of the time.

	* mail-callbacks.c (run_filter_ondemand): Pass he new argument to the ever-mushrooming
	filter_driver_run.

2000-08-17  Peter Williams  <peterw@helixcode.com>

	* folder-browser-factory.c (control_activate): Fix menu item names.
	(register_ondemand): Put the ondemand hooks into the new folder menu.

2000-08-17  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-vfolder.c (vfolder_gui_add_rule): Use stock OK/Cancel
	buttons and add i18n support.

	* folder-browser-factory.c (control_activate): Changed menu item
	label from "Mark all messages seen" to "Mark All Messages as
	Read".  Changed capitalization of some other menu items.
	(control_activate): Put the message- and folder- related menu
	items in new "Message" and "Folder" subtrees which are created in
	the `<Component Placeholder>' item created by the shell.
	(control_deactivate): Updated accordingly.
	(control_activate): Put the filter and vfolder editors, the mail
	configuration and the "forget password" command into the
	"settings" menu.
	(control_deactivate): Updated accordingly.

	* mail-config-gui.c (transport_page_new): Add translation mark.
	(service_page_new): Show the menu items before appending them.
	(service_page_item_new): Use `GTK_FILL' for the "Detect supported
	types..." button.

	* local-config.glade: Change the apply button into an ok button.

2000-08-17  Peter Williams  <peterw@helixcode.com>

	Implement filtering on demand.
	
	* folder-browser-factory.c (register_ondemand): New function. Callback
	to put the filter-on-demand filters into the bonobo UIH;
	(create_ondemand_hooks): New function. Read in our on-demand filters 
	and hook them into the UI.
	(remove_ondemand_hooks): New function. Remove the hooks when done with
	them.
	(control_activate): Call create_ondemand_hooks()
	(control_deactivate): Call remove_ondemand_hooks();

	* mail-callbacks.c (run_filter_ondemand): New function. Callback
	for running a filter on demand.
	(filter_edit): Pass NULLs as the new arguments to rule_context_load.
	
	* mail.h: Prototype run_filter_ondemand();

	* folder-browser.c (oc_destroy): New function. Iterator to destroy
	an fb_ondemand_closure.
	(folder_browser_destroy): Free the data associated with the ondemand
	menu items.
	(my_folder_browser_init): Clear the filter_ variables.

	* folder-browser.h: Two new members of FolderBrowser: filter_menu_paths,
	a list of fb_ondemand_closures so that the menu items can be freed and
	removed; and filter_context, a permanently loaded FilterContext for
	running the ondemand filters. Prototype the new fb_ondemand_closure
	structure.

	* mail-autofilter.c (filter_gui_add_from_message): Pass NULLs as the
	new parameters to rule_context_load (we don't need to hook up ondemand
	menu items...)

	* mail-tools.c (mail_tool_filter_get_folder_func): Rename from 
	get_folder_func() and make public so mail-callbacks.c:run_filter_ondemand()
	can use it too.
	(mail_tool_filter_contents_into): Use the new name of get_folder_func.
	Pass NULLs as the extra arguments to rule_context_load. Pass the
	extra source type to filter_driver_run (only use INCOMING).

	* mail-tools.h: Publicly prototype mail_tool_filter_get_folder_func()

	* mail-vfolder.c (vfolder_create_storage): Pass NULLs as the extra 
	arguments to rule_context_load.

	* message-list.c (message_list_init): Free our strdup'd uids when
	the table model gets destroyed.
	(nuke_uids): New function. Walk the tree nodes to free the uids.
	(nuke_uids_cb): New callback for nuke_uids();


2000-08-16  Richard Hult  <rhult@hem.passagen.se>
 
 	* mail-ops.c (cleanup_display_message): Use a configurable timeout.
 
 	* mail-config.c (mail_config_set_mark_as_seen_timeout): New function
 	for the settable mark-as-seen timeout.
 	(mail_config_mark_as_seen_timeout): Likewise.
 	(mail_config_write): Write the timeout setting.
 	(config_read): Read timeout setting.
 
 	* mail-config-gui.c (mail_config): Add option for the settable
 	mark-as-seen timeout.
 	(mail_config_apply_clicked): Likewise.
 	(timeout_changed): New function for the timeout setting.
	
2000-08-16  Peter Williams  <peterw@helixcode.com>

	* message-thread.c (walk_containers): More (default disabled)
	mem debugging here. Fix the big leaks.

	* mail-format.c (get_url_for_icon): Copy the url_path so that
	it can't get freed under us.

	* mail-threads.c (mail_operation_queue): Fix a leak.

	* mail-ops.c (mail_do_display_message): Fix another leak.

	* message-list.c (message_list_destroy): Remove the seen_id timeout
	if necessary.

	* mail-local.c (mail_tool_local_uri_to_folder): Fix a leak.

	* session.c (auth_callback): Fix a leak. Almost seems as if
	I've been using Purify...


2000-08-15  Peter Williams  <peterw@helixcode.com>

	* message-thread.c (alloc_container): Add support for debugging
	container allocations -- currently disabled. Make sure that
	the g_strfreev works.

	* message-list.c (main_message_changed): Address bug #496 --
	possible race when forwading a message_changed event.

	* mail-threads.c (dispatch): Close the dispatch thread's half of
	pipes when about to exit.
	(mail_operations_terminate): Close the main thread's half of the
	pipes when about to exit.
	(all): Add i18n support.
	
	* mail-tools.c (all): Add i18n support.

	* mail-ops.c (transfer_messages): Generalize move_messages into
	transfer_messages so that we can copy too.
	(all): Add i18n supprt where appropriate.

	* mail-ops.h: Prototype the new mail_do_transfer_messages.

	* folder-browser-factory.c: Add a UI hook for copy_msg.

	* mail-callbacks.c (transfer_msg): Generalize move so that it supports
	copy as well, and add a callback 'copy_msg'.

	* message-list.c (on_right_click): Add a right-click hook for Copy Message.

	* session.c (mail_request_dialog): Don't deadlock when in main thread.
	
2000-08-14  Peter Williams  <peterw@helixcode.com>

	* mail-threads.c (show_error): Fix the error dialogs.
	(read_msg): Re-enable them.

	* mail-ops.c (do_scan_subfolders): Silence a compile warning.

2000-08-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-crypto.c (mail_crypto_openpgp_encrypt): Added support for
	encrypting via PGP 5.0

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (cleanup_create_folder): Release the listener object
	with `CORBA_Object_release()', not `CORBA_free()'.

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* main.c (main): Set the signal handlers for `SIGSEGV' and
	`SIGBUS' to the default ones.

2000-08-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (mail_config_write): Set config->configured to
	TRUE

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-config-gui.c (mail_config_druid): Don't
	`GDK_THREADS_ENTER()'/`GDK_THREADS_LEAVE()'.

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-threads.c (update_active_views): Just iterate through all
	the controls, not just the active ones.

	* folder-browser-factory.c: Don't keep track of active controls.
	Rather, keep track of all of them.
	(folder_browser_factory_get_active_control_list): Removed.
	(folder_browser_factory_get_control_list): New.

2000-08-13  Dan Winship  <danw@helixcode.com>

	* Makefile.am (evolution_mail_SOURCES): add mail-local.h

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-threads.c (read_msg): For now, don't do anything about
	errors.

2000-08-13  Dan Winship  <danw@helixcode.com>

	* mail-format.c (add_url): Fix some freed-memory references

	* mail-threads.c (get_password): Don't free the prompt. It
	doesn't belong to you.

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (mail_do_create_folder): Duplicate the listener
	object.
	(cleanup_create_folder): Free the listener.

2000-08-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-threads.c (get_password): Don't wrap the gnome_dialog_run
	in GDK_THREADS_ENTER/LEAVE

2000-08-13  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c (control_destroy_cb): Remove the
	control from the active control list, if it's there.

	* mail.h (folder_browser_factory_new_control): Removed prototype.
	(folder_browser_factory_init): Removed prototype.

	* folder-browser-factory.h: New.

	* folder-browser-factory.c: New static variable `active_controls',
	list of the currently active controls.
	(control_activate): Add the control to it.
	(control_deactivate): Remove the control from it.
	(folder_browser_factory_get_active_control_list): New.

	* mail-threads.c (mail_operations_get_status): New function.

	* folder-browser.c (folder_browser_gui_init): Add i18n support for
	the labels.

	[The following is actually from a patch by Peter Williams
	<peterw@helixcode.com>.]

	* Removed types `PERCENTAGE', `HIDE_PBAR', `SHOW_PBAR'.  New
	struct `block_info_s'.  Removed all the code to create and destroy
	the progress window.

2000-08-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* component-factory.c (create_news_storage): Updated to reflect
	changes to mail_do_scan_subfolders
	(create_imap_storage): Same.

	* mail-ops.c (mail_do_scan_subfolders): No longer takes an
	add_INBOX argument

2000-08-13  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (do_scan_subfolders): Lose a reference to the store
	on purpose. To be fixed later.

2000-08-12  Dan Winship  <danw@helixcode.com>

	* component-factory.c (create_imap_storage): Take the source as a
	command-line argument rather than fetching it from mail-config.
	(owner_set_cb): Call create_imap_storage on each configured IMAP
	store.

	* mail-format.c (decode_pgp): Redo this so that the lock icon
	remains active after a failed decryption so you can click on it
	and try again.
	(try_inline_pgp, handle_multipart_encrypted): Put a border around
	the decrypted data.

	* message-list.c (cleanup_regenerate_messagelist): Don't clear the
	tree here. If two "folder_changed"s arrive in close succession,
	then one possible ordering of events is
	cleanup_regenerate_messagelist, cleanup_regenerate_messagelist,
	cleanup_thread_messages, cleanup_thread_messages. Which would
	result in the message list being filled in twice without being
	cleared in between. So don't clear it until the rebuilding
	function itself is called.
	(clear_tree): New function to empty out the ETreeModel in the
	message list.
	(build_tree): Change to simpler interface. Call clear_tree.
	(build_subtree): Does most of the work of the old build_tree
	(build_flat): Remove unused arg. Call clear_tree.

	* message-thread.c (cleanup_thread_messages): Update for
	build_tree interface change.

	* mail-ops.c (do_send_mail): Don't leak the transport.

	* mail-tools.c (mail_tool_get_folder_from_urlname): Don't ref the
	store returned from camel_session_get_store. It's already reffed.
	(mail_tool_get_root_of_store): Ditto.
	(mail_tool_send_via_transport): Remove some commented-out code and
	fix it to not leave the transport connected if sending fails.

	* mail-callbacks.c (delete_msg): Toggling a flag is an
	"instantaneous" operation, so if we're only doing one, just do it
	and return, rather than queueing it for the other thread. This
	makes the "Delete" key work correctly (move to the next message)
	again.

	* mail-identify.c: Remove workaround for gnome-vfs 0.2 bug.

	* mail-format.c (lookup_handler): Remove workaround for function
	introduced between gnome-vfs 0.2 and 0.3, since we depend on 0.3
	now.

2000-08-12  Michael Meeks  <michael@helixcode.com>

	* main.c (main): kill using_oaf assertion.

2000-08-11  Peter Williams  <peterw@helixcode.com>

	* Makefile.am: Make it so that test-mail links

2000-08-11  JP Rosevear  <jpr@helixcode.com>

	* folder-browser-factory.c (control_activate): Move menu items
	that affect a single message together, ditto with ones that
	affect multiple messages, put a separator in.

2000-08-11  Christopher James Lahey  <clahey@helixcode.com>

	* mail-format.c, mail-tools.h, message-list.c: Fixed a warning.

2000-08-11  Dan Winship  <danw@helixcode.com>

	* mail-display.c, mail-format.c: Redo this again. Get rid of
	struct mail_format_data and move most of that info into
	MailDisplay itself, and pass the MailDisplay around. Add a GData**
	to MailDisplay, and put the urls hash table into that. Also add
	the ability to redisplay the currently-displayed message (with the
	same GData**), and add a "show_pgp" datum to it that controls
	whether or not to decrypt PGP messages, and redo the PGP stuff
	(again) to take that into account. Now you don't get the annoying
	PGP password dialog box without any warning.

2000-08-11  Peter Williams  <peterw@helixcode.com>

	* mail-config-gui.c (service_acceptable): Make verify-service
	an asynchronous operation.

	* Makefile.am (noinst_PROGRAMS): Don't build test-thread
	while mail-threads.c is in flux.

	* mail-threads.c (mail_operation_queue): Make the error
	and query dialogs modal.

	* mail-local.c (update_progress): Don't use the
	temporarily-disabled mail_op_set_percentage().

2000-08-11  Chris Toshok  <toshok@helixcode.com>

	* mail-config.c (mail_config_get_default_news): use config->news
	instead of config->sources.

2000-08-11  Dan Winship  <danw@helixcode.com>

	* mail-format.c (destroy_part): Update this for CamelObject
	(try_inline_pgp): Deal with decrypting here rather than trying to
	pawn the data off to handle_multipart_encrypted, since it most
	likely won't be correct (won't have the proper MIME headers inside
	the encrypted part).
	(handle_multipart_encrypted): Add code from Nathan Thompson-Amato
	to re-MIME-parse the decrypted data after decrypting.

	* mail-crypto.c (mail_crypto_openpgp_{de,en}crypt): Get the
	password here rather than having it passed in. Remove some dead
	code.

	* session.c (mail_request_dialog): Allow this to work in either a
	sync or an async context.

2000-08-11  Peter Williams  <peterw@helixcode.com>

	* mail-tools.c (mail_tool_fetch_mail_into_searchable): Don't
	do the imap check here... it's a silly place.

	* mail-ops.c (do_fetch_mail): Do the imap check here.

2000-08-11  JP Rosevear  <jpr@helixcode.com>

	* mail-config-gui.c (service_page_new): Work around
	gtk option menu bug.
	(service_page_item_auth_fill): ditto

2000-08-11  Peter Williams  <peterw@helixcode.com>

	* mail-threads.c (read_msg): Fix the new FORWARD_EVENT handler
	(didn't free msg, didn't write newline in the debug)

	* mail-local.c (local_reconfigure_folder): Make the dialog
	modal.

	* mail-callbacks.c (select_first_unread): Fix some warnings.

	* mail-threads.c (mail_op_forward_event): New function that
	writes a FORWARD_EVENT signal to the compipe, to allow Camel
	events to be handled in the main thread.
	(read_msg): Handle a FORWARD_EVENT.

	* mail-callbacks.c (select_first_unread): Forward the
	event into the main thread to prevent the GTK calls in the
	dispatcher thread. 
	(main_select_first_unread): New name of old select_first_unread.

	* message-list.c (folder_changed): Same as above.
	(main_folder_changed): Same as above.
	(message_changed): Same as above.
	(main_message_changed): Same as above.

	* mail-format.c (free_byte_array): Note about using
	mail_op_forward_event. (cmm_destroyed): Same.

2000-08-11  Dan Winship  <danw@helixcode.com>

	* message-list.c (message_list_select): If the caller passes "-1"
	for the model row, translate that to view row 0.

	* message-list.c (idle_select_row): 
	* mail-callbacks.c (select_first_unread): Use new
	message_list_select kludge^H^H^H^H^H^Hfeature

2000-08-11  JP Rosevear  <jpr@helixcode.com>

	* mail-config-gui.c (source_dialog): Allow the window
	to be growable

	* mail-config.c: use void in empty declarations

2000-08-11  Peter Williams  <peterw@helixcode.com>

	* mail-config.c (mail_config_get_news): Change () to (void)
	if a function takes no arguments.
	
	* mail-config.h: Prototype mail_config_get_{sources,news}x

2000-08-11  JP Rosevear  <jpr@helixcode.com>

	* mail-config-gui.c (identity_dialog): iddialog, not sdialog
	(news_edit_clicked): Kill leftover c-p crud

2000-08-11  JP Rosevear  <jpr@helixcode.com>

	* mail-config-gui.c (news_edit_clicked): Check nrow, not srow.

2000-08-11  JP Rosevear  <jpr@helixcode.com>

	* mail-config-gui.c (service_acceptable): Use camel_object_unref
	instead of gtk_object_unref
	(mail_druid_finish): Use new config accessors
	(mail_config_druid): No need to call config functions
	(news_add_clicked): Increments maxnrow, not maxsrow
	(mail_config_apply_clicked): Use new config accessors
	(mail_config): ditto

	* component-factory.c (create_imap_storage): Use new
	config accessors
	(create_news_storage): ditto

	* mail-config.glade: Set news clist name correctly

	* mail-config.c (config_read): Rename from mail_config_read and
	made private - no one should need to do a read manually.
	(mail_config_set_send_html): New accessor
	(mail_config_add_identity): ditto
	(mail_config_get_sources): ditto
	(mail_config_add_source): ditto
	(mail_config_get_default_news): ditto
	(mail_config_get_news): ditto
	(mail_config_add_news): ditto

	* mail-config.h: Prototype new accessors.  Config struct is now
	in mail-config.c and hidden from the world.

2000-08-11  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (describe_fetch_mail): Use camel_service_get_name
	rather than showing the URL to the user.

2000-08-11  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (do_refile_messages): Freeze the folders while moving.
	(do_flag_messages): Same.
	
	* mail-threads.c (get_password_clicked): Fix the case when the
	user /doesn't/ use escape to cancel the dialog :-/
	(show_error_clicked): Same.

2000-08-11  Dan Winship  <danw@helixcode.com>

	* mail-tools.c (mail_tool_get_folder_name): Add a function to
	return a useful name for a folder (not just "mbox" or "mh" for
	any local folder.)

	* mail-ops.c: Use mail_tool_get_folder_name rather than
	folder->full_name when printing folder names.

2000-08-11  Not Zed  <NotZed@HelixCode.com>

	* mail-tools.c (mail_tool_get_local_inbox_url): Properly handle
	different local file formats.  The folder isn't always mbox.
	(mail_tool_do_movemail): Movemail always uses an mbox format
	however.
	(mail_tool_get_local_movemail_url): What is the mbox url, it is
	always the same type, mbox.
	(mail_tool_fetch_mail_into_searchable): Same here.

	* mail-local.c (mail_local_map_uri): Map a local uri to the real uri.

2000-08-10  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser-factory.c, message-list.c, message-thread.c,
	session.c: Fixed some warnings.

2000-08-10  Dan Winship  <danw@helixcode.com>

	* session.c (session_init): Don't call e_setup_base_dir. It was
	wrong and it doesn't exist any more.

	* component-factory.c (owner_set_cb): Update for changed
	prototype, and record the evolution_homedir. Move call to
	mail_config_init here from session.c so it happens after
	evolution_dir is initialized.

	* mail.h: define "extern char *evolution_dir;" (formerly in
	e-util/e-setup.h)

	* component-factory.c, mail-callbacks.c, mail-config-gui.c,
	mail-config.c, mail-display.c, mail-format.c, mail-ops.c,
	mail-tools.c, session.c: Remove "e-util/e-setup.h" include.

2000-08-10  Peter Williams  <peterw@helixcode.com>

	* test-thread.c (queue_ops): Use mail_operations_terminate() to
	close the other thread nicely.

	* mail-threads.c (get_password_deleted): Handle the "close" event
	as a cancel.
	(show_error): Same.

2000-08-10  Dan Winship  <danw@helixcode.com>

	* mail-tools.c (mail_tool_get_folder_from_urlname): Add a
	"gboolean create" argument to pass to camel_store_get_folder.

	* mail-ops.c (do_create_folder, do_setup_draftbox): 
	* mail-local.c (mail_tool_local_uri_to_folder): 
	* mail-vfolder.c (vfolder_uri_to_folder): Add create flag to
	mail_tool_get_folder_from_urlname calls.

2000-08-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-callbacks.c (composer_send_cb): Fix compile warning by
	casting the object to a CamelObject

2000-08-10  Peter Williams  <peterw@helixcode.com>

	* mail-tools.c (mail_tool_filter_contents_into): Delete the source
	folder if told to and if it's empty
	(mail_tool_get_local_movemail_path): New function.

2000-08-10  Dan Winship  <danw@helixcode.com>

	* mail-callbacks.c (reply_to_all): Fix a bug in the async changes.
	(This was identical to reply_to_sender.)

2000-08-10  Not Zed  <NotZed@HelixCode.com>

	* mail-local.c (do_local_reconfigure_folder): Update for
	append_message api change.

	* message-list.c (message_list_regenerate): Change for search api
	change.
	(ml_tree_value_at): Add a colour column, based on the colour
	assigned in the summary.
	(message_list_init_renderers): Init colour column.

2000-08-09  Peter Williams  <peterw@helixcode.com>

	* mail-display.c (part_for_url): Remove a gtk_object_get_data

2000-08-09  Cody Russell  <bratsche@gnome.org>

	* folder-browser-factory.c, mail-view.c: Make the toolbars
	honor the user's gnomecc settings for detachable toolbars.

2000-08-09  Jeffrey Stedfast  <fejj@helixcode.com>
  
	* mail-ops.c (composer_send_cb): Get the from address set in the
	composer, if that fails ONLY THEN get the default from mail config

	* mail-config.c (mail_config_get_identities): New convenience
	function for getting a list of the configured identities

2000-08-09  Dan Winship  <danw@helixcode.com>

	* mail-display.c (on_object_requested): Support controls as well
	as embeddables.

2000-08-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-view.c (mail_view_create): Changed to only take a
	FolderBrowser argument

	* mail-ops.c (real_view_msg): Create a new FolderBrowser for each
	message being opened in a new window. Also set the
	message_list->cursor_uid and mail_display->current_message to the
	appropriate values.
	(real_view_msg): Updated to reflect changes in the mail_view_create

	* message-list.c (on_right_click): Nicify a little, add in a menu
	separator between VFolder and Filter stuff.

	* mail-ops.c (real_view_msg): Set the UID of the message that is
  	being displayed

2000-08-09  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c (control_activate): Use
	`GNOME_STOCK_MENU_*' things instead of `GNOME_STOCK_PIXMAP_*'
	things, that are too big and look bad.

2000-08-09  Peter Williams  <peterw@helixcode.com>

	* mail-view.c (mail_view_create): Save the top window so that on_close
	can find it [with set_data].
	(on_close): Recover the top window.
	
	* mail-threads.c (read_msg): Destroy the window instead of hiding it.

2000-08-09  Not Zed  <NotZed@HelixCode.com>

	* mail-autofilter.c (filter_gui_add_from_message): Helper function
	to add with confirm.
	(rule_match_recipients): Dont set real name if its empty for the
	filter name.
	(rule_match_subject): was cutting ] off mailing list names.

	* message-list.c (on_right_click): Added menu to install
	vfolders/filters from message.

2000-08-09  Not Zed  <NotZed@HelixCode.com>

	* mail-autofilter.c: New file to hold auto filter/vfolder stuff.

2000-08-09  Christopher James Lahey  <clahey@helixcode.com>

	* mail-display.c, mail-format.c, mail-ops.c: Fixed some warnings.

	* message-list.c: Fix the call to e_popup_menu_run to match the
	new signature.

2000-08-09  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c (control_activate): Create a "print
	message" menu item.

2000-08-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (message_list_init): Attached a double_click
	signal handler
	(on_double_click): Our lovely new double_click callback. Will
	display the current selected message in a new window

2000-08-08  Jeremy Wise  <jwise@pathwaynet.com>
	* mail-config.[ch], folder-browser.c: Added configuration work to
	save the size of the vpaned widget.  It will be functional when the
	e_paned widget emits a "resized" signal

2000-08-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.h: Added void as an argument to functions not
	needing any parameters to avoid compile warnings.

2000-08-08  Jeremy Wise  <jwise@pathwaynet.com>
	* mail-config.[ch], main.c, folder-browser-factory.c: State of the
	threaded list toggle is now saved via gnome_config

2000-08-08  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c (service_page_item_new): Attach a signal
	handler to call the "changed" function when the user clicks the
	"keep on server" checkbox.
	
2000-08-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (view_msg): New convenience function with params of a
	normal Gtk callback function. We also now create a new
	FolderBrowser object so that the message-view window isn't tied to
	the display in the main window
	(view_message): Now calls view_msg (this function is a bonobo
	callback and can't be used with gtk widgets)
	(edit_msg): Same idea as view_msg()
	(edit_message): Again, same as view_message()

	* message-list.c (on_right_click): Callback for creating an
	e-popup-menu
	(message_list_init): Added a right_click event to trigger a pop-up
	menu to be displayed

2000-08-08  Dan Winship  <danw@helixcode.com>

	* mail-config-gui.c: Add "Don't delete messages from server"
	button to remote SOURCEs that aren't STORAGEs (ie, POP).
	(provider_list): Only list SOURCEs. (ie, not mh)

	* mail-config.c: Save/load "keep_on_server" flag.

	* mail-ops.c (fetch_remote_mail): New function, split out of
	real_fetch_mail. Deals with copying mail from a remote server into
	a temporary mbox, possibly using a CamelUIDCache to leave the
	messages on the server.

	* mail-crypto.c, mail-format.c, message-thread.c: Fix some
	compiler warnings.

	* mail-format.c (mail_generate_reply): Fix up format of addresses.
	(write_headers): Use CamelAddress functions to simplify this.

2000-08-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-view.c: Lets get rid of the last separator in the toolbar
	until we add n/p

2000-08-08  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-threads.c (queue_window_delete_event_cb): Callback for
	"delete_event", just doing nothing.
	(create_queue_window): Connect it to the "delete_event" signal of
	the progress dialog.

2000-08-08  Peter Williams  <peterw@helixcode.com>

	* mail-threads.c (remove_next_pending): Sanity check for
	job queue, which seems to have some issues.
	(read_msg): Make sure that the next operation isn't started
	before the last one is cleaned up.

	* mail-callbacks.c (fetch_mail): Fix erroneous free.

	* mail-config-gui.c (mail_config_druid): Wrap the gtk_main call.

	* mail-ops.c (do_flag_messages): Allow specification of whether
	to set the flags unconditionally or toggle their current state.

	* message-list.c (ml_tree_set_value_at): Toggle the seen status;
	don't set it unconditionally.

	* mail-callbacks.c (delete_msg): Toggle the deletion status;
	don't set it unconditionally.

	* mail-tools.c (mail_tool_do_movemail): Fix for undeclared tmpfd.

	* mail-local.c (local_reconfigure_folder): Big rewrite; make into
	an asynchronous operation. Use some mail tools to make life easy.

2000-08-08  Dan Winship  <danw@helixcode.com>

	* main.c (main): Move mail_config_init after session_init, since
	it depends on evolution_dir being set.

2000-08-08  JP Rosevear  <jpr@helixcode.com>

	* mail-ops.c (check_configured): Use config accessors
	(fetch_mail): ditto
	(composer_send_cb): ditto
	(create_msg_composer): ditto

	* mail-config-gui.h: Update API

	* mail-config.h: Update API

	* mail-config.c: Add accessor functions
	(mail_config_is_configured): accessor function
	(mail_config_get_default_identity): ditto
	(mail_config_get_default_source): ditto
	(mail_config_get_transport): ditto
	(mail_config_send_html): ditto
	(identity_copy): Make public
	(identity_destroy): ditto
	(identity_destroy_each): ditto
	(service_copy): ditto
	(service_destroy): ditto
	(service_destroy_each): ditto
	(mail_config_init): Rename from init_config and make public
	(mail_config_clear): Rename from clear_config and make public
	(mail_config_read): Rename from read_config and make public
	(mail_config_write): Reanme from write_config and make public

	* main.c (main): Call mail_config_init.

	* mail.h: Include mail-config-gui.h

	* mail-config-gui.c: Move config gui stuff here.
	(source_dialog): Kill memory leak from debug leftovers.
	Make sure returned source is NULL by default

2000-08-07  Not Zed  <NotZed@HelixCode.com>

	* mail-local.c (local_reconfigure_folder): Redone to show a
	dialogue first, and show progress of whats happening as its done.

	* Makefile.am (glade_DATA): Added local-config.glade, for mailbox
	reconfig dialogue.

2000-08-04  Not Zed  <NotZed@HelixCode.com>

	* folder-browser.c (mail_uri_to_folder): Use local_uri_to_folder()
	for local uri's (file://).

	* mail-local.c (local_uri_to_folder): Handle looking up folder
	storage type before opening the store/folder.
	(local_reconfigure_folder): Function to reconfigure the format of
	a local mailbox into another storage format.

	* Makefile.am (evolution_mail_SOURCES): Added mail-local.c and
	missing mail-vfolder.h.

2000-08-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* Makefile.am: Added mail-view.c
	
	* folder-browser-factory.c (control_activate): Adda menu item for
	viewing the message

	* mail-view.c: New file containing methods for viewing messages in
	separate windows

	* mail-ops.c (view_message): New callback for viewing messages in
	a new window.

2000-08-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* component-factory.c (real_create_generic_storage): New function
	to replace real_create_imap_storage and real_create_news_storage
	(create_imap_storage): Updated.
	(create_news_storage): Updated.

2000-08-07  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (cleanup_edit_messages): New operation: edit_messages
	For continuing draft messages.
	(attach_messages): Fix accidental 0 datasize.
	(do_setup_draftbox): New operation: setup_draftbox. Soooo hacky.

	* mail-callbacks.c: Move fejj's edit message to the async home.

	* component-factory.c (owner_set_cb): Use mail_do_setup_draftbox.


2000-08-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-display.c:
	* component-factory.c: s/strncasecmp/g_strncasecmp

	* mail-format.c (write_headers): Get rid of kludge around subject
	beginning with spaces.
	(mail_generate_reply): Get rid of kludge around subject beginning
	with spaces and also use g_strncasecmp instead of strncasecmp for
	portability

	* mail-ops.c (forward_msg): Get rid of kludges around subject
	beginning with spaces.

2000-08-07  Dan Winship  <danw@helixcode.com>

	* message-list.c (message_list_select): Clarify that the input row
	is a model row, and swap it to a view row when finding the
	next/previous row.
	(idle_select_row): Select view row 0, not model row 0.

	* mail-ops.c (select_first_unread): Start from view row 0, not
	model row 0.

2000-08-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-format.c (mail_get_message_body): Renamed from reply_body()
	so other functions can use it
	(mail_generate_reply): Updated to reflect function name changes

	* mail-ops.c (real_edit_msg): Attach a callback to the send signal

2000-08-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c (control_activate): New menu item under
	Actions to allow editing of messages.

	* mail-ops.c (edit_message): New function for editing messages.

	* component-factory.c (owner_set_cb): Create a global reference to
	the Drafts mbox folder for the Composer to use

2000-08-06  JP Rosevear  <jpr@helixcode.com>

	* mail-config.c (ndialog_page_undone): Desensitize ok button
	(sdialog_page_undone): ditto
	(iddialog_page_undone): ditto
	(news_page_new): Typo - news, not mail
	(transport_page_new): Typo - transport, not source
	(identity_dialog): Set undone callback
	(source_dialog): ditto
	(news_dialog): ditto
	(mail_druid_identity_undone): Desensitize next button and
	mark done flag as false
	(mail_druid_source_undone): ditto
	(mail_druid_transport_undone): ditto
	(mail_druid_identity_done): Mark done flag as true
	(mail_druid_source_done): ditto
	(mail_druid_transport_done): ditto
	(mail_druid_prepare): Use done flag to set next button 
	sensitivity, fixes #467

2000-08-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-crypto.c (mail_crypto_openpgp_encrypt): Added support for
	encrypting with GnuPG.  Support for PGP5 and PGP2 are still in
	progress.

2000-08-05  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (control_activate): Remove bonobo 0.15
	vs 0.15-and-a-half ifdef, since we require post-0.16 now.

2000-08-04  Dan Winship  <danw@helixcode.com>

	* mail-threads.c (mail_operation_wait_for_finish): Don't use
	"while (gtk_events_pending ()) gtk_main_iteration ();" inside
	another tight loop, because it makes the thread spin rather than
	blocking and waiting like it should.

2000-08-04  Peter Williams  <peterw@helixcode.com>

	* message-thread.c (do_thread_messages): Uninitialized variable
	fix.

	* mail-threads.c (read_msg): Small leak fix.

	* component-factory.c (owner_unset_cb): Use mail_operations_
	terminate() instead of wait_for_finish().

	* mail-threads.c (mail_operation_queue): Centralize the clur
	handling functions; fix a race condition where the dispatcher
	would overwrite the closure before the main thread could
	free the old one.
	(mail_operations_terminate): New function, wait for ops to
	finished and kill the other thread.
	(dispatch): changes to die when terminate is called (abort
	on NULL spec).

	* mail-ops.c (cleanup_display_message): Fix improper handling
	of displaying a NULL message (which means clear the message
	display).

2000-08-04  Ettore Perazzoli  <ettore@helixcode.com>

	* message-list.c (message_list_regenerate): Free the GPtrArray
	correctly instead of using `g_strfreev()'.

2000-08-04  Michael Meeks  <michael@helixcode.com>

	* folder-browser-factory.c (control_activate): release the ui_handler
	after set_container.

2000-08-03  Michael Meeks  <michael@helixcode.com>

	* mail-config.c (identity_page_new): only whack the sig in if the
	file exists.

	* component-factory.c (factory_fn): count running instances,
	attach destroy signal (factory_destroy): add. 

	* main.c (main): pass orb around.

2000-08-03  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (composer_send_cb): Yay, no more compiler warnings

	* mail-config.c: set config = NULL
	(provider_list) Eek! Initialize news to NULL!  Also, use
	g_slist_prepend() for "performance" gains ;-)
	(init_config): Set the config member data to NULL just to be on
	the safe side
	(clear_config): Don't bother freeing slist data if the slist is
	NULL

2000-08-03  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (op_forward_messages): Use the new dynamic
	operation naming.

	* message-thread.c (describe_thread_messages): Ditto.

	* message-list.c (describe_regenerate_messagelist): Ditto.

	* mail-threads.c (get_password_clicked): Dynamic generation
	of descriptive text for mail operations. "Opening a folder" ->
	"Opening INBOX". Supported only so far, will be implemented
	quickly.
	g_strdup() the old_message when changing the queue_window_label's
	text.

	* main.c (main): One more gconf reference to take out...

	* mail-ops.c (composer_send_cb): Check for an identity before
	sending.
	
2000-08-03  JP Rosevear  <jpr@helixcode.com>

	* mail-config.glade: Increase window size slightly, rename
	"Transport" to "Mail Transport"

	* mail-config.c (init_config): Remove gconf references
	(clear_config): ditto
	(read_config): ditto
	(write_config): ditto
	(mail_config): Null provider lists before filling them
	(mail_config_druid): ditto
	(identity_page_new): Increase spacing of vbox
	(service_page_new): ditto

	* Makefile.am: Remove gconf references. 

2000-08-02  Dan Winship  <danw@helixcode.com>

	* mail-config.c (service_page_item_new): Make the "test settings"
	button FILL rather than SHRINK so it doesn't end up oddly-placed.

	* mail-config-druid.glade: Make the icon background dark blue
	like the surrounding area.

2000-08-02  Peter Williams  <peterw@helixcode.com>

	* component-factory.c (owner_unset_cb): Wait for async operations
	to finish before exiting.

2000-08-02  Christopher James Lahey  <clahey@helixcode.com>

	* mail-ops.c, message-list.c: Emit "model_pre_change" where
	appropriate.

2000-08-02  Peter Williams  <peterw@helixcode.com>

	* mail-config.h: #ifdef _MAIL_CONFIG_H protect the header.

2000-08-01  Peter Williams  <peterw@helixcode.com>

	* mail-threads.c: Implement Solaris threads. Attempt
	to join to the thread upon exit -- hopefully prevents
	all those nasty zombie processes from popping up :-(

2000-08-01  Dan Winship  <danw@helixcode.com>

	* mail-crypto.c: New code to spawn off GPG/PGP to do stuff.
	Currently only deals with decryption. From Nathan Thompson-Amato
	<ndt@jps.net>, with bunches of changes from me.

	* session.c (mail_request_dialog): Expose the password dialog to
	the rest of the app (for use by the GPG/PGP code).

	* mail-format.c (handle_text_plain): Handle special inline data
	types. (Currently uuencoding, BinHex, and PGP encryption.) This is
	not the best way to deal with it, but it works for now.
	(try_inline_pgp): Convert an inline PGP-encrypted message into a
	multipart/encrypted part.
	(try_inline_binhex): Convert an inline BinHex attachment into an
	application/mac-binhex40 part (which we currently don't deal
	with...)
	(try_uudecoding): Convert a uuencoded attachment to an
	application/octet-stream part.
	(handle_multipart_encrypted): Deal with RFC2015 MIME-encoded PGP
	encrypted messages. (From ndt.)

	* mail-display.c (mail_text_write, mail_error_write): New utility
	functions.

	* Makefile.am (evolution_mail_SOURCES): add mail-crypto.c

2000-07-31  Christopher James Lahey  <clahey@helixcode.com>

	* component-factory.c, folder-browser.c: Fixed some warnings.

	* message-list.c: Made the icon column non sortable.

2000-07-31  Dan Winship  <danw@helixcode.com>

	* mail-config.c (service_page_set_url): Fix a NULL-pointer strcmp
	noticed by peterw.

2000-07-31  Not Zed  <NotZed@HelixCode.com>

	* mail-vfolder.h: Header for vfolder functions.

	* folder-browser.c (mail_uri_to_folder): Use new scheme to open
	vfolders.
	(search_save): New button/function to save a search as a vfolder.

	* mail-vfolder.c (vfolder_edit): Made asynchronous.
	(vfolder_uri_to_folder): New function for loading vfolders and
	setting up their source folders.
	(vfolder_refresh): Change shell vfolder uri's to indirect
	references rather than the real vfolder uri.
	(vfolder_gui_add_rule): Add a rule with user confirmation.
	(vfolder_create_part): Get a new part by name, for creating rules
	in code.

	* message-thread.c (thread_messages): Check for uid lookup
	failure, which indicates an error in the folder or calling code.

2000-07-29  Not Zed  <NotZed@HelixCode.com>

	* component-factory.c (create_view): Remove hack to pass the
	storage around.

	* folder-browser-factory.c (control_activate): Changed to call
	renamed vfolder editor.

	* mail-ops.c (vfolder_edit_vfolders): renamed from vfolder_edit,
	call new edit function.
	(vfolder_editor_clicked): Removed.
	(filter_druid_clicked):
	(filter_edit): Updated for api change.
	(real_fetch_mail): Fixed up for api change and fucked up indent.
	(filter_get_folder): callback for filter driver.

	* mail-vfolder.c: New file to manage virtual folders.

2000-07-29  JP Rosevear  <jpr@helixcode.com>

	* mail-format.c (mail_generate_reply): Use new mail config stuff

	* component-factory.c (create_imap_storage): Use new mail config
	stuff
	(create_news_storage): ditto

	* evolution-mail.schemas: Gconf schema for evolution mail

	* mail-config-druid.glade: Gladification of config druid

	* mail-config.h: New header with config structs.

	* mail-config.c: Rewrite of GUI configuration tools to use 
	new config structs.  Stores multiple identities and sources now.
	Still only uses the first one found.
	(mail_config_fetch): Returns MailConfig struct to caller
	for configuration queries.
	(mail_config): Renamed function to show mail config dialog.
	(mail_config_druid): Renamed function to show mail config druid.

	* mail-ops.c (create_msg_composer): Use 
	e_msg_composer_new_with_sig_file and new config stuff
	(check_configured): Use new config stuff
	(fetch_mail): ditto
	(composer_send_cb): ditto

2000-07-28  Cody Russell  <bratsche@gnome.org>
        * mail-ops.c, mail.h: Added mark_all_seen(), to mark every
        message in the list with CAMEL_MESSAGE_SEEN.

        * folder-browser-factory.c: Added "Actions/Mark all seen".

2000-07-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c: Lets fix Dan's kludge the Right Way (tm)
	(set_service_url): Only strip off the leading "/" from the 
	url->path if url->host is NULL
	(get_service_url): Only prepend a leading "/" to the path if the
	host is NULL

2000-07-27  Dan Winship  <danw@helixcode.com>

	* mail-config.c (get_service_url): toss in a kludge to deal with
	the IMAP vs mbox path problem for now.

2000-07-26  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, message-list.h: Removed counting of selected
	messages.

2000-07-26  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (real_fetch_mail): Don't create the tmp_mbox before
	calling movemail, because the external movemail requires it to not
	exist. Contrariwise, delete it in the cleanup code if it's empty.
	Update for camel_movemail interface change. Do the "No new
	messages" dialog in the mbox case as well as the remote mail
	issue.

2000-07-26  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c: s/struct refile_data/struct move_data
	(real_move_msg): Renamed from real_refile_msg()
	(move_msg): Renamed from refile_msg()

	* folder-browser-factory.c: Changed Refile to Move.

2000-07-26  Dan Winship  <danw@helixcode.com>

	* mail-format.c (lookup_handler): Update for OAF and for external
	apps as well as components.
	(handle_via_external): Handler to set up for data that can be
	displayed by an external application.

	* mail-display.c (on_link_clicked, etc): Refactor the save_data()
	code and add launch_external() as a handler for
	x-evolution-external URLs.
	(embeddable_destroy_cb): Remove this, since it seems like it's all
	wrong.
	(on_object_requested): Update for OAF, and fix some bugs.

2000-07-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (get_service_url): Always prepend a leading "/" to
	the url->path.
	(set_service_url): Added more error checking and also strip the
	leading '/' from the url->path
	(create_identity_page): Set the signature file to the one specified in
	the identity record, else set the default path to ~/.sugnature

2000-07-25  Michael Meeks  <michael@helixcode.com>

	* mail-config.c (create_identity_page): set default signature to
	~/.signature

2000-07-25  Peter Williams  <peterw@helixcode.com>

	* mail-ops.c (reply): Check for the case of fb->mail_display->
	current_message = NULL, which shouldn't happen, but has happened
	to me.

2000-07-25  Dan Winship  <danw@helixcode.com>

	* message-thread.c (group_root_set): Don't group together messages
	with the same non-Re: subject and no References/In-Reply-To. More
	often than not, they're unrelated. (eg, "[No subject]".)
	(thread_messages): Handle messages with no Message-Id. "This
	shouldn't happen", but it does sometimes, and it's not much code
	to make it just work.

2000-07-25  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-config.c (create_service_page): Call
	`gtk_option_menu_set_menu()' as the last thing, as `GtkOptionMenu'
	is fscking broken.  Also, `gtk_widget_show()' the individual menu
	items.

2000-07-24  Dan Winship  <danw@helixcode.com>

	* message-list.c (mark_msg_seen, ml_tree_set_value_at,
	message_list_regenerate): Update for CamelFolder API changes.
	(Certain functions no longer take a CamelException.)

	* mail-ops.c (real_fetch_mail, real_send_mail, real_delete_msg):
	ditto

	* component-factory.c (real_create_imap_storage,
	real_create_news_storage): ditto

2000-07-24  Dan Winship  <danw@helixcode.com>

	* component-factory.c, folder-browser-factory.c, test-mail.c:
	Remove GOAD support.

	* main.c: Remove GOAD support.
	(main): More "guess the build mistake" fun, this time for the
	failure to initialize Bonobo case.

2000-07-24  Peter Williams  <peterw@helixcode.com>

	* mail-tools.c (mail_tool_set_uid_flags): Change
	function to faithfully pass parameters to
	camel_folder_set_message_flags; this function is
	somewhat useless now. Other files synced with
	API change.

	* mail-ops.c (op_display_message): Change "display
	a message" into "retrieve a messsage" in the
	description of mail_op_display_message.

	* mail-threads.c (display_timeout): New function.
	Only display the progress dialog if the operation
	takes more than a second to perform.
	(hide_queue_window): New function. Hide the queue
	window as an idle function... I'm thinking maybe
	the problem with hiding it was due to us not
	being in a GTK event sequence? Perhaps it's only
	the timeout, which was not being cancelled, which
	is now.
	
	* message-list.c (get_message_uid): New function,
	copy of get_message_info, except gets only the
	UID, as that's all that most functions want, and
	we avoid a Camel call.

2000-07-23  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (create_message_composer): New.
	(compose_msg): Use it.
	(send_to_url): Likewise.
	(forward_msg): Likewise.

	* folder-browser-factory.c (control_activate): Use `_()' instead
	of `N_()'.

2000-07-21  Peter Williams  <peterw@helixcode.com>

	* message-thread.c (setup_thread_messages): New
	operation: thread_messages, simple wrapper around
	thread_messages () and thread_messages_free();

	* message-list.c (cleanup_regenerate_messagelist): 
	Use new thread_messages operation instead of just
	calling ... thread_messages :-)

	* folder-browser.c (folder_browser_destroy): Use new
	sync_folder operation instead of calling camel_folder_sync
	directly.

	* component-factory.c (create_folder): Changed to use
	new create_folder operation.

	* mail-ops.c (mail_do_create_folder): New operation: create
	folder. New operation: sync folder.

	* mail-format.c (cmm_destroyed): Remove the url hashtable from
	the larger hashtable when it gets destroyed.

	* mail-callbacks.c (fetch_mail): Pass a hook function and data
	down the chain to pick up the folder_changed and change the view.

	* mail-ops.c: Rename from mail-ops-new.c now that it's a little more
	solid. 
	(fetch_mail): Add new options to hook and unhook an event while the
	filter driver runs. A hack, but all of the operations are to some
	extent.
	(cleanup_fetch_mail): Unref the destination folder if not NULL.
	* mail-tools.c (mail_tool_filter_contents_into): Intermediate the
	event hook/unhook hack here.

2000-07-20  Peter Williams  <peterw@helixcode.com>

	* mail-ops-new.c (setup_send_mail): Fix silly forgetting-to-ref
	problem on some sends (when not replying). Note the early exit
	path with a big comment.
	
	* message-list.c (message_list_set_folder): Don't call
	folder_changed, call mail_do_regenerate_messagelist, as
	the GDK_THREADS_ENTER in the former can deadlock us!

	* folder-browser.c (folder_browser_set_uri): Ah, screw it.
	Make 'load folder' asynchronous and pretend that it always
	succeeds.

	* mail-ops-new.c (mail_do_load_folder): New operation, loads
	a folder into a FolderBrowser.
	
	* mail-threads.c (read_msg): Check if the exception is
	a user cancel; don't complain if it is.
	(mail_operation_queue): Same.
	(dispatch_func): Same.

2000-07-20  Peter Williams  <peterw@helixcode.com>
	
	* mail-ops-new.c (cleanup_send_mail): Fix evil mistaken
	unref.

	* test-thread.c: Fit the new mail_operation_spec prototype.

	* mail-callbacks.c (composer_send_cb): Hide the composer upon
	start of send operation.

	* folder-browser.c: #include "mail-ops-new.h"

	* mail-threads.h: Change text fields of mail_operation_spec to
	provide two forms of the name.

	* mail-threads.c: Use appropriate new string fields.
	(dispatch_func): Hide the progressbar by default.
	
	* message-list.c (op_regenerate_messagelist): Fix the datasize from
	0 -> sizeof (regenerate_messagelist_data_t). Add the new gerund and
	infinitive strings.
	(do_regenerate_messagelist): Include some code that fell between the
	cracks.

	* mail-ops-new.c (op_scan_subfolders): Same datasize fix for 
	scan_subfolders.
	(op_forward_message): Same.	
	(all): Add new gerund and inifinitive strings for mail_operation_spec.
	(cleanup_send_mail): Destroy the composer on success; re-show it on
	error. I'm so clever!
	
2000-07-20  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (factory_fn): Updated for the new
	`evolution_shell_component_new()' arg.

2000-07-19  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-thread.c (thread_messages): What if message info is NULL?

2000-07-17  Peter Williams  <peterw@helixcode.com>

	* component-factory.c (real_create_{imap,news}_storage): Instead of
	directly calling evolution_storage_new_folder, queue up a list of
	folders to register so that we don't do our CORBA in The Other Thread.
	(create_{imap,news}_storage): Changes ancillary to the above.
	(add_new_mailbox): New function to queue up a folder
	(cleanup_create_info): New function to dequeue the folders and free mem.

	* test-thread.c: s,ENABLE_BROKEN_THREADS,USE_BROKEN_THREADS -- oops

	* mail-format.c: (mail_lookup_url_table): New function to get the url
	table associated with a CamelMimeMessage because we can no longer 
	gtk_object_get_data on it.

	* mail-display.c: replace 'gtk_object_get_data( message, "urls" )'
	with 'mail_lookup_url_table( message )'

2000-07-16  Jeffrey Stedfast <fejj@helixcode.com>

	* folder-browser.c, component-factory.c: Initial code to support
	IMAP folders that don't use "/" as a directory separator.

2000-07-15  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (set_x_mailer_header): New helper function to set the
	`X-Mailer:' header to to `Evolution <version> [Developer
	Preview]".
	(real_send_mail): Call it.

2000-07-14  Peter Williams  <peterw@curious-george.helixcode.com>

	* message-list.c (message_list_set_folder): Ported to CamelObject:
	GTK_OBJECT->CAMEL_OBJECT; gtk_signal_connect->camel_object_hook_event;
	GDK_THREADS_ENTER/LEAVE around "changed" event hooks.

	* folder-browser.c (folder_browser_destroy): likewise.
	(mail_uri_to_folder): likewise.
	(folder_browser_load_folder): likewise.
	
2000-07-14  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (evolution_mail_LDADD): Add `GCONF_LIBS'.

2000-07-14  Dan Winship  <danw@helixcode.com>

	* mail-format.c (write_headers): put a <p> at the end of the
	header table. (I think there used to be whitespace after it, but
	then some gtkhtml change got rid of it...)
	(handle_text_plain): Don't do this <PRE>. Instead, CONVERT_NL and
	CONVERT_SPACES and wrap it in <TT>. Now if the sender didn't
	include any newlines, it will be wrapped to the width of the
	window instead of extending off into infinity.

2000-07-13  Dan Winship  <danw@helixcode.com>

	* message-list.c (message_list_destroy): Only unref the folder if
	it's been set.

	* folder-browser.c (folder_browser_destroy): Only sync the folder
	if it's been set.

2000-07-13  Jonathan Blandford  <jrb@redhat.com>

	* mail-config.c (create_transport):
	s/CAMEL_SERVICE_NEED_HOST/CAMEL_SERVICE_URL_NEED_HOST.

2000-07-13  Dan Winship  <danw@helixcode.com>

	* mail-config.c (add_row): Add a "gboolean required" argument, and
	set its value on the entry.
	(create_source, create_transport): Create rows for URL elements if
	the URL ALLOWs them. Mark them required if it NEEDs them.
	(service_note_doneness): Only require the required fields to be
	filled in.

	Now the IMAP config page allows the user to enter a path, but
	doesn't require it.
	
2000-07-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (real_fetch_mail): Back to the old way to avoid
	g_warnings, yay. Also fix append to send a flags argument (0)

2000-07-12  Chris Toshok  <toshok@helixcode.com>

	* mail-config.c (providers_config_new): fix some cut & paste bung.

2000-07-12  Chris Toshok  <toshok@helixcode.com>
	
	* mail-format.c (setup_function_table): add "message/news" to the
	mime_function_table using the same handler as message/rfc822.

2000-07-12  Chris Toshok  <toshok@helixcode.com>

	* mail-config.glade*: add news server tab to dialog.

	* mail-config.c (on_NewsServerConfigDialogButton_clicked): new function.
	(on_clistNewsServers_select_row): new function.
	(on_cmdNewsServersAdd_clicked): new function.
	(on_cmdNewsServersEdit_clicked): new function.
	(on_cmdNewsServersDelete_clicked): new function.
	(providers_config_new): mirror the source tab's code to fill in
	the news server tab.
	(write_config): save out the news server.
	(create_news_server_config_dialog): new function.
	(create_news_server_page): new function.

2000-07-12  Peter Williams  <peterw@helixcode.com>

	* mail-display.c (save_data): Change from evolution_dir to
	g_get_home_dir() for default location of save file.

2000-07-11  Dan Winship  <danw@helixcode.com>

	* Update for CamelFolder API changes

2000-07-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (real_fetch_mail): Changed to use 
	camel_folder_move_message_to () rather than get_message () and then
	append_message (). This also makes it so we don't have to worry about
	fetching message flags to pass to the new append_message () method.

	* folder-browser.c (folder_browser_load_folder): Disable
	Search capability menu/entry if folder doesn't support it.

	* message-list.c (message_list_regenerate): Don't perform
	a search if the folder doesn't support it.

2000-07-11  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (real_send_mail): Set the post_send_data flag rather
	than toggling it. (Maybe we'll need more control over it later,
	but for now, the only flag we set is "replied", and we want
	that set, not toggled.)

2000-07-10  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (control_activate): Work with both
	current and 0.15 bonobo

	* kill more debugging messages

	* mail-ops.c (real_fetch_mail): Don't multiply free dest_url.

	* message-list.c (message_list_select): Update
	message_list_select_next to do either next or previous.

	* folder-browser.c (etable_key): Make 'n' and 'p' do next and
	previous unread message.

	* mail-ops.c (select_first_unread): Update.
	(real_fetch_mail): clean up a bit.

2000-07-10  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (forward_msg): Initialize `fwd_subj' to NULL if
	`from' is NULL.

2000-07-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (real_fetch_mail): Fixed broken POP fetching

2000-07-10  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c: Removed variable `browsers'.
	(create_view): Don't update it.
	(owner_unset_cb): Don't sync the folders here anymore, because at
	this point the folder browser is dead already so we cannot get a
	valid list of folders from it anymore.

	* folder-browser.c (folder_browser_destroy): Sync the associated
	mailbox first.

2000-07-10  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, message-list.h: Switched from ETable to
	ETableScrolled.

2000-07-10  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (real_fetch_mail): Fixed movemail so that it too would
	deliver to Inbox.

2000-07-09  Dan Winship  <danw@helixcode.com>

	* message-list.c (get_message_info): Don't g_warn if the user
	selects a fake tree parent.
	(message_list_select_next): Ignore fake rows
	(build_tree): Store the "root_subject" for fake rows
	(ml_tree_value_at): Display the correct subject for fake rows.
	(on_cursor_change_cmd): Update for the other changes and set
	cursor_uid to NULL when the cursor is on a fake row.

	* mail-ops.c (reply): Don't try to reply when no (real) message is
	selected.
	(forward_msg): Ditto.

2000-07-09  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Remove setting of dnd_code since that's handled
	internally to ETable.

2000-07-08  Dan Winship  <danw@helixcode.com>

	* folder-browser.c (etable_key): Fix up the pageup/pagedown
	increment a bit.

	* folder-browser-factory.c (control_activate): Add a "Threaded
	Message List" item to the "View" menu.

	* message-list.c (message_list_toggle_threads): Handler for that.
	(build_flat): New function to build a "flat" message list using
	the tree model.
	(message_list_regenerate): Build tree or flat message list
	depending on the global setting.

	* message-thread.c (get_root_subject): fix a "Re:" parsing bug

2000-07-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (real_fetch_mail): Always dump incoming messages to
	Inbox (assuming not filtered to another location).

2000-07-08  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c (control_activate): Move the
	"Expunge" item to the "Action" menu.
	(control_deactivate): Accordingly.

2000-07-08  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (forward_msg): Deal with having multiple selected
	messages.

	* mail-format.c (mail_generate_forward): Removed. (Integrated into
	forward_msg)

2000-07-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (build_tree): Small fix to stop uid data from
	being set on a message-list tree node when it didn't correspond
	to an actual message.

2000-07-08  Dan Winship  <danw@helixcode.com>

	* message-list.c (get_message_info): Fix Jeff's FIXME: This does
	get called with out-of-range data sometimes, so we do need the
	check. Use e_table_model_row_count to get the actual right answer.

2000-07-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (get_message_info): This wasn't quite right, it
	will now work but still isn't perfect. See FIXME comment.

2000-07-07  Dan Winship  <danw@helixcode.com>

	* message-thread.c (remove_node): Add another argument "clast"
	pointing to the container before the current one in the list,
	which it can update if that turns out to be the one that it
	removed.
	(group_root_set): Update for remove_node change, and remove both
	nodes in the "subjects are common" case. Fixes a bug that would
	cause the message list to be truncated if this rule was invoked.

	(sort_node): sort the tree by the original order of the messages
	in the folder rather than by date.

2000-07-07  Dan Winship  <danw@helixcode.com>

	* message-list.c: Lots of changes. Store uids as node data on the
	tree nodes and use those rather than rows where possible. (The
	concept of "row" is just getting too complicated.) Get rid of the
	summary_table, because given a uid we can call
	camel_folder_get_message_info, which makes more sense than keeping
	a separate uid->row hash table ourselves.

	(get_message_info): update
	(get_message_row): removed
	(ml_col_cound, ml_row_count, ml_value_at, ml_set_value_at,
	ml_cell_is_editable, ml_duplicate_value, ml_free_value,
	ml_initialize_value, ml_value_is_empty, ml_value_to_string):
	Removed. We always use the tree model now.
	(message_list_init): Remove the non-tree code.
	(build_tree): store uids in the tree rather than row numbers,
	and build the message_list->uid_rowmap to map from uids to rows
	when needed.
	(message_list_regenerate): Renamed from _set_search, since it's
	used to redraw in non-search cases too.
	(message_changed): Use the uid_rowmap to get a model row number.

	* message-thread.c (thread_messages): Change the interface on this
	to work with the new MessageList.

	* folder-browser.c (search_set, folder_browser_clear_search): 
	s/message_list_set_search/message_list_regenerate/

2000-07-07  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (get_message_info): Handle a row number of -1
	properly.

2000-07-06  Dan Winship  <danw@helixcode.com>

	* message-list.c (get_message_info): Map tree model row numbers to
	summary row numbers.
	(ml_tree_value_at, ml_tree_set_value_at,
	ml_tree_is_cell_editable): So don't do that here.

2000-07-06  JP Rosevear  <jpr@arcavia.com>

	* mail-config.glade*: Glade files for the configuration dialog.
	
	* mail-config.c (providers_config_new): Build the dialog with
	glade.

2000-07-06  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c, folder-browser.c, mail-ops.c,
	message-list.c: fix warnings.

	* main.c (main): gtkhtmllib_init is no more. Call gconf_init
	directly instead.

	* message-list.c (message_list_select_next): New function to
	select the first message on or after the given row that meets
	certain flag criteria.

	* mail-ops.c (real_fetch_mail): call message_list_select_next to
	select first unread message in current folder if it changes.
	(real_delete_msg): Remove the code to move the etable cursor. It
	only makes sense really if you deleted the message with the
	keyboard, so do it from etable_key.

	* folder-browser.c (etable_key): call message_list_select_next to
	select next non-deleted message after Delete.

	* mail-identify.c: Add a workaround for a small gnome-vfs 0.2 bug
	so we don't need to require CVS gnome-vfs.

2000-07-06  Not Zed  <NotZed@HelixCode.com>

	* message-thread.c (sort_thread): sort messages based on date for
	the initial sort order.
	(thread_messages_free): Implement.

	* message-list.c (message_list_init_header): Setup the subject
	renderer to a tree in tree mode.
	(on_cursor_change_cmd): For a tree model, map the view row to the
	data row.
	(build_tree): Builds the tree data structure of all messages.
	(message_list_set_search): For a tree model, build the tree here.
	(ml_tree_icon_at): Icon callback, returns nothing.
	(ml_tree_value_at):
	(ml_tree_set_value_at): 
	(ml_tree_is_cell_editable): Maps tree node to data row, and calls
	the equivalent table callback
	(message_list_init_renderers): Setup the tree renderer if needed.
	(message_list_init): set the root node invisible afterall.
	(message_list_set_search): Clear the old tree before putting in a
	new one.

	* message-list.h: Add a tree renderer to render list, and
	tree_view indicator.

	* message-thread.[ch]: Code for message threading. 

2000-07-05  Dan Winship  <danw@helixcode.com>

	* mail-identify.c (mail_identify_mime_part): Oops. My gnome-vfs
	was out-of-date. Update for changed function name.

2000-07-05  Dan Winship  <danw@helixcode.com>

	* mail-identify.c (mail_identify_mime_part): Use the gnomevfs
	sniff buffer interface to try to identify the MIME type when
	everything else fails.

	* mail-display.c (on_object_requested):
	* mail-format.c (lookup_handler, handle_undisplayable,
	handle_audio): s/gnome_mime/gnome_vfs_mime/

	* Makefile.am: Add gnomevfs stuff

2000-07-03  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (create_folder): Get rid of a compiler
	warning by making sure `folder' is always initialized to some
	value for any code path.

2000-07-03  Dan Winship  <danw@helixcode.com>

	* message-list.c (select_msg): call mail_display_set_message with
	NULL if the message we tried to select doesn't exist (probably
	meaning we tried to selecte the first message and the folder is
	empty.)

	* mail-display.c (mail_display_set_message): deal with NULL as an
	input (meaning "undisplay previous message and display nothing").

2000-07-02  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (real_fetch_mail): Remove hack to redisplay the
	inbox, since folder_changed signals will now be emitted
	appropriately.

	* component-factory.c (create_vfolder_storage): Fix
	filter_driver_new invocation.

	* Makefile.am (bin_PROGRAMS): test-mail and test-thread should be
	noinst.

	* mail-ops.c (real_fetch_mail): 
	(vfolder_editor_clicked): 
	* component-factory.c (create_vfolder_storage):
	Pass mail_uri_to_folder and rules to filter_driver_new.

2000-07-02  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser.c (mail_uri_to_folder): Fix double freeing of the
	local exception `ex'.

2000-07-01  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (refile_msg): Only allow type "mail" in the folder
	selection dialog.

2000-07-01  Dan Winship  <danw@helixcode.com>

	* pixmaps.h, pixmaps/*.xpm: Removed. These aren't being used any
	more. (The real pixmaps are in ../art.)

2000-07-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c (get_message_info):
	(select_msg): Updated to reflect camel-folder changes.

	* mail-ops.c (real_fetch_mail): Modified to reflect camel-folder
	changes.

2000-06-30  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (print_msg): Use gnome-print to do a print preview.

	* folder-browser-factory.c: Hook up "Print" button.

	* message-list.c (message_list_foreach): New function, a wrapper
	around e_table_selected_row_foreach, which calls the callback
	function with UIDs rather than row numbers.

	* folder-browser-factory.c: Remove never-used "Find" button from
	the toolbar and replace it with "Refile". (We need a better icon
	for this...). Hook up "Refile" to "refile_msg".

	* mail-ops.c (refile_msg): Call the shell's user_select_folder
	routine, and then use message_list_foreach and real_refile_msg to
	do the work.
	(delete_msg): Update to use message_list_foreach.

	* folder-browser.c (mail_uri_to_folder): new function, extracted
	from folder_browser_load_folder, to turn a URI into a folder.
	(folder_browser_load_folder): Use it.

2000-06-30  Peter Williams  <peterw@curious-george.helixcode.com>

	* component-factory.c (create_news_storage, create_imap_storage):
	Fixed to use new EvolutionShellClient proxy thingamajiggie.

2000-06-30  Dan Winship  <danw@helixcode.com>

	* message-list.c (on_row_selection): use the ETable row_selection
	signal to track how many rows are selected. Eventually we will use
	this info to disable toolbar buttons when you have too few/too
	many messages selected, but the current toolbar widget doesn't
	allow that.

	* message-list.h, message-list.c, mail-ops.c: Change selected_row
	and selected_uid fields of MessageList to cursor_row and
	cursor_uid to be more correct according to the new ETable
	interfaces.

2000-06-30  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c: Eeek.  Fix typo: add missing star in the
	declaration of `global_shell_client'.

2000-06-29  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c: Replace `global_shell_interface' with
	`global_shell_client'.

2000-06-29  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-ops.c (delete_msg): Clean up compile warnings
	(real_fetch_mail): Fetching from IMAP should do nothing

2000-06-29  Christopher James Lahey  <clahey@helixcode.com>

	* mail-ops.c: Handle multiple deletes (change by Peter Williams.)

2000-06-29  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser-factory.c: Changed "Send" to "Compose" to
	avoid user confusion. Compose is a little more intuitive.
	Also changed the pixmap to MAIL_NEW instead of MAIL_SND

	* mail-ops.c (compose_msg): Renamed to avoid confusion

2000-06-29  Dan Winship  <danw@helixcode.com>

	* component-factory.c (create_imap_storage, create_news_storage):
	remove some code incorrectly copied and pasted from
	create_vfolder_storage which caused vfolder creation to stop
	working.

2000-06-29  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, mail-ops.c: Changed the name of
	e_table_select_row to e_table_set_cursor_row.

2000-06-29  Peter Williams  <peterw@helixcode.com>

	* message-list.c (message_list_init): Set the dnd_code of the
	ETableHeader to something so that Solaris sprintf doesn't die
	on a NULL string.

	* mail-config.c (providers_config_new): Check for a null "transport"
	string (not all OS' handle NULL strings well *cough* Solaris)

2000-06-28  Dan Winship  <danw@helixcode.com>

	* mail-format.c (mail_generate_forward): add default subjects

	* component-factory.c (create_folder): Refuse to create folders
	not of type "mail", and correctly create an empty "mbox" folder
	for new folders in /local.

	* main.c (init_corba): Call od_assert_using_oaf() or
	od_assert_using_goad() as appropriate to make sure people didn't
	somehow trick the build system.

2000-06-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* message-list.c: Added prototype for filter_date to make
	it build cleanly

2000-06-27  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Made dates display grouping information
	properly.

2000-06-27  Peter Williams  <peterw@curious-george.helixcode.com>

	* message-list.c (mark_msg_seen): Need to return a value
	on error.

	* main.c (main): Don't start threads or enter threads if
	there's no threading! Sigh.

	* test-thread.c: Don't compile if no threads.

	* session.c: Work without broken threads.

	* message-list.c (filter_date): Solve the ctime_r problem the
	correct way, with the magic of autoconf.

2000-06-27  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Work around mismatched ctime_r functions.  This
	will be fixed.

2000-06-27  Peter Williams  <peterw@curious-george.helixcode.com>

	* mail-threads.c: Don't compile this if we don't have
	threads enabled. This should maybe be on the Makefile.am
	level.

2000-06-27  Michael Zucchi  <zucchi@zedzone.mmc.com.au>

	* component-factory.c (owner_set_cb): Put in a gross hack to
	export the shell reference elsewhere.

2000-06-26  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Added a value_to_string handler.

2000-06-26  Peter Williams  <peterw@helixcode.com>

	* component-factory.c, mail-ops.c: #ifdef the threads stuff so
	that if USE_BROKEN_THREADS is not defined we just call the functions
	in the main thread.

	* mail-threads.h: Don't declare funcs if USE_BROKEN_THREADS not
	defined.

	* mail-threads.c: Put the query and message boxes on top so that
	you can see them.

2000-06-26  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (error_dialog): va_start() returns void, don't
	assign it's retval to a variable.

2000-06-26  Ettore Perazzoli  <ettore@helixcode.com>

	* main.c (main): Call `GDK_THREADS_ENTER()' and
	`GDK_THREADS_LEAVE()' around the main loop as in the examples from
	the GTK+ FAQ.

	* mail-threads.c (DEBUG): New macro for debugging.
	(read_msg): Use it.

2000-06-25  Peter Williams  <peterw@helixcode.com>

	* Makefile.am: Clean up the various _LIBS and _CFLAGS
	to work with simpler THREADS_LIBS and THREADS_CFLAGS scheme.

2000-06-23  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): Improved the
	code to separate the imap namespace from the folder name.

2000-06-23  Peter Williams  <peterw@curious-george.helixcode.com>

	* component-factory.c: Include e-util/e-setup.h for the
	prototype of evolution_dir; prototype create_news_storage.
	(real_create_imap_storage, real_create_news_storage): New
	functions moving the camel stuff into the async callback.
	(create_imap_storage, create_news_storage): Chopped in
	half to move camel stuff as above.

	* mail-ops.c: Include "mail-threads.h" for threading protos.
	(real_fetch_mail, real_send_mail, real_expunge_folder): 
	New functions moving the camel stuff into the async callback.
	(async_mail_exception_dialog): A version of mail_exception_dialog
	to be called from the async handlers (just calls mail_op_error())
	(fetch_mail, expunge_folder, composer_send_cb): Cut in half to
	move camel stuff as above.
	(cleanup_send_mail): Clean up after the async real_send_mail
	with the gtk_object_destroys et al.

	* mail-threads.c: Instead of hiding the progress bar, make it
	zip back and forth constantly.
	(progress_timeout): New func. Timeout called to make the pbar
	shimmy.
	(timeout_toggle): New func. Turn on and off the shimmy effect.
	(check_cond): New func. Make sure that the GCond for modal
	operation is initialized before mail_op_{error,get_password}.
	(show_error_clicked, read_msg, get_password_clicked): Move
	over to timeout_toggle.
	(mail_op_error,mail_op_get_password): Add check_cond() call.

	* main.c: (main) Call g_thread_init.

	* session.c: Change auth_callback stuff over to assume that it's
	being called async. Note: no real good way to tell if this is
	the case or not.
	(request_callback): ifdef'ed out
	(evolution_auth_callback): Use mail_op_get_password.
	
2000-06-22  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): Now should
	correctly get the selected folder from the given URL.

2000-06-22  Chris Toshok  <toshok@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): add handling for
	loading "news:" folders.

	* component-factory.c (create_news_storage): add a root for news
	source.
	(owner_set_cb): call create_news_storage.

2000-06-22  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): Updated to
	prepend url-> path if it exists for that imap store.

	* component-factory.c (create_imap_storage): Modified to not
	prepend a hard-coded namespace.

2000-06-22  Chris Toshok  <toshok@helixcode.com>

	* mail-ops.c (fetch_mail_cleanup): new function, passed as arg to
	mail_operation_try.
	(fetch_mail): add cleanup func arg.

2000-06-22  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Changed ml_value_at to return "" instead of NULL
	in some cases.

2000-06-22  Peter Williams  <peterw@curious-george.helixcode.com>
	* Makefile.am: Add GNOME_EXTRA_LIBS so that we get libgthread
	in our LIBS for evolution-mail.
	
	* mail-threads.c: Make the dialog boxes for error and
	question non-modal. They're modal relative to the dispatch
	thread, but before they would also eg lock up the toolbar
	buttons (while the menus, managed by another process, were
	active -- a weird effect).
	
2000-06-22  Peter Williams  <peterw@curious-george.helixcode.com>

	* mail-threads.[ch]: Extra argument to mail_operation_try:
	'cleanup', a function to be called in the main thread after
	the dispatcher thread exits. gtk_object_destroy's et al may
	attempt to unmap windows so we can't do them in the dispatcher
	thread :-(

	* test-thread.c: Updated with demo of new argument working.

2000-06-22  Peter Williams  <peterw@helixcode.com>

	* test-thread.c (op_5): New tests for the get_password
	hook.

	* mail-threads.[ch]: New hook, mail_op_get_password, for
	getting a user response from an async operation. The operation
	blocks while waiting for the response. A big whole mutex 
	condition threading blocking dealie to make sure that it 
	works.

	Also the error hook creates a dialog again, which also needs
	to block its caller while we wait for the user to press ok.

2000-06-22  Peter Williams  <peterw@helixcode.com>

	* mail-threads.c (various functions): Prettify the UI
	so that the progress bar doesn't become all huge 'n stuff.
	(mail_operation_try): Now save the operation's description,
	so that we can display it later as the default message.
	(read_msg): When the operation starts set the label to its
	UI-friendly name.
	(dispatch_func): Free the saved prettyname.

2000-06-21  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Removed an erroneous comment.

2000-06-21  Dan Winship  <danw@helixcode.com>

	* mail-config.c (create_transport_page): Make this not crash if
	you don't have a transport configured.
	
	* message-list.c: Update received date to work like sent date.

2000-06-21  Peter Williams  <peterw@helixcode.com>

	* mail-thread.{c,h}: New files -- a simple API for executing
	the major mail ops (fetch_mail etc) asynchronously, allowing
	the operations to send messages and update a progress bar.

	* test-thread.{c,h}: Tests the mail-thread API.

	* Makefile.am: add mail-thread.[ch] to evolution_mail_SOURCES
	and declare the test_thread noinst_PROGRAM.

2000-06-21  Peter Williams  <peterw@helixcode.com>

	* mail-format.c (mail_generate_reply): Include "e-setup.h" to
	get the prototype for evolution_dir.

2000-06-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* component-factory.c (create_imap_storage): Oops. Should
	have checked for a NULL sources.

2000-06-20  Dan Winship  <danw@helixcode.com>

	* message-list.c (mark_msg_seen): Quick hack to prevent a NULL
	pointer dereference. Things need to be cleaned up a bit more here
	though.

	* mail-sources.c: Oops. This should have been removed a long time
	ago.

2000-06-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): Working on getting 
	this to work :)

	* component-factory.c (create_imap_storage): Should now correctly
	construct the folder path allowing the selection of a folder.

2000-06-20  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-format.c (mail_generate_reply): Declare `evolution_dir'.
	Ugly, ugly, ugly, but I am not sure where it should go instead.

2000-06-19  Ettore Perazzoli  <ettore@helixcode.com>

	* mail-ops.c (ask_confirm_for_empty_subject): New function to ask
	confirmation for an empty subject line.
	(composer_send_cb): Use it if the subject is empty and only send
	the message if the user confirms.

2000-06-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* component-factory.c (create_imap_storage): Now creates the IMAP
	storage (listing subfolders and such)

2000-06-19  Dan Winship  <danw@helixcode.com>

	* mail-format.c (find_preferred_alternative): add an option to
	prefer text/plain.
	(reply_body): add an option to prefer text/plain
	(mail_generate_reply): Check the mail sending preferences, and
	generate a text/plain reply if the user prefers to send plain text
	(and we have a text/plain part to generate a reply from).

2000-06-19  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (providers_config_new): Should now correctly display
	the Transport page (made it set the optionmenu correctly, before it
	would only set SMTP).
	(create_transport_page): Updated to set the page info to sendmail/smtp
	based on the url.
	(create_service_page): Had to add some code to set data on some objects
	so I could grab the objects I needed to modify in the above function.

2000-06-18  Jeffrey Stedfast  <fejj@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): started to add
	code to load an IMAP folder.
	
	* component-factory.c: Started to add a create_imap_storage 
	method so that we can eventually have our IMAP store displayed 
	in the tree view.
	(create_vfolder_storage): Renamed from
	create_test_storage().
	(owner_set_cb): Updated.

2000-06-17  Dan Winship  <danw@helixcode.com>

	* message-list.c (message_list_set_folder): Prevent double-freeing
	action on summary_table and uid_rowmap.

2000-06-16  Dan Winship  <danw@helixcode.com>

	* message-list.c (ml_set_value_at): Implement clicking on the
	envelope icon to set read/unread. Based on a patch by clahey.
	(select_msg): keep the timeout id for the "seen" flagging in the
	message_list structure, so ml_set_value_at can clear it so it
	doesn't re-mark a message seen after you click it unseen.

2000-06-16  Dan Winship  <danw@helixcode.com>

	* message-list.c (get_message_row): new function to do a uid to
	row mapping.
	(mark_msg_seen, select_msg, message_changed,
	message_list_set_folder): Update for Camel flag changes.
	(on_cursor_change_cmd): Rename "row_to_select" to "selected_row",
	and keep a "selected_uid" as well.

	* mail-ops.c (composer_send_cb): Update for Camel flag changes,
	and fix some memory-handling bugs. (Free the post_send_data when
	the composer is destroyed, not when the user clicks "send", which
	could happen never, or more than once.)
	(delete_msg): Update for Camel flag changes, and fix the "holding
	down the delete key skips some messages" bug.

2000-06-15  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (fetch_mail): 
	* component-factory.c (owner_unset_cb): 
	* message-list.c (message_list_set_folder): Update for CamelFolder
	changes.

	* folder-browser.c (folder_browser_clear_search): New function to
	revert back to non-searching mode.

	* mail-ops.c (fetch_mail): Use folder_browser_clear_search.

	* mail-display.c (on_url_requested): if the document requests an
	unknown URL, it's not an error; just ignore the URL.

	* mail-ops.c (fetch_mail): If there's no new mail, tell the user.

2000-06-14  Radek Doulik  <rodo@helixcode.com>

	* main.c (main): call gtkhtmllib_init here

2000-06-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (on_SourceConfigDialogButton_clicked): Make sure source
	is always pointing to something, so a blank is not written to the config file
	on close.

2000-06-13  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (SHELL_OBJS): Removed.
	(evolution_mail_LDADD): Use `libeshell.a'.  Also use
	`top_builddir' consistently.

2000-06-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c: Got rid of sources_max_row and identities_max_row
	as they are not really needed (just use clist->rows)
	(on_cmdSourcesEdit_clicked): Modified to make 'source'
	point to the data being edited.
	(on_cmdSourcesAdd_clicked): Adds a new clist item and selects it so the
	editor knows where to stick the data when it's done.

2000-06-12  Federico Mena Quintero  <federico@helixcode.com>

	* message-list.c: Removed the ETableModel thaw handler.

2000-06-12  Dan Winship  <danw@helixcode.com>

	* folder-browser.c (folder_browser_set_uri): Return the result of
	folder_browser_load_folder.
	(get_prop, set_prop, folder_browser_properties_init): Remove. No
	longer needed.

	* folder-browser-factory.c (folder_browser_factory_new_control):
	Add a "uri" argument, return NULL if setting it fails.
	(folder_browser_factory_new_control): Remove property bag stuff.
	(folder_browser_factory_init, folder_browser_factory): Remove
	this, since we're using the component factory now.

	* component-factory.c (create_view): Update for
	folder_browser_factory_new_control change and return NOTFOUND as
	appropriate.

	* main.c (main): Don't call folder_browser_factory_init.

	* mail-format.c (mail_generate_reply): Fix the subject generation
	so we don't get "Re:  Re:". This is working around something that
	may later be declared a misfeature in Camel.

2000-06-10  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (create_folder): New stub implementation for
	the folder creation function in the EvolutionShellComponent we
	expose [it simply returns success all the time].
	(factory_fn): Pass this function to `evolution_shell_component_new'.

2000-06-09  Dan Winship  <danw@helixcode.com>

	* folder-browser.c (folder_browser_new): Add a serial number to
	FolderBrowser.

	* folder-browser-factory.c (control_activate, control_deactivate):
	Include fb serial number in the name of the Bonobo toolbar to
	prevent problems with disappearing toolbars. This is a kludge and
	should go away.


	* mail-ops.c (expunge_folder): display error from
	camel_folder_expunge if there is one.

	* message-list.c (select_row): install an idle function to
	select the row rather than doing it directly. Ugh. What a
	kludge, but at least it works now.

	* session.c (evolution_auth_callback): Update for
	CamelAuthCallback changes. (Uncache passwords when asked to.)

	* mail-ops.c (fetch_mail): close and expunge the source folder
	after copying it to a local folder.

2000-06-09  Ettore Perazzoli  <ettore@helixcode.com>

	* component-factory.c (create_view): Updated to match the changes
	to the definition of `EvolutionShellComponentCreateFn'.  If @type
	is not "mail", return an "unsupported type" error.
	(factory_fn): Pass NULL for the `remove_folder' and
	`create_folder' functions.

2000-06-09  Dan Winship  <danw@helixcode.com>

	* mail-format.c: Redo things a bit so that whitespace-only
	text parts aren't displayed. (In particular, so that
	whitespace-only subparts of multipart/mixed aren't displayed as
	separate (empty) parts.)

2000-06-06  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (fetch_mail): 
	* folder-browser.c (folder_browser_load_folder): Update for folder
	creation/existence changes.

	* message-list.c (message_list_set_folder): Remove the code to
	create the folder if it doesn't exist, since we don't want to do
	that.

2000-06-05  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (composer_send_cb): Leave the composer window around
	if the message doesn't get sent.

2000-06-05  Matt Loper  <matt@helixcode.com>

	* folder-browser.c (etable_key): Allow "GDK_KP_Delete", a keypad
	delete key, to delete a message.

2000-06-05  Dan Winship  <danw@helixcode.com>

	* session.c (evolution_auth_callback): Remember passwords between
	calls.
	(forget_passwords): Callback for "Forget Passwords" menu item.

	* folder-browser-factory.c (control_activate): 
	(control_deactivate): Add "Forget Passwords" menu item.

	* mail.h, mail-ops.c: fix some function prototypes

	* folder-browser.c (etable_key): Add "Delete" = delete message.

	* mail-format.c (mail_generate_forward): Update for new composer
	attachment interface.

2000-06-02  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (providers_config_new): Added a new notebook
	page that allowed for mail format (text/plain or 
	multipart/alternative)

2000-06-02  Dan Winship  <danw@helixcode.com>

	* message-list.c (filter_date): If the date in the summary is 0,
	output "?".

	* component-factory.c (create_view): keep a GList of folder
	browsers created
	(owner_unset_cb): Go through the list and close each folder before
	exiting so they sync their summary state, etc to disk.

	* mail-ops.c (fetch_mail): Use camel_service_connect, not
	connect_with_url, since we already passed the URL into
	camel_session_get_store.

2000-06-02  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Use camel_folder_free_summary instead of
	g_ptr_array_free.  Unref the folder when we're done with it.

2000-06-02  Christopher James Lahey  <clahey@helixcode.com>

	* session.c: Revert removal of e_setup_base_dir.

2000-06-02  Dan Winship  <danw@helixcode.com>

	* folder-browser.c (my_folder_browser_init): Connect to ETable's
	key_press signal.
	(etable_key): scroll mail on space/backspace.

2000-06-02  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Made sent column as wide as from column.

2000-06-02  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c (on_cmdSourcesAdd_clicked): Changed identity_row
	to source_row as this is a Sources clist we are dealing with and
	not an identity clist
	(on_cmdSourcesEdit_clicked): same
	(on_cmdSourcesDelete_clicked): again, same
	(on_cmdSourcesEdit_clicked): Source editor now fills in data from
	the clist

2000-06-01  Dan Winship  <danw@helixcode.com>

	* message-list.c: Add a date column.	
	(COL_SENT_WIDTH_MIN): Make this wider.
	(ml_value_at): return the sent date (as a time_t) for COL_SENT.
	(Fix COL_TO too while I'm here.) 
	(ml_duplicate_value, ml_free_value, ml_initialize_value,
	ml_value_is_empty): COL_SENT is numeric now.
	(message_list_init_renderers): Create a date renderer (using
	text_filter to translate the time_t into a string).
	(message_list_init_header): Use render_date for COL_SENT.

2000-06-01  Christopher James Lahey  <clahey@helixcode.com>

	* session.c: Don't call e_setup_base_dir.

2000-06-01  Dan Winship  <danw@helixcode.com>

	* mail-format.c (mail_generate_forward): Fix forwarding to work
	for people other than me. :) [Although apparently it doesn't
	really.]

	* mail-ops.c (delete_msg): Add a quick hack to move the selection
	down a row when you delete a message.

	* mail-format.c (handle_message_rfc822): use <blockquote> rather
	than <center><table border=1 width=95%> to frame the embedded
	message. If <pre> text in the subtable won't fit in the 95% width,
	GtkHTML will write past the border of the table (and
	<blockquote><table border=1> causes creeping updates so it's not
	usable for now).
	
2000-06-01  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c (message_list_init): Turn off the grid in our
	ETable.

2000-06-01  Dan Winship  <danw@helixcode.com>

	* mail-format.c (write_headers): Oops. This needs to take a
	message argument because we might be writing headers for an
	embedded message/rfc822 subpart rather than the root document.

2000-06-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c: Config dialogs are completed.
	(service_acceptable): Fixed a segfault caused by duplicate 
	camel_exception_free()
	(providers_config_new): Identity and Source clists are now filled in
	when the dialog is created as well as the Transport page

	* folder-browser-factory.c: Renamed Tool/ menu items
	Vfolder was changed to Virtual Folder and
	Configure Camel Providers was changed to Mail Configuration

2000-06-01  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (evolution_mail_LDADD): Link with
	`libemiscwidgets.a'.

	* mail-display.c (mail_display_new): Use an EScrollFrame instead
	of a GtkScrolledWindow.
	(mail_display_set_message): Likewise.

	* mail-display.h: Replace the GtkScrolledWindow with an
	EScrollFrame.

2000-06-01  Dan Winship  <danw@helixcode.com>

	* component-factory.c (owner_unset_cb): Quit when the shell exits.
	This is a kludge, but a pretty necessary one until the refcounting
	bugs that keep the component from exiting properly are fixed.

2000-05-31  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c: Partially implemented the source
	configuration, seems to segfault due to a destroyed
	gnome dialog being destroyed again in the method
	on_SourceConfigDialogButton_clicked()

2000-05-31  Dan Winship  <danw@helixcode.com>

	* mail-format.c (free_url, handle_text_enriched,
	get_url_for_icon): Fix up memory management of x-evolution-data
	URLs so the URLs and/or their data don't get freed while there are
	still references to them.

	* message-list.c (message_list_init_header): redo the (unused)
	online status column to no longer refer to pixmaps that no longer
	exist.

2000-06-01  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c (control_activate): Put the toolbar
	into a frame to make it look like standard GNOME toolbars.  Also,
	set `GNOME_DOCK_ITEM_BEH_NEVER_VERTICAL' so that it does not do
	evil things when its moved to the left or the right of the window.

2000-05-31  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail-config.c: Configuration dialog now allows 
	adding/editing/deleting of Identities (which leaves
	adding/editing/deleting of sources left to implement).
	The data is also saved when the dialog is exited via 
	the OK button.

2000-05-31  Dan Winship  <danw@helixcode.com>

	* mail-format.c (mail_format_mime_message): Initialize the "urls"
	hash table stored on the message and store cid and other URLs
	there rather than as object data on the message.
	(get_cid): rewrite this a bunch
	(handle_text_enriched): move the code from write_iframe_string()
	into here, since it's the only place that actually needs it.
	(handle_text_html): simplify this a lot. We can use a cid: URL
	here rather than x-evolution-data.
	(get_url_for_icon): New routine to return URLs for icons, and
	cache the results, so we don't have to keep re-reading the icon
	files (and so we can't be spoofed into reading non-icon files).
	(handle_mystery, handle_audio): use get_url_for_icon.

	* mail-display.c (save_data): move the CamelMimePart filename
	extracting code from get_cid to here.
	(on_link_clicked, on_object_requested): Update for cid: changes.
	(on_url_requested): Kill off the kludgy, exploitable x-gnome-icon
	URL schema, update cid and x-evolution-data to match
	mail-format.c.

	It should now be easier to implement RFC 2557 (Content-Location,
	etc), but that RFC still pretty much sucks.

2000-05-30  Dan Winship  <danw@helixcode.com>

	* mail-format.c: Redo this back to the old way: a single GtkHTML
	with various things inline in it. (Gets rid of flicker, simplifies
	some scrolling, selecting, and printing issues.)
	(handle_text_enriched, handle_text_html): Use <iframe>s for these,
	to protect the rest of the document from their possibily invalid
	HTML.
	(handle_via_bonobo): Use (new-and-improved) <object> tags for
	this, moving most of the work back into mail-display.c

	* mail-display.c (on_object_requested): Move the Bonobo embedding
	code back here again (reorganized a bit).
	(on_url_requested): add x-evolution-data handler, for iframe
	bodies.
	(mail_html_new, mail_html_end): removed
	(mail_display_set_message, mail_display_new): Update for NWO.

2000-05-30  Not Zed  <NotZed@HelixCode.com>

	* folder-browser.c (search_set): Properly encode the search string.

2000-05-30  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail.h: Added a prototype for providers_config_new() which
	is the constructor for the configuration dialog window

	* mail-config.c: Added set_service_url() which is basically
	the reverse of get_service_url().
	Implemented on_cmdCamelServicesOK_clicked() - The configuration
	window will now remember the Sendmail/SMTP data that the user
	had entered in the previous session.
	Removed on_cmdCamelServicesApply_clicked() - No need for this.

2000-05-30  Dan Winship  <danw@helixcode.com>

	* message-list.c (message_changed): call
	e_table_model_row_changed, not e_table_model_changed so we do less
	work, and don't lose the current selection.
	(select_msg): Set up a timer to mark the displayed message as
	"seen" if it's selected for longer than 1.5 seconds (a number
	pulled out of Matt's butt).
	(ml_value_at): Use the MESSAGE_STATUS column for read/unread as
	well as deleted.

	* message-list.c: use the "new" tigert pixmaps rather than the
	older ones. Includes a "replied to" icon (which is used now), but
	no "deleted" icon (although we have the strikeout renderer for
	that now).

2000-05-30  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, message-list.h: Added bold for unread messages.

2000-05-30  Jeffrey Stedfast  <fejj@helixcode.com>

	* mail.h: Added a prototype for providers_config()
	which is the callback for a new menu item that
	will construct a configuration dialog for the camel
	providers and identities and display it

	* mail-config.c: Added some code to construct the 
	new providers dialog and a bunch of callbacks (most 
	of which are not yet useful)

	* mail-ops.c: Added the code for the providers_confi()
	callback

	* folder-browser-factory.c: Added the 
	"Tools/Camel Providers Configuration ..." menu item

2000-05-30  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Switched to using "cursor_change" signal instead
	of "row_selection" for switching messages.  Select the first row
	(still doesn't work because of ETable.)  Adapt to some small
	ETable changes.  Set drawfocus to FALSE.

2000-05-29  Not Zed  <NotZed@HelixCode.com>

	* folder-browser.c (folder_browser_load_folder): Hardcode the
	vfolder source to just the inbox (so at least it returns
	something).

	* component-factory.c (create_test_storage): Create a vfolder dir
	first, and put the folders in that.
	(create_test_storage): Create the storage as VFolders, not
	"storage_name" :)

2000-05-28  Dan Winship  <danw@helixcode.com>

	* mail-config.c (error_dialog): helper function since we need to
	set "modal" on the dialogs returned by gnome_error_dialog to make
	them work when popped up from the modal Druid.
	(service_acceptable): New function to check if the info entered on
	a store/transport page actually checks out.
	(mail_config_druid): Connect to the "next" signal on the store and
	transport pages and don't let the user continue if the data is
	bad and "check this before continuing" is checked. Also, only
	display sources/transports in the "mail" domain. (Ie, not
	"vfolder".)

	* mail-format.c (write_recipients_to_stream): Use `foo@bar' rather
	than `<foo@bar>' for recipient with no name.

	* mail-ops.c (fetch_mail): don't put up an error message if the
	user cancels the password dialog.

2000-05-27  Not Zed  <NotZed@HelixCode.com>

	* Makefile.am (SHELL_OBJS): Include mail storage so we can
	initialise folders.

	* component-factory.c (create_test_storage): Parses vfolder
	defintions and adds them to the storage.  Definetly needs more
	work.

	* folder-browser-factory.c (control_activate): Add the VFolder
	druid menu item.
	(control_deactivate): And remove it.

	* mail-ops.c (vfolder_editor_clicked): For editing vfolder
	definitions (rather like filters, oddly enough :).  Tries to
	update the shell but it doesn't seem to work properly - requires a
	mail component restart to take effect.

	* folder-browser.c (folder_browser_load_folder): Handle vfolder:
	urls' appropriately and map to camel.  Still needs a way to tell
	the vfolder what folders to search! (all vfolders come up empty!).

2000-05-28  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c, message-list.h: Added a COL_DELETED and made it
	the strikeout column for both text renderers.

2000-05-27  Dan Winship  <danw@helixcode.com>

	* mail-format.c: Various improvements:

	(call_handler_function, etc): Add a "mime_type" argument to the
	handlers, so that if a part is tagged as
	"application/octet-stream", and we figure out that it's really
	something else, the handler we call can know what that something
	else is.

	(handle_text_enriched): Small fixes to make this not do
	text/enriched-specific syntax in text/richtext or vice versa.

	(handle_mystery): Allow for mystery data that can't even be saved
	to disk. (ie, unrecognized external-body). Let the caller specify
	the URL to use.

	(handle_message_external_body): New function to deal with
	message/external-body parts. Generates URLs for anon-ftp,
	local-file, and URL access-types, and a more-useful-than-before
	descriptive message for other types.

	(handle_audio, handle_undisplayable): Use gnome_mime_get_value to
	try to get a description of the MIME type to display to the user
	rather than the raw form. (This will only work if the user has
	recent gnome-vfs installed. [If they don't, it works just like
	it used to.])

2000-05-26  Dan Winship  <danw@helixcode.com>

	* mail-format.c (handle_text_html): Fix a bug (security/stability)
	in its usage of mail_html_write.

	* mail-ops.c (composer_send_cb, reply): set CAMEL_MESSAGE_ANSWERED
	on a message after a successful reply.

	* message-list.c (folder_changed): free the summary with
	camel_folder_free_summary rather than g_ptr_array_free.

	* mail-format.c (handle_via_bonobo): Update for PersistStream
	changes

2000-05-25  Ettore Perazzoli  <ettore@helixcode.com>

	* main.c (main): Initialize the component factory.

	* Makefile.am (evolution_mail_LDADD): Link with
	`evolution-shell-component.o' from the shell directory.

	* evolution-mail.oafinfo: Updated with the
	Evolution::ShellComponent OAFIID.

	* evolution-mail.gnorba: Updated with the
	Evolution::ShellComponent GOAD ID.

	* folder-browser-factory.c (folder_browser_factory_new_control):
	New function; code moved out from `folder_browser_factory'.
	(folder_browser_factory): Use it.

	* component-factory.c: New.
	* component-factory.h: New.

2000-05-24  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (composer_send_cb): connect to and disconnect from
	the transport.

2000-05-24  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Added libepaned.a.
	
	* folder-browser.c: Switched from GtkPaned to EPaned.

2000-05-23  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am: Don't link to `evolution-service-repository.o'
	anymore.

	* folder-browser-factory.c: Don't use crufty service-repository
	anymore.

2000-05-21  Ettore Perazzoli  <ettore@helixcode.com>

	* message-list.c (get_message_info): Made static.
	(ml_initialize_value): Return NULL to placate compiler.

	* folder-browser.c (folder_browser_gui_init): Add cast.

	* mail-display.c (mail_html_new): Don't pass an empty URL to
	`gtk_html_begin()' anymore.

	* mail-config.c (put_html): Don't pass an empty URL to
	`gtk_html_begin()' anymore.

	* mail-display.h: Updated for the new GtkHTML API that uses
	`GtkHTMLStream *' instead of `GtkHTMLStreamHandle'.
	* mail-display.c: Likewise.
	* mail-config.c: Likewise.
	* mail-format.c: Likewise.

2000-05-19  NotZed  <NotZed@HelixCode.com>

	* mail-format.c: Fixes for stream stuff.

	* mail-display.c (save_data_cb): Remove exception stuff on streams.

2000-05-19  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Added initialize_value and value_is_empty
	callbacks.

2000-05-18  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (folder_browser_factory): Remove
	development_warning (moved to shell)

	* message-list.c (select_msg): Update for camel_folder_get_uids
	(folder_changed, message_list_set_folder): Update for
	camel_folder_get_summary

	* mail-ops.c (fetch_mail): Update for camel_folder_get_uids

2000-05-17  Dan Winship  <danw@helixcode.com>

	* mail-component.c: This seems to be cruft. Nuke it.

	* mail-display.c (save_data_cb, save_data, on_url_requested):
	* mail-format.c (handle_text_plain_flowed, handle_text_html):
	Use camel_data_wrapper_write_to_stream rather than
	camel_data_wrapper_get_output_stream.

2000-05-16  NotZed  <NotZed@HelixCode.com>

	* mail-ops.c (filter_edit): Function to bring up the filter editor.
	(filter_druid_clicked): Save/close dialogue.
	(fetch_mail): Apply filters to incoming mail ... *hold breath*
	If we are coming from a non-indexed/searchable/etc source, then
	copy it to an mbox first.  When copying mail from an mbox source,
	dont remove it aftewards, open it for append, so partially
	filtered mail isn't lost.

	* Makefile.am (evolution_mail_LDADD): Added libfilter.
	(INCLUDES): Add EVOLUTION_DATADIR, and fix matt's brokeneditor(tm)
	for putting spaces instead of tabs in.

2000-05-16  Christopher James Lahey  <clahey@helixcode.com>

	* mail-format.c: Removed usage of bonobo_object_destroy.

2000-05-14  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Updated to work with new ETable resizing.

2000-05-12  NotZed  <NotZed@HelixCode.com>

	* mail-ops.c (fetch_mail): Use 6 X's to mkstemp, as required by
	the man page, just a temp fix, this should probably change to a
	known filename.

2000-05-11  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (control_activate): Now that we depend
	on current gnome-libs we can make the toolbar detachable again.

2000-05-11  Federico Mena Quintero  <federico@helixcode.com>

	* folder-browser-factory.c (development_warning): Left-justify the
	message.

2000-05-10  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser-factory.c (development_warning): Made this dialog
	have fewer buttons.

2000-05-10  Christopher James Lahey  <clahey@helixcode.com>

	* folder-browser-factory.c (development_warning): New development
	warning text from Nat.

2000-05-10  Larry Ewing  <lewing@helixcode.com>

	* mail-config.c (html_new): only set the default background color
	if style is not NULL.

2000-05-09  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Removed folder-browser-factory.h since it doesn't
	exist.  Added mail-display.h, mail-types.h, pixmaps.h.

2000-05-09  Matt Loper  <matt@helixcode.com>

	* folder-browser-factory.c (control_activate): Remove "File->mail"
	menuitem.

	* mail-config.c (mail_config_druid): Fill in "blah blah blah".

2000-05-09  Dan Winship  <danw@helixcode.com>

	* folder-browser.c (folder_browser_load_folder): make this a
	little less kludgy. Use gnome_error_dialog rather than printf on
	errors.

	* mail-ops.c (fetch_mail): Fix to work with the new shell stuff...
	sorta. Will need more fixing later when the new shell framework is
	more done.

	* mail-config.c (finish): Call gnome_config_sync so the data
	actually gets written.

2000-05-08  Dan Winship  <danw@helixcode.com>

	* mail-display.c (save_data_cb):
	(on_url_requested): Update for CamelStream CamelException changes.

	* mail-format.c: Pass NULL for a CamelException in a bunch of
	places... the user will see that the data is not being displayed,
	and there's not a lot we can do, and none of these things should
	be failing anyway. Maybe fix this later.

2000-05-07  NotZed  <NotZed@HelixCode.com>

	* message-list.c (ml_value_at): Size moved to message info, rather
	than content info structure.

2000-05-07  Dan Winship  <danw@helixcode.com>

	* message-list.c (select_msg): unref the message after displaying
	it.

	* mail-format.c (get_data_wrapper_text):
	(handle_text_plain_flowed): 
	(handle_via_bonobo): Replace camel_stream_close calls.

2000-05-07  Matt Loper  <matt@helixcode.com>

	* folder-browser-factory.c: Changed a toolbar button from saying
	"New mail" (which suggests you might be composing new mail) to
	"Get mail".

2000-05-06  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (folder_browser_factory): Don't
	hardcode "inbox" here.

	* folder-browser.c (folder_browser_set_uri): Don't hardcode
	"inbox" here either.
	(folder_browser_load_folder): Create a new store according to the
	folder browser's URI, and load the mbox file from that store.
	Parts of this are temporary.

	* session.c, mail.h: There is no longer a global store, just a
	global session.

	* mail-config.c, mail-ops.c: Update for default_session -> session
	change. fetch_mail is currently broken.

2000-05-06  Dan Winship  <danw@helixcode.com>

	* mail-config.c: New code to configure identity, mail source, and
	mail transport.
	(mail_config_druid): A druid using the config widgets. (Only
	allows configuration of a single identity, source, and transport.)

	* mail-ops.c (check_configured): New function to make sure the
	user has configured stuff, and call the	druid if not.
	(fetch_mail, send_msg, send_to_url, reply, forward_msg): Call
	check_configured
	(composer_send_cb): Make this pass the message to a CamelTransport
	rather than just printing it to stdout.

	* folder-browser-factory.c (development_warning): Add a warning
	about sending mail, since you can do that now.

2000-05-06  Chris Toshok  <toshok@HelixCode.com>

	* .cvsignore: ignore evolution-mail.pure

	* Makefile.am: add support for building evolution-mail.pure

2000-05-06  Dan Winship  <danw@helixcode.com>

	* mail.h: consolidate mail-format.h, mail-identify.h, mail-ops.h,
	main.h and session.h into this new file. There's no reason to have
	a .h for every .c.

2000-05-05  Anders Carlsson  <andersca@gnu.org>

	* test-mail.c (create_container): Use the OAFIID when using an 
	OAF-enabled build of bonobo.

2000-05-04  NotZed  <NotZed@HelixCode.com>

	* message-list.c (message_list_set_folder): Get the whole message
	summary right away.
	(folder_changed): And if we change too.
	(ml_row_count): Use the match count or summary table length as the
	row count.
	(get_message_info): Use array references to lookup message summary
	info.  For the search result list, use the summary_search_cache to
	cache the info lookup.
	(message_list_init): Allocate the summary search cache.
	(message_list_destroy): Free the summary search cache and the
	summary table, if there is one to free.
	(message_list_set_search): Save the match count, and clear the
	summary search cache for reuse.
	(folder_changed): Re-retrieve the summary list if the folder has
	changed.
	(message_list_set_folder): Retrieve the summary list when opening
	the folder.

2000-05-03  Jason Leach  <leach@wam.umd.edu>

	* Makefile.am (evolution_mail_LDADD): s/-lunicode/$(UNICODE_LIBS)/
	in the LDADD section.

2000-05-03  Dan Winship  <danw@helixcode.com>

	* mail-format.c (write_recipients_to_stream, write_headers): Make
	the "Cc:" field optional again. (Before, we could check if
	camel_mime_message_get_recipients returned NULL, but now we need
	to actually look into the returned CamelInternetAddress object.)

2000-05-03  Larry Ewing  <lewing@helixcode.com>

	* folder-browser.c (folder_browser_gui_init): comment out the
	changed signal for now.

2000-05-02  Matt Loper  <matt@helixcode.com>

	* Makefile.am: set G_LOG_DOMAIN.

2000-05-02  Larry Ewing  <lewing@helixcode.com>

	* message-list.c (message_list_set_search): only free search if it
	is not NULL.

2000-05-02  NotZed  <NotZed@HelixCode.com>

	* folder-browser.c (folder_browser_gui_init): Connect the changed
	signal to search, so it searched immediately?

2000-05-01  NotZed  <NotZed@HelixCode.com>

	* pixmaps.h: Added envelope-deleted state.

	* folder-browser-factory.c: Setup callback for actual delete op.
	(control_activate): Setup a tool menu item to expnge deleted
	messages.

	* mail-ops.c (delete_msg): Toggle the delete flag on a message.
	(expunge_folder): New function to expunge deleted messages from
	the current folder.

	* folder-browser.c (folder_browser_gui_init): A hackish little
	quick-search entry.
	(search_activate): Perform a quick-search on the folder subject
	only.
	(folder_browser_gui_init): Add an option meny to the search line.	
	(create_option_menu): Build the option menu from a table.
	(search_set): Build a search from another string whent he option
	menu or text item is changed.  5 search options are defined so
	far.

	* message-list.c (get_message_info): If there is an active search,
	then get the data from that ... use this instead of
	_get_message_info().
	(ml_row_count): If we have an active search, get the info from its
	result.
	(select_msg): Changed to use get_message_info, so searches work.
	(ml_value_at): And same here.
	(message_list_init_renderers): Added a 3rd state to message_status
	= deleted.
	(ml_value_at): Show the message state as deleted, if it is marked
	for deletion.
	(folder_changed): When the folder changes, update the display.
	(message_list_set_folder): Connect to the folder_changed event
	here.
	(message_changed): Callback to update the display when the message
	changes.
	(select_msg): And connect to the message_changed signal so we know
	when it cahgnes.
	(message_list_set_search): Save the search string.
	(folder_changed): If the folder changes, re-run the search,
	otherwise we may end up with invalid entries in the display.

	* mail-display.c: Include missing errno.h.

2000-04-30  Dan Winship  <danw@helixcode.com>

	* session.c (session_providers_init): This is no longer necessary.

	* mail-ops.c (fetch_mail): Remove kludge to load remote provider,
	as camel can do it by itself now.

2000-04-29  Dan Winship  <danw@helixcode.com>

	* mail-display.c (on_link_clicked): Handle clicks on "cid" URLs by
	popping up a "Save Attachment" dialog.

	* mail-format.c (get_cid): if the part has a Content-Disposition
	with a filename specified, record (a sanitized version of) that on
	the wrapper when creating the cid reference, so the "save
	attachment" code can use it later.
	(handle_mystery): fix a bug in the cid generation here.

2000-04-29  Dan Winship  <danw@helixcode.com>

	* mail-format.c (lookup_handler, etc): Improve the builtin vs
	bonobo selection code.
	(handle_mystery): Include name and Content-Description in the
	"mystery data" info, when available
	(handle_unknown_type): Call mail_identify_mime_part before
	giving up.
	(handle_undisplayable): Split out of handle_unknown_type now
	that handle_unknown_type can try alternate viewers.
	(handle_via_bonobo): Fall back to handle_undisplayable if the
	bonobo control fails.

	* mail-identify.c (mail_identify_mime_part): New function to
	attempt to identify a MIME part that we can't identify based on
	Content-Type alone.

	* mail-display.c (on_url_requested): redo the mystery data icon
	display stuff less kludgily.

2000-04-28  Dan Winship  <danw@helixcode.com>

	* mail-format.c (write_recipients_to_stream, write_headers,
	mail_generate_reply): Update (minimally) for Camel recipient
	changes.

2000-04-28  Ettore Perazzoli  <ettore@helixcode.com>

	* main.c (init_bonobo): Don't call `init_corba()' and don't get
	any args.
	(init_corba) [!USING_OAF]: Fix args.

2000-04-27  Ettore Perazzoli  <ettore@helixcode.com>

	* folder-browser-factory.c: New macro `CONTROL_FACTORY_ID', which
	is #defined to a different value according to whether we are
	`USING_OAF' or not.
	(folder_browser_factory_init): Use `CONTROL_FACTORY_ID'.

	* test-mail.c
	(init_corba): New helper function, implemented differently
	according to `USING_OAF'.
	(main): Use `init_corba()'.

	* main.c
	(init_corba): New helper function, implemented differently
	according to `USING_OAF'.
	(init_bonobo): Use `init_corba()'.

	* Makefile.am: Install OAF stuff if `USING_OAF'.  Add
	`-I$(datadir)/idl' to the `orbit-idl' command-line so that we can
	use Bonobo IDL files installed under our prefix as well.  Also,
	use `$(ORBIT_IDL)' instead of hardcoded `orbit-idl'.

	* evolution-mail.oafinfo: New file.

2000-04-27  Dan Winship  <danw@helixcode.com>

	* mail-format.c: Move text_to_html to e-util.

	* mail-ops.c (send_to_url): New routine. Thin wrapper for
	e_msg_composer_new_from_url.

	* mail-display.c (on_link_clicked): print a warning for news or
	nntp URLs (which we'll deal with some day), and call send_to_url
	for mailto URLs.

	* mail-format.c (text_to_html): Improve URL conversion code.
	Recognize https, recognize "www\..*" without a prefixed "http://".
	Properly escape &, <, >, etc in URL strings. Don't be fooled by
	"mailto:", "http://", etc with no following data.

2000-04-26  Dan Winship  <danw@helixcode.com>

	* mail-format.c (text_to_html): Reorganize a bit and add a new
	flag, TEXT_TO_HTML_CONVERT_URLS to recognize and wrap URLs
	in text.

	* mail-display.c (mail_html_new): Add link_clicked signal handler.
	(on_link_clicked): Use gnome_url_show to launch a browser.

	* mail-format.c: update for CamelStream changes. Update for
	CamelMimeBodyPart -> CamelMimePart

2000-04-25  Dan Winship  <danw@helixcode.com>

	* mail-display.c, mail-format.c: Redo large chunks of this. The
	mail display now consists of a vbox in a scrolled window, in which
	we put multiple GtkHTML objects. This means broken HTML in one
	part can't corrupt other parts. The headers now scroll with the
	body. Unrecognized attachments look prettier, but still don't do
	anything, and will probably be changed later. We can also now
	display nested message/rfc822 parts and multipart/alternatives
	with multipart subparts. Oh, and text/{richtext,enriched}, since
	we had all these ancient sample messages that use it and the lack
	of support annoyed me. :)

	Bonobo embeddables are broken right now, but I don't think that's
	my fault.

	* mail-format.c (reply_body): Fix some bugs that crept into reply
	generation. This needs a lot more work to deal correctly with
	complicated bodies.
	(setup_function_table): pass unknown text subtypes to
	handle_text_plain.
	(handle_multipart_appledouble): new handler. Just ignores the
	first (application/applefile) part and tries to display the
	second part. Since the second part is usually
	application/octet-stream, this doesn't work very well still
	usually.
	(reply_body): Make this deal better with multiparts.

	* mail-format.c, mail-display.c: Now that we're not limited to
	a single GtkHTML for the display, there's no reason to embed
	Bonobo objects for unrecognized content-types in GtkHTML rather
	than embedded them into the vbox directly. So do that.

	Meanwhile, fix up the handler-selection code so that we can
	declare which built-in handlers are more desirable than external
	handlers and which are less. (Of course, eventually we'll want
	this to be customizable.) Add some cleverness to
	handle_multipart_alternative as well so it doesn't accept an
	alternative which we can display generically over one we can
	display specifically.

	* mail-format.c (text_to_html): add a convert_space_hack flag,
	which turns N spaces into N-1 &nbsp;s and a space.
	(handle_text_plain): Check for "format=flowed" in the
	Content-Type.
	(handle_text_plain_flowed): Spinoff of handle_text_plain to deal
	with RFC 2646 flowed text. (All the examples I can find of it
	are generated by Eudora, but it's a pretty cool idea that ought
	to be used more widely.)

2000-04-23  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c: rename "send" to "send_msg", to avoid
	name clash with the tcp function. Connect the "forward" button.

	* mail-ops.c: rename "send" to "send_msg", to avoid name clash
	with the tcp function. Add forward_msg function.

	* mail-format.c (mail_generate_forward): support function for
	forward_msg. Pretty much a big kludge right now, pending the
	attachment/attachment-bar changes.

2000-04-22  Dan Winship  <danw@helixcode.com>

	* mail-display.c (on_url_requested): Change cid expectations to
	match current camel reality.

	* main.c (main): call glade_gnome_init, for composer.

	* folder-browser-factory.c: move msg_composer_cb and
	msg_composer_send_cb to mail-ops. Attach send, reply, and "reply
	to all" buttons.

	* mail-ops.c (composer_send_cb, send): moved from
	folder-browser-factory.c.
	(reply_to_sender, reply_to_all): new functions to do replies.

	* mail-format.c (text_to_html): Add an "add_pre" flag, to make
	it wrap the output in <pre></pre>.
	(mail_generate_reply): New function to create a composer and build
	a reply in it.

2000-04-21  Dan Winship  <danw@helixcode.com>

	* mail-display.c (on_url_requested): deal with cid: URLs.
	(find_cid): helper routine for above. (This could be much better.)
	(mail_display_init): connect url_requested signal

	* mail-format.c (handle_multipart_related): Make this work.

	* mail-display.c (mail_display_set_message): ref the message we
	display, since we're going to unref it when we remove it. Fixes a
	bug that showed up with the new camel code, but it's not obvious
	if it's due to a bug or a feature in the new code.

2000-04-20  NotZed  <NotZed@HelixCode.com>

	* Makefile.am (evolution_mail_LDADD): Add libibex.la to link.

	* message-list.h: Removed folder summary.

	* message-list.c: Dont include folder-summary anymore.
	(select_msg): Changed to use folder, not summary in
	summary_get_message_info().  God this code is grotty.
	(ml_value_at): Ditto.
	(ml_value_at): Changed to use new interface.  Hmm, this returns a
	static variable, that seems wrong.
	(message_list_set_folder): Remove folder summary.
	(ml_row_count): Oops, remove some debug i put there.

2000-04-20  Dan Winship  <danw@helixcode.com>

	* mail-display.c: update for bonobo change, and remove a
	now-unused variable.

2000-04-17  Chris Toshok  <toshok@helixcode.com>

	* message-list.c (on_row_selection_idle): new function, actually
	calls select_msg.
	(on_row_selection_cmd): register an idle instead of calling
	select_msg directly.  this fixes the lag before the row is
	selected - selection is instantaneous now, with message loading
	happening afterward.

	* message-list.h: add row_to_select and an idle_id to the message
	list to make the select_msg call happen in an idle func.

	* message-list.c (message_list_init_renderers): no more
	e_cell_set_editable.  this info always comes from the model.

2000-04-14  Dan Winship  <danw@helixcode.com>

	* mail-format.[ch]: Moved from camel/camel-formatter, and changed
	slightly. (More to come.)

	* html-stream.[ch]: No longer necessary. mail-format uses
	GtkHTMLStreamHandles directly.

	* mail-display.[ch]: update for new message formatting code.

2000-04-14  Chris Toshok  <toshok@helixcode.com>

	* folder-browser-factory.c (control_activate): use
	gnome_app_fill_toolbar_with_data, so we get the beautiful gnome
	toolbar.

2000-04-14  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (development_warning): Fix up the
	warning message a bit.
	(folder_browser_factory): Make the warning bypassable.

2000-04-12  Miguel de Icaza  <miguel@gnu.org>

	* main.c (main): Call e_cursors_init.

2000-04-10  Dan Winship  <danw@helixcode.com>

	* mail-ops.c (fetch_mail): use camel_movemail when fetching mail
	from an mbox store. This leaves behind temp files for now,
	because CamelMboxFolder::delete is too confused to use, and NotZed
	is rewriting CamelMboxFolder, so I'm not going to bother to try to
	fix it.

	* mail-ops.c: Add some #includes for the non-HAVE_MKSTEMP case

2000-04-09  Matt Loper  <matt@helixcode.com>

	* folder-browser.c (folder_browser_new): set folder_browser->uri
	to NULL, so that we know when to free it.

2000-04-07  Miguel de Icaza  <miguel@gnu.org>

	* message-list.c (states_pixmaps): Add more beautiful art from
	Miggue, the Diego Rivera of the next millenium.
	(message_list_init_header): Use the beautiful art.

	* pixmaps: Miguel rediscovers the "transparent" concept.

2000-04-07  Matt Loper  <matt@helixcode.com>

	* folder-browser.c (folder_browser_destroy): Unref the shell
	interface that we have a handle to.

	* folder-browser-factory.c (control_destroy_cb): New function;
	destroys a folder-browser when its control is destroyed.
	(folder_browser_factory): Hook up to the above.

2000-04-07  Dan Winship  <danw@helixcode.com>

	* mail-ops.c: new file, for toolbar/menu callbacks
	(fetch_mail): fetch mail. Doesn't do mbox locking. Many kludges.

	* folder-browser-factory.c (control_activate): use new fetch_mail
	function as the callback for the "New mail" icon. Rename check_cb
	to random_cb.

	* Makefile.am: don't build test-sources since the version in
	CVS doesn't do much and once I've fixed it it won't be a separate
	program. Add mail-ops.[ch].

2000-04-06  Miguel de Icaza  <miguel@gnu.org>

	* message-list.c: Stick pixmaps here.

	* mail-display.c (embeddable_destroy_cb): Replaced C++ comments
	with C comments.

	* message-list.c (load_internal_images): New function, loads images.
	(message_list_init_renderers): Load images, fix previous attempt
	at loading images. 

	* Makefile.am (dist-hook): Added distribution of pixmaps.

	* pixmaps: New directory, used to hold the XPMs we ship with. 

	* pixmaps/envelope-closed.xpm, pixmaps/envelope-open.xpm: Tigert's
	envelopes incorporated.

2000-03-31  Miguel de Icaza  <miguel@gnu.org>

	* message-list.c (ml_value_at): Fix miss-used variable. 

2000-04-01  Michael Meeks  <michael@helixcode.com>

	* folder-browser.c (folder_browser_properties_init): update to
	new property  (folder_browser_property_changed): kill.
	(get_prop, set_prop): do the donkey work + make properly RW.

2000-03-31  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (folder_browser_set_shell):
	* folder-browser.c (folder_browser_new):
	* message-list.c (on_row_selection_cmd, select_msg,
	message_list_init, message_list_set_folder):

	remove debugging printf()s that no longer seem useful

2000-03-29  Dan Winship  <danw@helixcode.com>

	* folder-browser-factory.c (control_activate): build a toolbar.
	(control_deactivate): and hide it.

2000-03-27  Chris Toshok <toshok@helixcode.com>
	* mail-display.c: quiet warnings when building in ../po

2000-03-26  Miguel de Icaza  <miguel@gnu.org>

	* folder-browser-factory.c (folder_browser_set_shell): Memory leak
	fix. 

2000-03-25  Dan Winship  <danw@helixcode.com>

	* message-list.c (select_msg, ml_value_at): update for summary
	changes. Hey, neat, it really does make it more efficient.

2000-03-22  Christopher James Lahey  <clahey@helixcode.com>

	* .cvsignore: Updated .cvsignore.

2000-03-21  Matt Loper  <matt@helixcode.com>

	* mail-display.c: Minor cleanup & commenting.

	* folder-browser-factory.c: Minor cleanup & warning elimination.

2000-03-21  bertrand  <bertrand@helixcode.com>

	* message-list.c (ml_value_at): display message size

2000-03-20  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Properly ref & sink the table and header models.

2000-03-14  Dan Winship  <danw@helixcode.com>

	* mail-sources.c: First cut at a mail source selection wizard.
	Basically a rigged demo at this point. Doesn't use camel to get
	its information, and is not yet complete or integrated with the
	mail component. Did I mention that the code is ugly?

2000-03-13  bertrand  <bertrand@helixcode.com>

	* folder-browser-factory.c (folder_browser_set_shell): 
	for testing and demonstration purpose, immediately 
	register a fake service.

2000-03-12  bertrand  <bertrand@helixcode.com>

	* folder-browser-factory.c (folder_browser_factory_init): 
	name change.
	(control_activate_cb): when the control is activated, 
	it merges its own UI with the remote UIHandler.
	(control_add_menu): sample menu merging.
	(folder_browser_factory): connect the control "activate" signal.

	* evolution-mail.gnorba: 
	name changes

	* folder-browser.h: added a reference to an 
	Evolution::Shell object. 

	* folder-browser-factory.c (folder_browser_set_shell): 
	(folder_browser_control_add_service_repository_interface): 
	(folder_browser_factory): the folder-browser control now
	implements the Evolution/ServiceRepository interface.

2000-03-07  bertrand  <bertrand@helixcode.com>

	* folder-browser-factory.c (development_warning): 
	added a warning so that the user knows that this 
	version may crash his mails.

2000-03-05  bertrand  <bertrand@helixcode.com>

	* message-list.h: include a referrence to the parent 
	folder browser.

	* message-list.c (ml_value_at): use the message summary 
	from the 

	* html-stream.c (html_stream_close): when the stream 
	is closed, set the html stream to NULL
	(html_stream_write): don't write anything if the 
	html handle does not exist. 
	(html_stream_reset): implemented. close the current 
	html handle and begins a new html parser. 

	* session.c (session_store_new): use static exception
	here. 

2000-03-05  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Added a prototype message listing.

2000-03-04  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Set up the column headers properly.

	* folder-browser.c: Show the folder_browser widget.

2000-03-04  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Define ml_duplicate_value and ml_free_value
	correctly.
	
2000-03-04  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Use g_int_compare and g_str_compare as we should
	be instead of g_int_equal and g_str_equal.
	
2000-03-04  bertrand  <bertrand@helixcode.com>

	* test-mail.c (main): replace the bonobo-active/gtk-main
	by bonobo-main.
	Include Gnorba headers.
	(main): don't call the container creation routine 
	before we entered the main loop. Use idle for that.

2000-03-04  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Change this to use the ETable widget itself
	instead of building it from all the parts.

2000-03-03  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Ref the table columns since we unref them at the
	end.

2000-03-01  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (INCLUDES): Add `$(top_srcdir)'.  Also, the
	`top_srcdir' includes must come first everything else to avoid
	including installed headers instead of our fresh ones.

2000-02-28  NotZed  <NotZed@HelixCode.com>

	* Makefile.am (evolution_mail_LDADD): Fixed references to eutil.

2000-02-24  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Changed to match new e_table_simple interface.

2000-02-24  Dan Winship  <danw@helixcode.com>

	* message-list.c (message_list_set_folder): update for CamelFolder
	changes

2000-02-24  Christopher James Lahey  <clahey@helixcode.com>

	* message-list.c: Changed this to not use the "x" and "y"
	arguments to e-table-item.

2000-02-23  Matt Loper  <matt@helixcode.com>

	* message-list.c (message_list_set_folder): Check 'desc'riptions
	of exceptions.

2000-02-22  bertrand  <Bertrand.Guiheneuf@aful.org>

	* message-list.c (message_list_set_folder): 
	fix to show a sample correct implementation. 

2000-02-21  Matt Loper  <matt@helixcode.com>

	* Makefile.am: added -lunicode to evolution_mail_LDADD.

2000-02-21  Dan Winship  <danw@helixcode.com>

	* session.c (session_store_new): Pass a CamelAuthCallback
	(evolution_auth_callback) to camel_session_new.
	
2000-02-21  Dan Winship  <danw@helixcode.com>

	* session.c (session_store_new): Update session_store_new to
	deal with the fact that camel_session_get_store takes a
	CamelException now. Doesn't actually do anything with the
	exception yet, because nothing else does yet either.

2000-02-19  Matt Loper  <matt@helixcode.com>

	* .cvsignore: added test-mail.

2000-02-14  Miguel de Icaza  <miguel@gnu.org>

	* folder-browser.c (folder_browser_load_folder): New routine,
	loads a camel folder.
	(folder_browser_set_uri): redo.

	* session.c: new file.  Implements SessionStores to keep track of
	a Session/Store tuple.  

2000-02-13  Matt Loper  <matt@helixcode.com>

	* html-stream.c (html_stream_new): Second param of gtk_html_begin
	should be "", not NULL.
	(html_stream_new): gtk_html_parse() is deprecated, so the call was
	removed.

	* html-stream.h: HTMLStreamClass's parent changed to
	CamelStreamClass, not CamelStream.

2000-02-11  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Add the e-text directory to the includes list.

	* message-list.c: Change the call to e_cell_text_new, since
	there's an added argument.

2000-02-09  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Added libetext as libetable depends on it.

2000-02-08  Iain Holmes  <ih@csd.abdn.ac.uk>

	* Makefile.am: Changed the order of the compilation so the CORBA stuff
	was made before it was needed.

2000-01-19  Miguel de Icaza  <miguel@gnu.org>

	* Started work on the mail display engine.

	* html-stream.c, html-stream.h: New files, they are CamelStreams
	used to write to the GtkHTML widget. 


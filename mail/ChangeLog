2003-07-25  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (browser_page_switched_callback): New callback
	for the "page_switched" signal on EStorageBrowser; deactivate the
	previous page, activate the new one.
	(impl_createControls): Connect.

2003-07-24  Ettore Perazzoli  <ettore@ximian.com>

	* mail-mt.c (do_op_status): Pass "evolution-mail" as the ID to
	evolution_activity_client_new().  [This is just a temporary thing
	to avoid the fact that we don't have component-factory.h anymore.
	Eventually we'll just get rid of the activity client stuff.]

	* mail-component-factory.c: Added to the build.  Also, finished
	implementing and moving the factory over from component-factory.c.

	* component-factory.c: Removed from the build.
	* component-factory.h: Removed from the build.

	* mail-component.c: Removed some debugging messages.

2003-07-23  Ettore Perazzoli  <ettore@ximian.com>

	* subscribe-dialog.c: Converted to use EStorages instead of
	EvolutionStorages and the new MailComponent object.

	* mail.h: Nuked a bunch of stuff.  This will go away when I am
	done refactoring.

	* mail-offline-handler.c: Use the new MailComponent object.

	* mail-folder-cache.c, mail-folder-cache.h: Converted to use
	EStorages instead of EvolutionStorages.

	* mail-display.c: Use g_timeout and g_source functions instead of
	gtk_timeout functions.

	* mail-send-recv.c: Use g_timeout and g_source functions instead
	of gtk_timeout functions.
	(receive_update_got_store): Updated for the new mail_note_store().

	* mail-session.c: Use g_timeout and g_source functions instead of
	gtk_timeout functions.

	* mail-config-factory.c (factory): Removed.

	* folder-browser.c (folder_browser_destroy): Use GLib
	timeout/source functions instead of the deprecated GTK ones.
	(done_message_selected): Likewise.
	(folder_browser_gui_init): Protect against fb->search being NULL.

	* mail-account-gui.c (add_new_store): Use new MailComponent object
	and EStorages instead of EvolutionStorages.
	(mail_account_gui_save): Likewise.

	* mail-accounts.c (account_delete_clicked): Use new MailComponent
	object and EStorages instead of EvolutionStorages.
	(account_able_clicked): Likewise.
	(account_able_toggled): Likewise.

	* mail-autofilter.c: Use mail_component_peek_base_directory()
	instead of the evolution_dir global.
	* mail-callbacks.c: Likewise.
	* mail-config.c (uri_to_evname): Likewise.
	(mail_config_get_signature_list): Likewise.
	(delete_unused_signature_file): Likewise.
	* mail-display.c (mail_display_class_init): Likewise.
	* mail-importer.c (mail_importer_make_local_folder): Likewise.
	* mail-local.c (mlf_getv): Likewise.
	* mail-ops.c (uid_cachename_hack): Likewise.
	* mail-summary.c (generate_folder_summaries): Likewise.
	* mail-tools.c (mail_tool_get_local_inbox): Likewise.
	(mail_tools_folder_to_url): Likewise.
	* mail-vfolder.c (mail_vfolder_delete_uri): Likewise.
	(mail_vfolder_rename_uri): Likewise.
	(context_rule_removed): Likewise.
	(store_folder_deleted): Likewise.
	(store_folder_renamed): Likewise.
	(vfolder_load_storage): Likewise.
	(vfolder_editor_response): Likewise.
	(edit_rule_response): Likewise.
	(new_rule_clicked): Likewise.
	(vfolder_gui_add_rule): Likewise.
	* mail-session.c (main_get_filter_driver): Likewise.
	(mail_session_forget_password): Likewise.
	(mail_session_init): Get a base_directory arg.

	* component-factory.c, component-factory.h: Disabled a bunch of
	stuff to get it to compile in the new configuration.  These files
	will eventually go away when I am done refactoring this.

	* Makefile.am: Do not build importers, compile generate
	skels/stubs for Evolution.

	* GNOME_Evolution_Mail.server.in.in: Rename control factory to
	OAFIID:GNOME_Evolution_Mail_Factory2.  Add new component
	GNOME_Evolution_Mail_Component2.

	* mail-component-factory.c: New file implementing the Bonobo
	factory.

	* mail-component.c, mail-component.h: New files implementing the
	new mail component, using the new Evolution::Component IDL.

2003-07-23  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (mail_format_data_wrapper_write_to_stream): Revert
	prior changes.

2003-07-23  Dan Winship  <danw@ximian.com>

	* folder-browser.c (message_list_drag_data_get): Fix type warnings
	(folder_browser_toggle_caret_mode): Remove unused variable.

	* folder-browser-ui.c (basename): remove unused function

	* mail-account-gui.c (mail_account_gui_build_extra_conf): Fix
	warnings

	* mail-callbacks.c (empty_trash): Remove unused variable.

	* mail-display.c: #include gal/widgets/e-gui-utils.h for
	e_auto_kill_popup_menu_on_selection_done

	* mail-importer.c: #include e-util/e-path.h for e_path_to_physical

	* mail-session.c (main_play_sound): don't declare filename to be
	const and then free it.

	* mail-vfolder.c (vfolder_edit_rule, vfolder_gui_add_rule): Fix
	casts

	* message-list.c (build_flat_diff): Fix a typo in the
	non-BROKEN_ETREE code

2003-07-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (handle_multipart_encrypted): We don't have
	camel_pgp_mime_is_rfc2015_encrypted() anymore so just look at the
	protocol for now.
	(mail_format_data_wrapper_write_to_stream): Updated for the new
	way camel handles content objects.

2003-07-15  Federico Mena Quintero  <federico@ximian.com>

	* folder-browser.c (message_list_drag_data_received): Handle
	invalid URIs, or more likely, the last empty element in a URI list
	--- g_strsplit() will yield { "uri1", "", NULL }.  Fixes #46398.

	* component-factory.c (destination_folder_handle_drop): Likewise.

2003-07-15  Yuedong Du  <yuedong.du@sun.com>

	* mail-config.c: (config_write_style), (mail_config_init): remove
	the use of caret mode widget style.
	* mail-display.c: (display_notify), (mail_display_new): use new
	gtkhtml api to set caret mode.

2003-07-11  Antonio Xu  <antonio.xu@sun.com>

	* folder-browser-ui.c: Change the EditPaste mask to IS_0MESSAGE so
	that it is always activatable. Fixes bug #46018.

2003-07-04  Maxx Cao  <maxx.cao@sun.com>

	** For bug #41839

	* mail-display.c (do_attachment_header): Attachment buttons made
	accessable with keyboard (focusable). "Inline" button is disabled
	when attachment can't be viewed inline.
	(do_signature): Signature button made accessable with keyboard
	(focusable).
	(button_press): Function changed to an event callback (originally
	gtkbutton signal callback).
	(popup_menu_placement_callback): Function added to place popup
	menu (of attachment) beside button when activated by keyboard.

2003-07-10  Yuedong Du  <yuedong.du@sun.com>

	* evolution-mail.schemas: add a gconf key corresponding to newly 
	introduced caret mode of gtkhtml widget.

	* folder-browser-ui.c: new verb handling, corresponding the new menu
	entry for the caret mode flag. 

	* folder-browser.h: declaration of new verb handler to the menu entry 
	that turn caret mode on/off. The function just set the new introduced
	gconf key.

	* folder-browser.c: ditto

	* mail-config.c: lstione to the new gconf key, and when caret mode 
	flag is set/unset,change the style of gtkhtml widget. see bug
	#44607.

2003-07-09  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.h: Removed camel-pgp-mime.h, it no longer exists.

	* mail-format.c: Remove camel-pgp-mime.h

2003-07-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (mail_generate_reply): Use
	camel_strcase_hash/equal.

	* upgrade-mailer.c: Updated to use the camel-file-utils version of
	mkdir.

2003-07-02  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-tools.c (mail_tool_forward_message): Strip the signature
	from the body text. Fixes bug #45523. While we're here, also fix
	the code to quote exactly the same way as the
	mail_tool_quote_message() function.
	(mail_tool_quote_message): The last arg should not be
	'want_plain', because that arg is for whether or not the body
	should be quoted.

	* folder-browser.c (message_list_drag_data_get): Apply a
	From-filter when dragging as a test/uri-list and
	message/rfc822. Fixes bug #45617. Also free the uids ptrarray for
	the text/uri-list case.

2003-07-01  Dan Winship  <danw@ximian.com>

	* mail-display.c (pixbuf_for_mime_type): Gone
	(pixbuf_gen_idle): Use e_icon_for_mime_type instead.

2003-06-27  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (filter_date): Use the newer utf8 versions of the
	e_strftime*() functions since our format strings are all now in
	UTF-8.

	* mail-display.c (mail_display_render): Use the newer
	e_utf8_strftime_fix_am_pm().

	* mail-callbacks.c (mail_generate_reply): Use e_utf8_strftime(),
	otherwise we can end up with invalid utf-8.

2003-06-25  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): provide hardcoded default
	(red) spell error color

2003-06-24  Jeffrey Stedfast  <fejj@ximian.com>

	Might fix bug #45368 but I wouldn't bet on it.

	* message-browser.c (message_browser_new): Record the signal id
	for folder_loaded.
	(message_browser_folder_loaded): disconnect by id rather than
	searching for the handler. Save the id of the message_list_built
	signal handler.
	(message_browser_message_list_built): Disconnect the handler by
	id.
	(message_browser_destroy): Disconnect the signal handlers by id.

2003-06-20  Not Zed  <NotZed@Ximian.com>

	** See bug #43887

	* mail-format.c (mail_get_message_body): handle text/enriched and
	text/richtext explictly, and dont treat them as text/plain.

2003-06-23  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): add
	EvolutionMailPrintHTMLWidget style assignment

	* mail-callbacks.c (do_mail_print): set printing widget name

2003-06-23  Dan Winship  <danw@ximian.com>

	* message-list.c (on_selection_changed_cmd): Save the idle_id

2003-06-23  Larry Ewing  <lewing@ximian.com>

	* folder-browser.c (do_message_selected): make sure not to strcmp
	a possibly NULL string.

2003-06-19  Not Zed  <NotZed@Ximian.com>

	** See bug #45063

	* folder-browser.c (do_message_selected): dont re-load if the same
	message gets selected again as one we've already shown.  Etree
	sends out selection changed events even when when it hasn't.

2003-06-18  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (hide_save_state): Only save state if we have a
	folder reference. Fixes some warnings about casting a NULL object
	to a CamelFolder.

2003-06-16  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (ml_tree_value_at): Don't display an unread icon
	for a parent message status if it has unread children but has been
	read itself. Instead, show that we have unread children by just
	making the message test bold (which it was already doing, so
	yay... this was easy). Fixes bug #42630.

2003-06-16  Not Zed  <NotZed@Ximian.com>

	** See bug #44609

	* mail-vfolder.c (vfolder_edit_rule): put the ok/cancel buttons in
	the stupid gnome 2 order.

	** See bug #33593

	* message-list.c (on_selection_changed_cmd): also listedn to
	selection changed events, since the etable api has changed.
	(get_selected_cb): helper for above.
	(message_list_construct): hook to selection change signal.

	* mail-callbacks.c (composer_send_queued_cb): Unref the composer
	to match the ref composer_send_cb();

	** See bug #44519

	* message-browser.c (message_browser_message_list_built): We want
	to disconnect from the messagelist, not folderbrowser signal.

2003-06-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (format_mime_part): We only really want to use
	mail_identify_mime_part() if the content-type is
	application/octet-stream - any other type (if it doesn't have a
	handler) should just force the user to save to disk.
	(handle_text_plain): Only pay attention to format=flowed if the
	mime-type is text/plain (handle_text_plain is the generic text
	handler, so we might be processing parts that are not really
	text/plain, thus the format param may have different meaning for
	those other textual types).

2003-06-11  Larry Ewing  <lewing@ximian.com>

	* mail-format.c (mail_lookup_handler): free the application list
	if we are bailing.

	* mail-send-recv.c (free_folder_info): free the info structure as
	well.

2003-06-06  Jeffrey Stedfast  <fejj@ximian.com>

	* message-tag-followup.c (get_week_start_day): Use mail-config's
	gconf client.
	(target_date_new): Same.

	* message-list.c (message_list_set_folder): Use mail-config's
	gconf client.
	(mail_regen_list): Same.

	* mail-tools.c (mail_tool_quote_message): Use mail-config's gconf
	client.
	(mail_tool_forward_message): Same.

	* mail-session.c (main_get_filter_driver): Use mail-config's gconf
	client.

	* mail-preferences.c (mail_preferences_init): Use mail-config's
	gconf client.
	(mail_preferences_finalise): Don't unref the gconf client.

	* mail-format.c (write_headers): Use mail-config's gconf client.
	(mail_format_data_wrapper_write_to_stream): Same.
	(handle_text_plain): And here.

	* mail-display.c (save_data_cb): Use mail-config's gconf client.
	(save_part): Same.
	(on_url_requested): Here too.
	(mail_text_write): And here.
	(mail_display_init): And here.
	(mail_display_destroy): Here too.
	(mail_display_new): Again here.

	* mail-composer-prefs.c (sig_add_cb): Use mail-config's gconf
	client.
	(mail_composer_prefs_construct): Same.

	* mail-callbacks.c (ask_confirm_for_unwanted_html_mail): Use
	mail-config's gconf client.
	(ask_confirm_for_empty_subject): Same.
	(ask_confirm_for_only_bcc): Here too.
	(composer_get_message): And here.
	(create_msg_composer): Again here.
	(mail_generate_reply): Same.
	(forward): And here.
	(transfer_msg_done): "
	(delete_msg): "
	(confirm_expunge): "

	* component-factory.c (owner_unset_cb): Use mail-config's gconf
	client.

	* folder-browser-ui.c (folder_browser_ui_add_message): Use the
	mailer's gconf client.
	(folder_browser_ui_add_list): Same.
	(folder_browser_ui_add_global): Here too.

	* folder-browser.c (save_cursor_pos): Use the mailer's gconf
	client.
	(folder_browser_set_message_preview): Same.
	(folder_browser_toggle_preview): Here too.
	(folder_browser_toggle_threads): And here.
	(folder_browser_toggle_hide_deleted): Here as well.
	(folder_browser_set_message_display_style): And here.
	(fb_resize_cb): Here.
	(paned_realised): And here.
	(done_message_selected): And everywhere...

	* mail-account-gui.c (sig_add_new_signature): Use the mailer gconf
	client.

	* mail-config.c (mail_config_get_gconf_client): New function to
	return the global GConfClient used by the mailer.
	(mail_config_write_on_exit): On exit, free our objects and such.
	(mail_config_signature_run_script): Use config->gconf.

2003-06-04  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (invert_selection): Get rid of the if-focused
	code, that will always prevent the etree from getting the
	selection inverted because the menu item will always have focus at
	this time. Fix for bug #43972.

2003-06-11  Not Zed  <NotZed@Ximian.com>

	** See bug #22542
	
	* component-factory.c (storage_create_folder): If we're creating a
	folder on a vstore, popup a vFolder editor rather than failing.

2003-06-05  Not Zed  <NotZed@Ximian.com>

	** Part of #42691.
	
	* importers/Makefile.am (BUILT_SOURCES): added server_DATA.

	* Makefile.am (%.server.in): create a proper implicit rule for
	temporary .in file.

2003-06-04  Not Zed  <NotZed@Ximian.com>

	** See bug #43974

	* mail-tools.c (mail_tool_do_movemail): use a proper CamelURL to
	decode the uri, not hacky strcmp stuff.

	* mail-account-gui.c (extract_values): if we have an conf_entry,
	ignore username, hostname, and path ones, as these are handled
	implicitly in the url itself.  Came about because of the fix for
	#42838.

2003-06-03  Federico Mena Quintero  <federico@ximian.com>

	* mail-search.c (mail_search_construct): Put the buttons in HIG
	order; don't replace the label of the stock Find button.  Also,
	add Escape as a keybinding for the Close button (see why GTK+ is
	on crack on b.g.o #74221 and #101293).


2003-12-01  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_signature_run_script): Use fcntl() to
	set FD_CLOEXEC on each fd rather than close()ing it. Apparently
	Linux's older pthread implementations use sockets and so this
	fouls threading up. GO LINUX! GO!

2003-11-27  Charles Zhang  <charles.zhang@sun.com>

	* mail-account-gui.c (mail_account_gui_changed): move to file
	mail-account-editor.c
	(mail_account_gui_setup): move signal connect statements to file
	mail-account-editor.c
	* mail-account-editor.c (construct): same as above
	(mail_account_editor_changed): changed from mail_account_gui_changed
	in file mail-account-gui.c

2003-11-27  Charles Zhang  <charles.zhang@sun.com>

	* mail-account-editor.c (construct): connect "changed" signal.
	(mail_account_editor_changed): change signal handler.
	Fixes bug #48998.

2003-12-01  Suresh Chandrasekharan <suresh.chandrasekharan@sun.com>

	Fix for bug #51551

	* mail-callbacks.c: (composer_get_message) Encode the value of
	"Organization:" header string here incase it contains 8 bit
	characters.

2003-10-13  Charles Zhang  <charles.zhang@sun.com>

	* mail-account-gui.c (mail_account_gui_changed): change signal 
	handler on gui object, callback func.
	(mail_account_gui_setup): connect widgets to change signal.
	(sig_changed): call change handler func.
	(mail_account_gui_build_extra_conf): connect "changed" signal.
	(default_folders_clicked): call change handler func.
	
	* mail-account-editor.c (apply_changes): disable apply button.
	(construct): disable apply button.
	(mail_account_editor_changed): change signal handler on editor
	object.
	
	* mail_account_editor.h (mail_account_editor_changed): defination
	of func above.[48998]
	
2003-10-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (setup_mime_tables): Add a handler for image/pjpeg
	(which is not a registered MIME-type, but one that retarded
	mailers such as Hotmail and Outlook seem to send out).

2003-10-14  Suresh Chandrasekharan <suresh.chandrasekharan@sun.com>

	* mail-search.c: Enabled forward/backward search toggle
	in 'Search in Message' dialog.

2003-10-08  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* mail-display.c: (pixbuf_gen_idle):
	Use gnome-thumbnail_scale_down_pixbuf if available,
	for better performance.

2003-10-03  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* mail-config-druid.c (identity_prepare), (config_wizard_new):
	Convert real name to UTF-8 if needed.

2003-10-02  Suresh Chandrasekharan <suresh.chandrasekharan@sun.com>

	* mail-config-druid.c: Fix for 40917 "Backspace shouldn't
	highlight the whole remaining string in Setup Assistant".
	(identity_changed): Removed repeated focussing per keystroke.
	functions
	(source_changed): Same.
	(transport_changed): Here too.
	(management_changed): And here.
	(identity_prepare): Removed the initial highlighting for Full
	Name, also the unneeded intial grab_focus.

2003-09-30  Rodney Dawes  <dobey@ximian.com>

	* mail-callbacks.c: Use "Sans Regular" instead of "Helvetica"
	Fixes bug #47878

2003-09-25  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-gui.c (mail_account_gui_save): Allow the
	sent/drafts folder uri to be any file: uri.

2003-09-24  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-preferences.c (mail_preferences_construct): Same as below.

	* mail-composer-prefs.c (mail_composer_prefs_construct): gconf can
	return empty string if the charset has not been set, so if the
	charset string is empty, default the charset to the user's locale
	charset. Partial fix for bug #47638.

2003-09-25  Rodney Dawes  <dobey@ximian.com>

	* mail-send-recv.c: Make the dialog more HIG-compliant by fixing
	widget alignment/spacing issues, and removing separators
	
2003-09-22  Not Zed  <NotZed@Ximian.com>

	** See bug #32996
	
	* mail-folder-cache.c (real_flush_updates): don't just pass TRUE
	to the 'can work offline' parameter of new shell folder.

	** See bug #39410
	
	* mail-ops.c (prep_offline_do): sync all messages, not just
	unread or flagged ones.

2003-09-21  Rodney Dawes  <dobey@ximian.com>

	* subscribe-dialog.glade: Make the dialog an actual GtkDialog,
	and make the dialog be more HIG-compliant, as well as fix dialog
	resizing
	
2003-09-18  Antonio Xu  <antonio.xu@sun.com>

	* mail-display.c (mail_display_render): Set default text color as
	black in body when doing printing preview. Fixs bug #48290.

2003-09-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (handle_text_plain): Don't set inend until after
	we've appended the '\n', this fixes bug #48345. Instead of passing
	inend to handle_uuencode(), scan for a "\nend\n" and use that as
	the max end boundary - fixes bug #48184. Also don't bother
	checking lineptr against "begin ..." if inptr == inend, since it
	couldn't possibly be the start of a uuencoded blob.

2003-09-10  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-gui.c (mail_account_gui_save): Allow the user to
	select any fodler for his/her Drafts and Sent folders. Fixes bug
	#45412.

2003-09-08  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-display.c (invisible_selection_clear_event_callback): Don't
	clear the clipboard. Fixes bug #48203.

2003-09-09  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (build_dialogue): use an eclippedlabel for
	status.  Fixed all uses.

2003-09-09  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c (folder_browser_set_message_preview): clear the
	'loaded uid' when we hide, so when we re-show it reloads.

2003-09-02  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (handle_text_plain): Scan for uuencoded parts and
	show them as separate attachments if we encounter any. Works
	around Broken Mailers (tm). Also fixes bug #43808.

2003-08-28  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-display.c (on_link_clicked): Don't pass cid: nor
	thismessage: urls off to gnome_url_show(). See discussion of bug
	#47541.

2003-08-14  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (mail_send_message): Don't abort at the first failure
	after sending (filtering, appending to Sent, syncing). Instead,
	keep a running tab of exceptions and then set a culmulative
	exception at the end to report to our caller. Also, if we fail to
	append to the account Sent folder, try again with the local Sent
	folder. Fixes bug #46512.

2003-08-19  Harry Lu  <harry.lu@sun.com>

	** For #45348

	* mail-display.c (mail_display_render): Change "%P" to "%p" so
	that strftime() can work under solaris.

2003-08-13  Suresh Chandrasekharan <suresh.chandrasekharan@sun.com>

	* e-searching-tokenizer.c (searcher_next_token): Fix for 45818 ( i18n
	mail messages search only produces '[?]'). Now multibyte character
	selection works correctly. But due to associated gtkhtml bug, the find
	button functionallity for multibyte characters is broken.

2003-08-05  Not Zed  <NotZed@Ximian.com>

	** See bug #32732

	* message-list.c (mail_regen_list): use thread_new.

	* mail-local.c (reconfigure_response): use thread_new.

	* mail-display.c (stream_write_or_redisplay_when_loaded): use
	thread_new.

	* mail-config.c (mail_config_check_service): use thread_new rather
	than queue.

	* mail-callbacks.c (view_msg): change to use mail_get_messages(),
	fixes FIXME.
	(do_view_messages): handle get_messages callback.
	(do_view_message): removed.

	* mail-ops.c (mail_get_folderinfo): Use a new thread thread
	semantic.
	(mail_save_part): "
	(mail_store_set_offline): "
	(mail_sync_folder): use queued_slow thread queue.
	(mail_expunge_folder): "
	(mail_empty_trash): "

	** See bug #47224.  Hook onto clicked rather than button_pressed,
	so that dnd works.
	
	* mail-display.c (inline_toggle): toggle a part inline.
	(button_press): change back to only handle button clicked events,
	renamed to inline_button_clicked.
	(do_attachment_header): hook onto clicked rather than
	button_press_event, and move key_press_event to
	inline_button_pressed.
	(do_signature): Same.
	(inline_button_pressed): handle inline button key press event
	explicitly.

2003-07-29  Not Zed  <NotZed@Ximian.com>

	* mail-folder-cache.c (mail_note_store): add a CamelOperation for
	overriding status handler.

	* mail-send-recv.c (receive_update_got_store): Pass our own cancel
	handle to get_folderinfo and mail_note_store.
	(mail_send_receive, mail_receive_uri): Same for get_store.

	* mail-ops.c (mail_get_store, mail_get_folderinfo): Add a
	CamelOperation argument, for overriding the status handler.  Fixed
	most calles to pass NULL to use the default.

2003-08-01  Yuedong Du  <yuedong.du@sun.com>

	* message-browser.c (on_key_press): close mail message window
	using 'ESC' key, fix bug #47087

2003-07-29  Dan Winship  <danw@ximian.com>

	* mail-display.c (pixbuf_for_mime_type): Gone
	(pixbuf_gen_idle): Use e_icon_for_mime_type instead.

2003-07-25  Jeffrey Stedfast  <fejj@ximian.com>

	* message-browser.c (on_key_press): New callback function to
	override the behaviour of hitting the Delete key. Fixes bug
	#45597.

2003-07-15  Federico Mena Quintero  <federico@ximian.com>

	* folder-browser.c (message_list_drag_data_received): Handle
	invalid URIs, or more likely, the last empty element in a URI list
	--- g_strsplit() will yield { "uri1", "", NULL }.  Fixes #46398.

	* component-factory.c (destination_folder_handle_drop): Likewise.

2003-07-11  Antonio Xu  <antonio.xu@sun.com>

	* folder-browser-ui.c: Change the EditPaste mask to IS_0MESSAGE so
	that it is always activatable. Fixes bug #46018.

2003-07-02  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-tools.c (mail_tool_forward_message): Strip the signature
	from the body text. Fixes bug #45523. While we're here, also fix
	the code to quote exactly the same way as the
	mail_tool_quote_message() function.
	(mail_tool_quote_message): The last arg should not be
	'want_plain', because that arg is for whether or not the body
	should be quoted.

2003-07-04  Maxx Cao  <maxx.cao@sun.com>

	** For bug #41839

	* mail-display.c (do_attachment_header): Attachment buttons made
	accessable with keyboard (focusable). "Inline" button is disabled
	when attachment can't be viewed inline.
	(do_signature): Signature button made accessable with keyboard
	(focusable).
	(button_press): Function changed to an event callback (originally
	gtkbutton signal callback).
	(popup_menu_placement_callback): Function added to place popup
	menu (of attachment) beside button when activated by keyboard.

2003-07-02  Jeffrey Stedfast  <fejj@ximian.com>

	* folder-browser.c (message_list_drag_data_get): Apply a
	From-filter when dragging as a test/uri-list and
	message/rfc822. Fixes bug #45617. Also free the uids ptrarray for
	the text/uri-list case.

2003-06-27  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (filter_date): Use the newer utf8 versions of the
	e_strftime*() functions since our format strings are all now in
	UTF-8.

	* mail-display.c (mail_display_render): Use the newer
	e_utf8_strftime_fix_am_pm().

	* mail-callbacks.c (mail_generate_reply): Use e_utf8_strftime(),
	otherwise we can end up with invalid utf-8.

2003-06-25  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): provide hardcoded default
	(red) spell error color

2003-06-24  Jeffrey Stedfast  <fejj@ximian.com>

	Might fix bug #45368 but I wouldn't bet on it.

	* message-browser.c (message_browser_new): Record the signal id
	for folder_loaded.
	(message_browser_folder_loaded): disconnect by id rather than
	searching for the handler. Save the id of the message_list_built
	signal handler.
	(message_browser_message_list_built): Disconnect the handler by
	id.
	(message_browser_destroy): Disconnect the signal handlers by id.

2003-06-20  Not Zed  <NotZed@Ximian.com>

	** See bug #43887

	* mail-format.c (mail_get_message_body): handle text/enriched and
	text/richtext explictly, and dont treat them as text/plain.

2003-06-23  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): add
	EvolutionMailPrintHTMLWidget style assignment

	* mail-callbacks.c (do_mail_print): set printing widget name

2003-06-23  Dan Winship  <danw@ximian.com>

	* message-list.c (on_selection_changed_cmd): Save the idle_id

2003-06-23  Larry Ewing  <lewing@ximian.com>

	* folder-browser.c (do_message_selected): make sure not to strcmp
	a possibly NULL string.

2003-06-19  Not Zed  <NotZed@Ximian.com>

	** See bug #45063

	* folder-browser.c (do_message_selected): dont re-load if the same
	message gets selected again as one we've already shown.  Etree
	sends out selection changed events even when when it hasn't.

2003-06-18  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (hide_save_state): Only save state if we have a
	folder reference. Fixes some warnings about casting a NULL object
	to a CamelFolder.

2003-06-16  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (ml_tree_value_at): Don't display an unread icon
	for a parent message status if it has unread children but has been
	read itself. Instead, show that we have unread children by just
	making the message test bold (which it was already doing, so
	yay... this was easy). Fixes bug #42630.

2003-06-16  Not Zed  <NotZed@Ximian.com>

	** See bug #44609

	* mail-vfolder.c (vfolder_edit_rule): put the ok/cancel buttons in
	the stupid gnome 2 order.

	** See bug #33593

	* message-list.c (on_selection_changed_cmd): also listedn to
	selection changed events, since the etable api has changed.
	(get_selected_cb): helper for above.
	(message_list_construct): hook to selection change signal.

	* mail-callbacks.c (composer_send_queued_cb): Unref the composer
	to match the ref composer_send_cb();

	** See bug #44519

	* message-browser.c (message_browser_message_list_built): We want
	to disconnect from the messagelist, not folderbrowser signal.

2003-06-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (format_mime_part): We only really want to use
	mail_identify_mime_part() if the content-type is
	application/octet-stream - any other type (if it doesn't have a
	handler) should just force the user to save to disk.
	(handle_text_plain): Only pay attention to format=flowed if the
	mime-type is text/plain (handle_text_plain is the generic text
	handler, so we might be processing parts that are not really
	text/plain, thus the format param may have different meaning for
	those other textual types).

2003-06-11  Larry Ewing  <lewing@ximian.com>

	* mail-format.c (mail_lookup_handler): free the application list
	if we are bailing.

	* mail-send-recv.c (free_folder_info): free the info structure as
	well.

2003-06-06  Jeffrey Stedfast  <fejj@ximian.com>

	* message-tag-followup.c (get_week_start_day): Use mail-config's
	gconf client.
	(target_date_new): Same.

	* message-list.c (message_list_set_folder): Use mail-config's
	gconf client.
	(mail_regen_list): Same.

	* mail-tools.c (mail_tool_quote_message): Use mail-config's gconf
	client.
	(mail_tool_forward_message): Same.

	* mail-session.c (main_get_filter_driver): Use mail-config's gconf
	client.

	* mail-preferences.c (mail_preferences_init): Use mail-config's
	gconf client.
	(mail_preferences_finalise): Don't unref the gconf client.

	* mail-format.c (write_headers): Use mail-config's gconf client.
	(mail_format_data_wrapper_write_to_stream): Same.
	(handle_text_plain): And here.

	* mail-display.c (save_data_cb): Use mail-config's gconf client.
	(save_part): Same.
	(on_url_requested): Here too.
	(mail_text_write): And here.
	(mail_display_init): And here.
	(mail_display_destroy): Here too.
	(mail_display_new): Again here.

	* mail-composer-prefs.c (sig_add_cb): Use mail-config's gconf
	client.
	(mail_composer_prefs_construct): Same.

	* mail-callbacks.c (ask_confirm_for_unwanted_html_mail): Use
	mail-config's gconf client.
	(ask_confirm_for_empty_subject): Same.
	(ask_confirm_for_only_bcc): Here too.
	(composer_get_message): And here.
	(create_msg_composer): Again here.
	(mail_generate_reply): Same.
	(forward): And here.
	(transfer_msg_done): "
	(delete_msg): "
	(confirm_expunge): "

	* component-factory.c (owner_unset_cb): Use mail-config's gconf
	client.

	* folder-browser-ui.c (folder_browser_ui_add_message): Use the
	mailer's gconf client.
	(folder_browser_ui_add_list): Same.
	(folder_browser_ui_add_global): Here too.

	* folder-browser.c (save_cursor_pos): Use the mailer's gconf
	client.
	(folder_browser_set_message_preview): Same.
	(folder_browser_toggle_preview): Here too.
	(folder_browser_toggle_threads): And here.
	(folder_browser_toggle_hide_deleted): Here as well.
	(folder_browser_set_message_display_style): And here.
	(fb_resize_cb): Here.
	(paned_realised): And here.
	(done_message_selected): And everywhere...

	* mail-account-gui.c (sig_add_new_signature): Use the mailer gconf
	client.

	* mail-config.c (mail_config_get_gconf_client): New function to
	return the global GConfClient used by the mailer.
	(mail_config_write_on_exit): On exit, free our objects and such.
	(mail_config_signature_run_script): Use config->gconf.

2003-06-04  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (invert_selection): Get rid of the if-focused
	code, that will always prevent the etree from getting the
	selection inverted because the menu item will always have focus at
	this time. Fix for bug #43972.

2003-06-11  Not Zed  <NotZed@Ximian.com>

	** See bug #22542
	
	* component-factory.c (storage_create_folder): If we're creating a
	folder on a vstore, popup a vFolder editor rather than failing.

2003-06-05  Not Zed  <NotZed@Ximian.com>

	** Part of #42691.
	
	* importers/Makefile.am (BUILT_SOURCES): added server_DATA.

	* Makefile.am (%.server.in): create a proper implicit rule for
	temporary .in file.

2003-06-04  Not Zed  <NotZed@Ximian.com>

	** See bug #43974

	* mail-tools.c (mail_tool_do_movemail): use a proper CamelURL to
	decode the uri, not hacky strcmp stuff.

	* mail-account-gui.c (extract_values): if we have an conf_entry,
	ignore username, hostname, and path ones, as these are handled
	implicitly in the url itself.  Came about because of the fix for
	#42838.

2003-06-03  Federico Mena Quintero  <federico@ximian.com>

	* mail-search.c (mail_search_construct): Put the buttons in HIG
	order; don't replace the label of the stock Find button.  Also,
	add Escape as a keybinding for the Close button (see why GTK+ is
	on crack on b.g.o #74221 and #101293).


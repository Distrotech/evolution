2004-03-05  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #55202

	* e-msg-composer.c (add_recipients): No longer takes a decode
	argument (handle_mailto is the only function that calls it, and
	the decode value always has to be TRUE for mailto).
	(handle_mailto): Updated.

2004-02-27  Bruce Tao <bruce.tao@sun.com>

	* e-msg-composer-attachment-bar.c: add a key-press event handler, 
	with which a little modification to Paolo Borelli's patch.
	 <pborelli@katamail.com> When one attachment is deleted, the 
	icon right after the last deleted one will be focused.

2004-02-26  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (set_editor_text): Add a <br> tag between the
	message text and the signature text (makes it nicer looking and
	also fixes bug #53747.

2004-02-17  Radek Doulik  <rodo@ximian.com>

	* e-msg-composer.c (e_msg_composer_unrealize): renamed from unmap

2004-02-13  Radek Doulik  <rodo@ximian.com>

	* e-msg-composer.c (create_composer): get default composer size
	from gconf, hook to unrealize event and save size to gconf
	(e_msg_composer_unmap): new handler, saves composer window size

2004-02-06  Rodney Dawes  <dobey@ximian.com>

	* e-msg-composer-attachment-bar.c: add accel and icon for
	the "remove" item in the popup menu.
	Patch from Paolo Borelli  <pborelli@katamail.com>

2004-02-03  Chris Toshok  <toshok@ximian.com>

	* e-msg-composer.c (e_msg_composer_guess_mime_type): use
	FORCE_SLOW_MIME_TYPE so gnome-vfs actually sniffs the file
	contents before coming up with a mime type.

2004-02-03  Dan Winship  <danw@ximian.com>

	* Makefile.am (INCLUDES): add widgets/misc

2004-02-02  Not Zed  <NotZed@Ximian.com>

	* evolution-composer.c (impl_Composer_set_body): use
	g_ascii_strcasecmp rather than strcasecmp.

	** See bug #53506, again.

	* e-msg-composer.c (set_editor_text): Add an argument to make
	adding the signature optional.  Also fix a memleak with the sig
	content.
	(e_msg_composer_new_with_type, e_msg_composer_flush_pending_body)
	(handle_mailto, e_msg_composer_set_body_text)
	(e_msg_composer_set_body): Fixed callers for above change
	appropriately.

2004-01-29  Not Zed  <NotZed@Ximian.com>

	* e-msg-composer.c (e_msg_composer_new_with_type): reverted
	radek's patch below, it was already fixed (#53176).  Changed the
	init order though, set_editor_signature only sets the current one,
	it doen'st insert it.

	** See bug #53506.
	
	* e-msg-composer-hdrs.c (e_msg_composer_hdrs_set_post_to_list):
	use a GString to build the result.
	(e_msg_composer_hdrs_set_post_to_base): same here.
	(e_msg_composer_hdrs_set_post_to_base): dont bother copying the
	post_to string.
	(e_msg_composer_hdrs_get_post_to): change the relative-url test to
	":/" rather than "://", so that mbox url's work.

2004-01-27  Radek Doulik  <rodo@ximian.com>

	* e-msg-composer.c (e_msg_composer_new_with_type): set body text
	after setting composer's signature, so that signature is shown

	Fixes #53367

2004-01-28  Not Zed  <NotZed@Ximian.com>

	** See Bug #53176, probably fixes others too.

	* e-msg-composer.c (set_editor_text): When we set the text, always
	add the signature implictly.  Means we don't have to set it
	manually and break changing the file, or hit any races.
	(e_msg_composer_set_body_text): dont call show_sig_file here.

2004-01-14  Not Zed  <NotZed@Ximian.com>

	** See Bug #20017.

	* e-msg-composer.c (create_composer): set the composer to
	unchanged after all setup, some setup (from_changed_cb) will mark
	it changed.
	(create_composer): remove a warning.

	** See Bug #52794.
	
	(e_msg_composer_get_message_draft): save sign/encrypt settings to
	X-Evolution-Format header.
	(e_msg_composer_new_with_message): restore sign/encrypt settings
	from X-Evolution-Format header.
	(e_msg_composer_set_pgp_sign, e_msg_composer_set_pgp_encrypt)
	(e_msg_composer_set_smime_sign, e_msg_composer_set_smime_encrypt):
	Set composer changed if it did.

2004-01-12  JP Rosevear  <jpr@ximian.com>

	* e-msg-composer-hdrs.c (e_msg_composer_hdrs_set_post_to): fix
	compilation error

2004-01-12  Meilof Veeningen  <meilof@wanadoo.nl>

	* e-msg-composer.[ch]: added "View To", "View Post To" menu items,
	made it possible to see both at the same time, new
	e_msg_composer_new_with_type, only visibility info of headers if
	in the visible mask.

	* e-msg-composer.[ch]: replaced folder selection button by entry
	with selection button next to it, enabled multiple folder selection,
	made it possible to see both To and PostTo fields, disabled
	setting the "X-Evolution-PostTo" header.

2004-01-09  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (autosave_manager_query_load_orphans):
	s/unsaved files/unsaved messages/ as per bug #45407.

2004-01-08  Not Zed  <NotZed@Ximian.com>

	* e-msg-composer.c (set_editor_signature): add an assertion for no
	account set.  Discovered from bug #50786.

2004-01-07  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (create_composer): Remove the 6-pixel border
	around the main window. That just looked ugly.

2004-01-07  JP Rosevear <jpr@ximian.com>

	* Makefile.am: missed this - remove disable deprecated flag

2003-12-04  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-hdrs.c (create_headers): Unifdef out the post-to
	code and fix it to use the new folder selection button.
	(e_msg_composer_hdrs_set_post_to): Same.
	(e_msg_composer_hdrs_get_post_to): Same.

2003-12-03  Ettore Perazzoli  <ettore@ximian.com>

	* e-msg-composer-hdrs.c: Do not #include
	<evolution-folder-selector-button.h>.
	(e_msg_composer_hdrs_set_post_to): #if 0 out for now.
	(e_msg_composer_hdrs_get_post_to): Likewise.

2003-12-02  ERDI Gergo  <cactus@cactus.rulez.org>

	* e-msg-composer.c: Implemented #127527: the attachment bar is
	packed inside an EExpander

2003-12-01  Rodney Dawes  <dobey@ximian.com>

	* e-msg-composer-hdrs.h: Use BASE_VERSION for repo_ids and OAFIIDs

2003-11-11  Radek Doulik  <rodo@ximian.com>

	* e-msg-composer.c (e_msg_composer_set_autosaved): new method to
	wrap autosaved flag setting
	(e_msg_composer_unset_autosaved): ditto
	(e_msg_composer_is_autosaved): new method, says if composer was
	autosaved only
	(autosave_save_draft): unset changed so that we don't autosave all
	the time when anything else than gtkhtml control changed

2003-11-06  Radek Doulik  <rodo@ximian.com>

	* e-msg-composer.c (autosave_save_draft): call gtkhtml's saved
	command to clean is-saved flag, set composer's autosaved flag
	(do_exit): complain if last save was just autosave
	(e_msg_composer_unset_changed): reset autosaved flag
	(save): reset autosaved flag

	* e-msg-composer.h: added autosaved flag, it tells whether last
	save was autosave or regular save, when changed flag is reset the
	autosaved one is reset too

2003-11-30  Ettore Perazzoli  <ettore@ximian.com>

	* e-msg-composer-hdrs.c (create_headers): #if 0 the "post to"
	stuff for now (it requires the global_shell_client and the
	evolution_folder_selector_button which we don't have anymore).

2003-11-26  Chris Toshok  <toshok@ximian.com>

	* e-msg-composer.c (build_message): switch from just checking
	SMIME_SUPPORTED to checking both HAVE_NSS and SMIME_SUPPORTED.

2003-11-26  JP Rosevear  <jpr@ximian.com>

	* Makefile.am: turn on deprecated gtk widgets

2003-11-03  Not Zed  <NotZed@Ximian.com>

	* e-msg-composer.c (build_message): changed to use ciphercontext
	directly to sign the message, no multipart-signed usage.
	(build_message): do the same for multipart/encryption for gpg encrypting.

2003-11-03  Ettore Perazzoli  <ettore@ximian.com>

	* e-msg-composer-hdrs.h (SELECT_NAMES_OAFIID): Append "_2".

2003-10-31  Not Zed  <NotZed@Ximian.com>

	* e-msg-composer.c (build_message): fix for e-account smime info
	changes.  Also enforce having a signing certificate set in
	preferences before doing any signing.
	(from_changed_cb): handle smime sign/encrypt default for account
	(create_composer): force a from-changed when we start, to properly
	setup signing options.

2003-10-30  Not Zed  <NotZed@Ximian.com>

	* e-msg-composer.c: Turn on SMIME_SUPPORTED.
	(build_message): move some of the security code around, and fix
	up smime code.

2003-10-08  Chris Toshok  <toshok@ximian.com>

	* evolution-composer.c (corba_recipientlist_to_destv): EDestination =>
	EABDestination, and e_destination => eab_destination.
	(impl_Composer_set_headers): same.

	* e-msg-composer.c (update_auto_recipients): EDestination =>
	EABDestination, and e_destination => eab_destination.
	(e_msg_composer_new_with_message): same.
	(add_recipients): same.
	(handle_mailto): same.
	(e_msg_composer_set_headers): same.
	(e_msg_composer_get_recipients): same.
	(e_msg_composer_get_to): same.
	(e_msg_composer_get_cc): same.
	(e_msg_composer_get_bcc): same.

	* e-msg-composer.h: EDestination => EABDestination, and
	e_destination => eab_destination.

	* e-msg-composer-hdrs.c (set_recipients_from_destv): EDestination
	=> EABDestination, and e_destination => eab_destination.
	(e_msg_composer_hdrs_to_message_internal): same.
	(e_msg_composer_hdrs_set_to): same.
	(e_msg_composer_hdrs_set_cc): same.
	(e_msg_composer_hdrs_set_bcc): same.
	(e_msg_composer_hdrs_get_to): same.
	(e_msg_composer_hdrs_get_cc): same.
	(e_msg_composer_hdrs_get_bcc): same.
	(e_msg_composer_hdrs_get_recipients): same.

	* e-msg-composer-hdrs.h: EDestination => EABDestination, and
	e_destination => eab_destination.

2003-09-26  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (save): Don't blindly claim that the file
	exists and then ask the user if he/she would like to overwrite
	it. First check that the file even exists, if not - then we've got
	a different error. Fixes bug #48759.

	* e-msg-composer-select-file.c (e_msg_composer_select_file): Use
	the proper selector title, otherwise it says "Attach files" when
	we are trying to save a message.

2003-09-24  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c (get_default_charset): Same as
	below.

	* e-msg-composer.c (composer_get_default_charset_setting): Handle
	empty-string as the charset value gotten from gconf as this can
	happen. Partial fix for bug #47638.

2003-09-13  Charles Zhang  <charles.zhang@sun.com>

	* e-msg-composer-attachment-bar.c (remove_attachment): Add some
	assertion. Send Close response signal to the properties dialog
	while removeing an attachment.
	* e-msg-composer-attachment-bar.c (remove_selected): Fix a re-
	remove-attachment bug. [#48466]

2003-09-18  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c: updated for
	CamelTransferEncoding namespace changes

	* e-msg-composer.c: updated for CamelTransferEncoding namespace
	changes

2003-09-18  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c:
	* e-msg-composer-attachment.c:
	* e-msg-composer.c: Updated for namespace changes in Camel.

2003-09-17  Not Zed  <NotZed@Ximian.com>

	** Merge in mail-refactor-2-branch

2003-09-15  Ettore Perazzoli  <ettore@ximian.com>

	* e-msg-composer-hdrs.c (header_new_recipient): Make the entry
	non-focusable again.  The right fix for A11Y is to add
	accelerators.

2003-09-11  Federico Mena Quintero  <federico@ximian.com>

	* e-msg-composer.h (EMsgComposer): Added an entry_uic field for a
	BonoboUIComponent for the non-control entries (e.g. the Subject
	line).

	* e-msg-composer.c (create_composer): Set autoactivate to true on
	the HTML control's BonoboControlFrame.
	(setup_ui): Create the composer->entry_uic.
	(destroy): Free the composer->entry_uic.
	(entry_verbs): New array of verbs for the non-control entries.
	Moved the Edit* verbs to here, as they should not be part of the
	main set.
	(composer_entry_focus_in_event_cb): Load
	evolution-composer-entries.xml here for the non-control entries' UI.
	(composer_entry_focus_out_event_cb): Remove the menu items.

2003-09-10  Not Zed  <NotZed@Ximian.com>

	* listener.c (impl_event): We want to use decode to stream for
	attachment parts.

2003-09-08  Not Zed  <NotZed@Ximian.com>

	* e-msg-composer.c (autosave_load_draft): ugh, direct linking to
	evolution-mail suckage.  Should these callbacks just be handled
	internally?
	(handle_multipart_encrypted, handle_multipart_signed)
	(handle_multipart_alternative, handle_multipart)
	(e_msg_composer_new_with_message): Use new em_utils stuff for
	message formatting.

2003-08-22  Antonio Xu  <antonio.xu@sun.com>

	* e-msg-composer-attachment.c (): Connect response signal to
	attachment properties dialog, fix bug #47950.

2003-08-21  Antonio Xu  <antonio.xu@sun.com>

	* Makefile.am (INCLUDES): add EVOLUTION_IMAGESDIR define
	* e-msg-composer.c (create_composer): use EVOLUTION_IMAGESDIR
	and composer icon name to get the path of composer icon.
	[#47781]

2003-08-19  Jeffrey Stedfast  <fejj@ximian.com>

	* Original patch from David Woodhouse, but modified a bit by me.

	* e-msg-composer.c (handle_mailto): Fix insertion of arbitrary
	headers from mailto: links. Ignore From: and Reply-To: headers.

2003-08-13  Lorenzo Gil Sanchez  <lgs@sicem.biz>

	* e-msg-composer-hdrs.c (account_removed_cb): fixed an insulting
	error message. Fixes bug #47413.

2003-08-13  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c (update): This needs to use
	camel_data_wrapper_decode_to_stream() rather than
	write_to_stream(). Also simplify a bit - no sense looping to load
	the pixbuf data into the gdk-pixbuf loader 4K at a time when we
	have the whole thing in a memory buffer already. Once done, unref
	the stream instead of closing it so we don't leak.
	(attach_to_multipart): Use decode_to_stream().

	* e-msg-composer-attachment.c (e_msg_composer_attachment_new):
	Avoid constructing thwe data-wrapper from the stream twice for
	message/rfc822 parts.

2003-07-16  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c (attach_to_multipart): don't set
	the rawtext bit anymore.

	* e-msg-composer.c (build_message): Convert the plain part's
	content stream from UTF-8 to whatever charset we want.

2003-07-31  Antonio Xu  <antonio.xu@sun.com>

	* e-msg-composer.c (drag_data_received): add the drop type of
	mozilla browser link to make composer support to handle mozilla
	DnD data.  [#47131]

2003-07-28  Antonio Xu <antonio.xu@sun.com>

	* e-msg-composer-attachment-bar.c  (update): add
	gdk_pixbuf_loader_close to close pix buffer loading.  [#45908]

2003-07-25  Larry Ewing  <lewing@ximian.com>

	* e-msg-composer.c (GNOME_GTKHTML_EDITOR_CONTROL_ID): require the
	new composer control version.

2003-07-17  Michel Daenzer  <michel@daenzer.net>

	* e-msg-composer.c (autosave_manager_query_load_orphans): Set
	default answer of dialog to 'yes' to try and prevent autosaved
	messages from getting lost accidentally.

2003-07-23  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c (attach_to_multipart): Revert my
	previous changes here too.

	* e-msg-composer.c (build_message): Revert my previous changes.

2003-07-23  Dan Winship  <danw@ximian.com>

	* bad-icon.xpm: Remove this. It was only used by e-icon-list,
	which is no longer there.

	* composer-marshal.list: Likewise

	* Makefile.am: Update

2003-07-21  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (build_message): Init charset to NULL.

2003-07-21  Dan Winship  <danw@ximian.com>

	* e-msg-composer.c (build_message): Make this work again.

2003-07-17  Maxx Cao  <maxx.cao@sun.com>

	** For bug #46013

	* e-msg-composer-hdrs.c (header_new_recipient): To/cc/bcc buttons
	made focusable.

2003-07-16  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c (attach_to_multipart): don't set
	the rawtext bit anymore.

	* e-msg-composer.c (build_message): Convert the plain part's
	content stream from UTF-8 to whatever charset we want.

2003-07-16  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer-attachment-bar.c (popup_menu_event): Fix warnings
	and other breakage introduced by Maxx.

2002-07-14  Maxx Cao  <maxx.cao@sun.com>

	** For bug #45826

	* e-msg-composer-attachment-bar.c (class_init): connect the 
	"popup_menu" signal, so that S-F10 keybinding will work.
	(popup_menu_event): funcion added to handle "popup_menu" (S-F10 key).
	(popup_menu_placement_callback): function added to place the popup 
	menu to the center of attachment icon, in case it is activated by 
	keyboard.
	
2003-07-07  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (e_msg_composer_new_with_message): Updated to
	use camel_strcase_hash/equal.

2003-07-01  Dan Winship  <danw@ximian.com>

	* e-msg-composer-attachment-bar.c (pixbuf_for_mime_type): Gone.
	(update): Use e_icon_for_mime_type instead.

	* Makefile.am (INCLUDES): remove EVOLUTION_IMAGESDIR define

2003-06-25  Antonio Xu  <antonio.xu@sun.com>

	* e-msg-composer.c (handle_mailto): Change file url to absolute
	path. Fixes bug #44065.

2003-07-01  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (autosave_load_draft): Connect to the
	save-draft signal too. Fixes bug #45531.

2003-06-27  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (build_message): Set the rawtext bits for the
	'plain' and 'html' data wrappers to FALSE.

2003-06-19  Larry Ewing  <lewing@ximian.com>

	* listener.c (insert_paragraph_after): free the return value.
	(impl_event): free the return value.

2003-06-17  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (best_encoding): Use e_iconv_open/close so that
	we get charset aliasing for free. Fixes bug #44991.

2003-06-16  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #44139.

	* e-msg-composer-hdrs.c (attach_couple): Set the vertical and
	horizontal padding to 3 always.
	(create_from_optionmenu): Change the hbox spacing to 6 pixels.

	* e-msg-composer.c (create_composer): Set the border width around
	the composer's vbox to HIG specification and make the box_spacing
	6 pixels as well.

2003-06-10  Larry Ewing  <lewing@ximian.com>

	* e-msg-composer-hdrs.c (e_msg_composer_hdrs_and_string_free):
	free the structure as well.

2003-06-09  Larry Ewing  <lewing@ximian.com>

	* listener.c (insert_paragraph_before): free the return values.

2003-05-21  Jeffrey Stedfast  <fejj@ximian.com>

	* e-msg-composer.c (composer_get_default_charset_setting): Same as
	the rest.
	(setup_ui): We didn't even seem to be using the gconf client
	here. Removed.
	(e_msg_composer_load_config): Unref the gconf client after we're
	finished.
	(e_msg_composer_new): Same.
	(e_msg_composer_new_post): Here too.
	(e_msg_composer_set_view_from): And here.
	(e_msg_composer_set_view_replyto): And here.
	(e_msg_composer_set_view_cc): Here too.
	(e_msg_composer_set_view_bcc): Again here.

	* e-msg-composer-hdrs.c (create_from_optionmenu): Same as below.
	(e_msg_composer_hdrs_set_from_account): Here too.

	* e-msg-composer-attachment-bar.c (get_default_charset): Unref the
	gconf client.
